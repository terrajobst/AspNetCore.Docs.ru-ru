---
title: Модели размещения ASP.NET Core Blazor
author: guardrex
description: Общие сведения о моделях размещения Blazor WebAssembly и Blazor Server.
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 02/18/2020
no-loc:
- Blazor
- SignalR
uid: blazor/hosting-models
ms.openlocfilehash: e6ce2be53c35268854e0e8d408b649a8c6ef497e
ms.sourcegitcommit: 9a129f5f3e31cc449742b164d5004894bfca90aa
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78646804"
---
# <a name="aspnet-core-opno-locblazor-hosting-models"></a>Модели размещения ASP.NET Core Blazor

Автор: [Дэниэл Рот](https://github.com/danroth27) (Daniel Roth)

[!INCLUDE[](~/includes/blazorwasm-preview-notice.md)]

Blazor — это веб-платформа, предназначенная для запуска на стороне клиента в браузере в среде выполнения .NET на основе [WebAssembly](https://webassembly.org/) ( *Blazor WebAssembly*) или на стороне сервера в ASP.NET Core ( *Blazor Server*). Независимо от модели размещения, модели приложений и модели компонентов *совпадают*.

Сведения о создании проекта для моделей размещения, описанных в этой статье, см. в разделе <xref:blazor/get-started>.

Сведения о расширенной настройке см. в разделе <xref:blazor/hosting-model-configuration>.

## <a name="opno-locblazor-webassembly"></a>Blazor WebAssembly

Основная модель размещения для Blazor работает на стороне клиента в браузере на WebAssembly. Приложение Blazor, его зависимости и среда выполнения .NET скачиваются в браузере. Приложение выполняется непосредственно в потоке пользовательского интерфейса браузера. Обновления пользовательского интерфейса и обработка событий выполняются в рамках одного процесса. Ресурсы приложения развертываются как статические файлы на веб-сервере или в службе, способной предоставлять статическое содержимое клиентам.

![Blazor WebAssembly. Приложение Blazor выполняется в потоке пользовательского интерфейса в браузере.](hosting-models/_static/blazor-webassembly.png)

Чтобы создать приложение Blazor с помощью клиентской модели размещения, используйте шаблон **Blazor приложения WebAssembly** ([dotnet new blazorwasm](/dotnet/core/tools/dotnet-new)).

После выбора шаблона **Blazorприложения WebAssembly** можно настроить приложение для использования серверной части ASP.NET Core, установив флажок **ASP.NET Core hosted** ([dotnet new blazorwasm --hosted](/dotnet/core/tools/dotnet-new)). Приложение ASP.NET Core предоставляет клиентам приложение Blazor. Приложение Blazor WebAssembly может взаимодействовать с сервером по сети с помощью вызовов веб-API или [SignalR](xref:signalr/introduction) (<xref:tutorials/signalr-blazor-webassembly>).

Шаблоны включают сценарий `blazor.webassembly.js`, который обрабатывает следующие задачи.

* Загрузка среды выполнения .NET, приложения и зависимостей приложения.
* Инициализация среды выполнения для запуска приложения.

Модель размещения Blazor WebAssembly обладает несколькими преимуществами.

* Отсутствует зависимость от .NET на стороне сервера. Приложение полностью работает после загрузки на клиент.
* Ресурсы и возможности клиента используются полностью.
* Рабочая нагрузка переносится с сервера на клиент.
* Для размещения приложения не требуется веб-сервер ASP.NET Core. Возможны сценарии бессерверного развертывания (например, обслуживание приложения из CDN).

Существуют недостатки размещения Blazor WebAssembly.

* Приложение ограничено возможностями браузера.
* Дополнительные требования к клиентскому аппаратному и программному обеспечению (например, поддержка WebAssembly).
* Больше размер скачивания и время загрузки приложения.
* Поддержка среды выполнения .NET и инструментария менее развита. Например, существуют ограничения [.NET Standard](/dotnet/standard/net-standard) в отношении поддержки и отладки.

## <a name="opno-locblazor-server"></a>Сервер Blazor

При использовании модели размещения Blazor Server приложение выполняется на сервере из приложения ASP.NET Core. Обновление элементов пользовательского интерфейса, обработка событий и вызовы JavaScript обрабатываются через подключение [SignalR](xref:signalr/introduction).

![Браузер взаимодействует с приложением (размещенным в приложении ASP.NET Core) на сервере через подключение SignalR.](hosting-models/_static/blazor-server.png)

Чтобы создать приложение Blazor с использованием модели размещения Blazor Server, используйте шаблон ASP.NET Core **Blazor Server** ([dotnet new blazorserver](/dotnet/core/tools/dotnet-new)). Приложение ASP.NET Core размещает приложение Blazor Server и создает конечную точку SignalR, к которой подключаются клиенты.

Приложение ASP.NET Core ссылается на класс `Startup` приложения для добавления:

* служб на стороне сервера;
* приложения в конвейер обработки запросов.

Сценарий `blazor.server.js`&dagger; устанавливает соединение с клиентом. Ответственность за сохранение и восстановление состояния приложения в случае необходимости (например, в случае потери сетевого подключения) несет приложение.

Модель размещения Blazor Server обладает несколькими преимуществами.

* Размер загружаемого файла значительно меньше, чем у приложения Blazor WebAssembly, и приложение загружается гораздо быстрее.
* Приложение обладает всеми преимуществами серверных возможностей, включая использование любых API-интерфейсов, совместимых с .NET Core.
* .NET Core на сервере используется для запуска приложения, поэтому существующие инструменты .NET, такие как отладка, работают должным образом.
* Поддерживаются тонкие клиенты. Например, приложения Blazor Server работают в браузерах, которые не поддерживают WebAssembly, и на устройствах с ограниченными ресурсами.
* База кода приложения .NET/C#, включая код компонента приложения, не отправляется клиентам.

Существуют недостатки размещения Blazor Server.

* Обычно присутствует большая задержка. Каждое взаимодействие с пользователем включает передачу данных по сети.
* Автономная работа не поддерживается. Если происходит сбой клиентского подключения, приложение перестает работать.
* Масштабируемость сложна для приложений со многими пользователями. Сервер должен управлять несколькими клиентскими подключениями и обрабатывать состояние клиента.
* Для обслуживания приложения требуется сервер ASP.NET Core. Сценарии бессерверного развертывания невозможны (например, обслуживание приложения из CDN).

&dagger;Сценарий `blazor.server.js` обрабатывается из внедренного ресурса в общей платформе ASP.NET Core.

### <a name="comparison-to-server-rendered-ui"></a>Сравнение с пользовательским интерфейсом, отображаемым сервером

Одним из способов понимания приложений Blazor Server является понимание того, как они отличаются от традиционных моделей для отрисовки пользовательского интерфейса в приложениях ASP.NET Core с помощью представлений Razor или Razor Pages. В обеих моделях используется язык Razor для описания содержимого HTML, но они значительно отличаются по способу отрисовки разметки.

При отрисовке страницы или представления Razor каждая строка кода Razor выдает HTML в виде текста. После отрисовки сервер удаляет экземпляр страницы или представления, включая все созданные состояния. Когда происходит другой запрос к странице, например при сбое проверки сервера и отображении сводки проверки, происходит следующее:

* вся страница снова преобразуется в HTML-текст;
* страница отправляется клиенту.

Приложение Blazor состоит из многократно используемых элементов пользовательского интерфейса, именуемых *компонентами*. Компонент содержит C# код, разметку и другие компоненты. При подготовке компонента к просмотру Blazor создает граф включенных компонентов аналогично модели DOM в HTML или XML. Этот граф включает в себя состояние компонента, содержащееся в свойствах и полях. Blazor оценивает граф компонентов для создания двоичного представления разметки. Двоичный формат может быть:

* преобразован в HTML-текст (во время предварительной отрисовки&dagger;);
* использован для эффективного обновления разметки во время обычной отрисовки.

&dagger;*Предварительная отрисовка*: запрошенный компонент Razor компилируется на сервере в статический код HTML и отправляется клиенту, где он отображается пользователю. После соединения между клиентом и сервером статические предварительно отрисованные элементы компонента заменяются интерактивными элементами. Предварительная отрисовка делает приложение более отзывчивым для пользователя.

Обновление пользовательского интерфейса в Blazor активируется следующими действиями:

* взаимодействие с пользователем, например нажатие кнопки;
* триггеры в приложении, например таймер.

Граф перерисовывается, и в пользовательском интерфейсе вычисляется *разница* (различия). Эта разница является наименьшим набором изменений DOM, необходимых для обновления пользовательского интерфейса на клиенте. Разница отправляется клиенту в двоичном формате и применяется в браузере.

Компонент уничтожается после того, как пользователь выходит из него на клиенте. Несмотря на то, что с компонентом взаимодействует пользователь, состояние компонента (службы, ресурсы) должно храниться в памяти сервера. Так как сервером может одновременно поддерживаться состояние множества компонентов, нехватка памяти является проблемой, которую необходимо решить. Инструкции по созданию приложения Blazor Server с обеспечением оптимального использования памяти сервера см. в разделе <xref:security/blazor/server>.

### <a name="circuits"></a>Каналы

Приложение Blazor Server построено на основе [ASP.NET Core SignalR](xref:signalr/introduction). Каждый клиент обменивается данными с сервером через одно или несколько соединений SignalR, называемых *каналом*. Канал — это абстракция Blazor для подключений SignalR, которые могут допускать временные перерывы в сети. Когда клиент Blazor видит, что соединение SignalR отключено, он пытается повторно подключиться к серверу с помощью нового соединения SignalR.

Каждый экран браузера (вкладка или iframe), подключенный к приложению Blazor Server, использует соединение SignalR. Это еще одно важное различие по сравнению с обычными приложениями с отрисовкой на сервере. В приложении с отрисовкой на сервере открытие одного и того же приложения в нескольких экранах браузера обычно не приводит к дополнительным требованиям к ресурсам на сервере. В приложении Blazor Server каждый экран браузера требует отдельного канала и отдельных экземпляров состояния компонента для управления сервером.

Blazor рассматривает закрытие вкладки браузера или переход по внешнему URL-адресу как *корректное* завершение. В случае корректного завершения работы канал и связанные ресурсы немедленно освобождаются. Клиент может также отключиться некорректно, например из-за прерывания работы сети. Blazor Server хранит отключенные каналы в течение настраиваемого интервала, чтобы разрешить клиенту повторное подключение.

Blazor Server позволяет коду определить *обработчик канала*, чтобы выполнять код при изменении состояния канала пользователя. Для получения дополнительной информации см. <xref:blazor/advanced-scenarios#blazor-server-circuit-handler>.

### <a name="ui-latency"></a>Задержка пользовательского интерфейса

Задержка пользовательского интерфейса — это время, которое проходит от начала действия до момента обновления пользовательского интерфейса. Небольшие значения задержки пользовательского интерфейса являются обязательным условием, чтобы сделать приложение более отзывчивым для пользователя. В приложении Blazor Server каждое действие отправляется на сервер, обрабатывается, и затем разность пользовательского интерфейса отсылается обратно. Следовательно, задержка пользовательского интерфейса — это сумма задержки в сети и задержки сервера при обработке действия.

Для бизнес-приложения, которое ограничено частной корпоративной сетью, влияние на восприятие пользователями задержки из-за задержки в сети обычно незаметно. Для приложения, развернутого в сети Интернет, задержка может стать заметной для пользователей, особенно в том случае, если пользователи сильно распределены географически.

Использование памяти может также повлиять на задержку приложения. Увеличение использования памяти приводит к частым сборкам мусора и подкачки памяти на диск, что снижает производительность приложений и, следовательно, увеличивает задержку пользовательского интерфейса. Для получения дополнительной информации см. <xref:security/blazor/server>.

Приложения Blazor Server должны быть оптимизированы для минимизации задержки пользовательского интерфейса путем уменьшения задержки сети и использования памяти. Способ измерения задержки в сети см. в разделе <xref:host-and-deploy/blazor/server#measure-network-latency>. Дополнительные сведения о SignalR и Blazor см. в следующих статьях:

* <xref:host-and-deploy/blazor/server>
* <xref:security/blazor/server>

### <a name="connection-to-the-server"></a>Подключение к серверу

Приложениям Blazor Server требуется активное подключение SignalR к серверу. Если соединение потеряно, приложение попытается повторно подключиться к серверу. Пока состояние клиента находится в памяти, сеанс клиента возобновляется без потери состояния.

Приложение Blazor Server предварительно отрисовывается в ответ на первый клиентский запрос, который настраивает состояние пользовательского интерфейса на сервере. Когда клиент пытается создать подключение SignalR, клиент должен повторно подключиться к тому же серверу. Приложения Blazor Server, использующие более одного внутреннего сервера, должны реализовывать *прикрепленные сеансы* для соединений SignalR.

Мы рекомендуем использовать для серверных приложений Blazor[службу Azure SignalR](/azure/azure-signalr). Она позволяет вертикально масштабировать серверные приложения Blazor для одновременного использования большого числа подключений SignalR. Прикрепленные сеансы включаются для службы Azure SignalR путем установки параметра или значения конфигурации службы `ServerStickyMode` в значение `Required`. Для получения дополнительной информации см. <xref:host-and-deploy/blazor/server#signalr-configuration>.

При использовании служб IIS прикрепленные сеансы включаются с помощью маршрутизации запросов приложений. Дополнительные сведения см. в статье [Балансировка нагрузки HTTP с помощью маршрутизации запросов приложений](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing).

## <a name="additional-resources"></a>Дополнительные ресурсы

* <xref:blazor/get-started>
* <xref:signalr/introduction>
* <xref:blazor/hosting-model-configuration>
* <xref:tutorials/signalr-blazor-webassembly>
