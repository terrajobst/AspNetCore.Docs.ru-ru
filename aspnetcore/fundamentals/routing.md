---
title: Маршрутизация в ASP.NET Core
author: ardalis
description: Узнайте, как функции маршрутизации ASP.NET Core обеспечивают сопоставление входящего запроса с обработчиком маршрутов.
ms.author: riande
ms.date: 10/14/2016
uid: fundamentals/routing
ms.openlocfilehash: 4482c865671eb4f5decbd5f1cd6e26f2e68e5c25
ms.sourcegitcommit: e22097b84d26a812cd1380a6b2d12c93e522c125
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/22/2018
ms.locfileid: "36314140"
---
# <a name="routing-in-aspnet-core"></a><span data-ttu-id="67685-103">Маршрутизация в ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="67685-103">Routing in ASP.NET Core</span></span>

<span data-ttu-id="67685-104">Авторы: [Райан Новак](https://github.com/rynowak) (Ryan Nowak), [Стив Смит](https://ardalis.com/) (Steve Smith) и [Рик Андерсон](https://twitter.com/RickAndMSFT) (Rick Anderson)</span><span class="sxs-lookup"><span data-stu-id="67685-104">By [Ryan Nowak](https://github.com/rynowak), [Steve Smith](https://ardalis.com/), and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="67685-105">Функция маршрутизации обеспечивает сопоставление входящего запроса с обработчиком маршрутов.</span><span class="sxs-lookup"><span data-stu-id="67685-105">Routing functionality is responsible for mapping an incoming request to a route handler.</span></span> <span data-ttu-id="67685-106">Маршруты определяются в приложении ASP.NET и настраиваются при его запуске.</span><span class="sxs-lookup"><span data-stu-id="67685-106">Routes are defined in the ASP.NET app and configured when the app starts up.</span></span> <span data-ttu-id="67685-107">Маршрут может также извлекать значения из содержащегося в запросе URL-адреса, которые затем используются для обработки запроса.</span><span class="sxs-lookup"><span data-stu-id="67685-107">A route can optionally extract values from the URL contained in the request, and these values can then be used for request processing.</span></span> <span data-ttu-id="67685-108">С помощью сведений о маршрутах из приложения ASP.NET функция маршрутизации также может формировать URL-адреса, сопоставленные с обработчиками маршрутов.</span><span class="sxs-lookup"><span data-stu-id="67685-108">Using route information from the ASP.NET app, the routing functionality is also able to generate URLs that map to route handlers.</span></span> <span data-ttu-id="67685-109">Таким образом, маршрутизация позволяет находить обработчик маршрутов по URL-адресу или URL-адрес, соответствующий определенному обработчику маршрутов, на основе сведений об обработчике.</span><span class="sxs-lookup"><span data-stu-id="67685-109">Therefore, routing can find a route handler based on a URL, or the URL corresponding to a given route handler based on route handler information.</span></span>

>[!IMPORTANT]
> <span data-ttu-id="67685-110">В этом документе рассматривается низкоуровневая маршрутизация ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="67685-110">This document covers the low level ASP.NET Core routing.</span></span> <span data-ttu-id="67685-111">Сведения о маршрутизации ASP.NET Core MVC см. в статье [Маршрутизация к действиям контроллера](../mvc/controllers/routing.md)</span><span class="sxs-lookup"><span data-stu-id="67685-111">For ASP.NET Core MVC routing, see [Route to controller actions](../mvc/controllers/routing.md)</span></span>

<span data-ttu-id="67685-112">[Просмотреть или скачать образец кода](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/routing/sample) ([как скачивать](xref:tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="67685-112">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/routing/sample) ([how to download](xref:tutorials/index#how-to-download-a-sample))</span></span>

## <a name="routing-basics"></a><span data-ttu-id="67685-113">Основы маршрутизации</span><span class="sxs-lookup"><span data-stu-id="67685-113">Routing basics</span></span>

<span data-ttu-id="67685-114">Маршрутизация использует *маршруты* (реализации интерфейса [IRouter](/dotnet/api/microsoft.aspnetcore.routing.irouter)) в следующих целях:</span><span class="sxs-lookup"><span data-stu-id="67685-114">Routing uses *routes* (implementations of [IRouter](/dotnet/api/microsoft.aspnetcore.routing.irouter)) to:</span></span>

* <span data-ttu-id="67685-115">для сопоставления входящих запросов с *обработчиками маршрутов*;</span><span class="sxs-lookup"><span data-stu-id="67685-115">map incoming requests to *route handlers*</span></span>

* <span data-ttu-id="67685-116">для создания URL-адресов, используемых в ответах.</span><span class="sxs-lookup"><span data-stu-id="67685-116">generate URLs used in responses</span></span>

<span data-ttu-id="67685-117">Как правило, приложение имеет одну коллекцию маршрутов.</span><span class="sxs-lookup"><span data-stu-id="67685-117">Generally, an app has a single collection of routes.</span></span> <span data-ttu-id="67685-118">При поступлении запроса коллекция маршрутов обрабатывается по порядку.</span><span class="sxs-lookup"><span data-stu-id="67685-118">When a request arrives, the route collection is processed in order.</span></span> <span data-ttu-id="67685-119">Входящий запрос ищет маршрут, соответствующий URL-адресу запроса, вызывая метод `RouteAsync` для каждого маршрута, имеющегося в коллекции маршрутов.</span><span class="sxs-lookup"><span data-stu-id="67685-119">The incoming request looks for a route that matches the request URL by calling the `RouteAsync` method on each available route in the route collection.</span></span> <span data-ttu-id="67685-120">В свою очередь, ответ может использовать маршрутизацию для формирования URL-адресов (например, для перенаправления или ссылок) на основе сведений о маршрутах, что позволяет избежать жесткого задания URL-адресов и упрощает поддержку.</span><span class="sxs-lookup"><span data-stu-id="67685-120">By contrast, a response can use routing to generate URLs (for example, for redirection or links) based on route information, and thus avoid having to hard-code URLs, which helps maintainability.</span></span>

<span data-ttu-id="67685-121">Функция маршрутизации подключается к конвейеру [ПО промежуточного слоя](xref:fundamentals/middleware/index) с помощью класса `RouterMiddleware`.</span><span class="sxs-lookup"><span data-stu-id="67685-121">Routing is connected to the [middleware](xref:fundamentals/middleware/index) pipeline by the `RouterMiddleware` class.</span></span> <span data-ttu-id="67685-122">[ASP.NET Core MVC](xref:mvc/overview) добавляет функцию маршрутизации в конвейер ПО промежуточного слоя в процессе настройки.</span><span class="sxs-lookup"><span data-stu-id="67685-122">[ASP.NET Core MVC](xref:mvc/overview) adds routing to the middleware pipeline as part of its configuration.</span></span> <span data-ttu-id="67685-123">Сведения об использовании маршрутизации в виде отдельного компонента см. в руководстве по [использованию ПО промежуточного слоя маршрутизации](#using-routing-middleware).</span><span class="sxs-lookup"><span data-stu-id="67685-123">To learn about using routing as a standalone component, see [Using routing middleware](#using-routing-middleware).</span></span>

<a name="url-matching-ref"></a>

### <a name="url-matching"></a><span data-ttu-id="67685-124">Соответствие URL-адресов</span><span class="sxs-lookup"><span data-stu-id="67685-124">URL matching</span></span>

<span data-ttu-id="67685-125">Соответствие URL-адресов — это процесс, с помощью которого функция маршрутизации отправляет входящий запрос в *обработчик*.</span><span class="sxs-lookup"><span data-stu-id="67685-125">URL matching is the process by which routing dispatches an incoming request to a *handler*.</span></span> <span data-ttu-id="67685-126">Как правило, он основывается на данных в пути URL-адреса, но может быть расширен для учета любых данных в запросе.</span><span class="sxs-lookup"><span data-stu-id="67685-126">This process is generally based on data in the URL path, but can be extended to consider any data in the request.</span></span> <span data-ttu-id="67685-127">Возможность отправки запросов в отдельные обработчики имеет первостепенное значение для масштабирования размера и сложности приложения.</span><span class="sxs-lookup"><span data-stu-id="67685-127">The ability to dispatch requests to separate handlers is key to scaling the size and complexity of an application.</span></span>

<span data-ttu-id="67685-128">Входящие запросы поступают в объект `RouterMiddleware`, который вызывает метод `RouteAsync` для каждого маршрута по порядку.</span><span class="sxs-lookup"><span data-stu-id="67685-128">Incoming requests enter the `RouterMiddleware`, which calls the `RouteAsync` method on each route in sequence.</span></span> <span data-ttu-id="67685-129">Экземпляр `IRouter` решает, следует ли *обрабатывать* запрос, присваивая свойству `RouteContext.Handler` значение `RequestDelegate`, отличное от NULL.</span><span class="sxs-lookup"><span data-stu-id="67685-129">The `IRouter` instance chooses whether to *handle* the request by setting the `RouteContext.Handler` to a non-null `RequestDelegate`.</span></span> <span data-ttu-id="67685-130">Если маршрут задает обработчик для запроса, обработка маршрутов останавливается и обработчик вызывается для обработки запроса.</span><span class="sxs-lookup"><span data-stu-id="67685-130">If a route sets a handler for the request, route processing stops and the handler will be invoked to process the request.</span></span> <span data-ttu-id="67685-131">Если были проверены все маршруты, но обработчик для запроса не найден, ПО промежуточного слоя вызывает *next* и вызывается следующее ПО промежуточного слоя в конвейере запросов.</span><span class="sxs-lookup"><span data-stu-id="67685-131">If all routes are tried and no handler is found for the request, the middleware calls *next* and the next middleware in the request pipeline is invoked.</span></span>

<span data-ttu-id="67685-132">Основные входные данные метода `RouteAsync` — это объект `RouteContext.HttpContext`, связанный с текущим запросом.</span><span class="sxs-lookup"><span data-stu-id="67685-132">The primary input to `RouteAsync` is the `RouteContext.HttpContext` associated with the current request.</span></span> <span data-ttu-id="67685-133">`RouteContext.Handler` и `RouteContext.RouteData` — это выходные данные, которые задаются после нахождения соответствующего маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-133">The `RouteContext.Handler` and `RouteContext.RouteData` are outputs that will be set after a route matches.</span></span>

<span data-ttu-id="67685-134">При нахождении соответствия во время выполнения метода `RouteAsync` свойствам объекта `RouteContext.RouteData` также присваиваются значения с учетом уже выполненной на данный момент обработки.</span><span class="sxs-lookup"><span data-stu-id="67685-134">A match during `RouteAsync` will also set the properties of the `RouteContext.RouteData` to appropriate values based on the request processing done so far.</span></span> <span data-ttu-id="67685-135">Если маршрут соответствует запросу, объект `RouteContext.RouteData` будет содержать важные сведения о *результате*.</span><span class="sxs-lookup"><span data-stu-id="67685-135">If a route matches a request, the `RouteContext.RouteData` will contain important state information about the *result*.</span></span>

<span data-ttu-id="67685-136">`RouteData.Values` — это словарь *значений маршрута*, полученных из маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-136">`RouteData.Values` is a dictionary of *route values* produced from the route.</span></span> <span data-ttu-id="67685-137">Как правило, эти значения определяются путем разбивки URL-адреса на сегменты и могут использоваться для принятия входных данных пользователя или принятия дальнейших решений об отправке в приложении.</span><span class="sxs-lookup"><span data-stu-id="67685-137">These values are usually determined by tokenizing the URL, and can be used to accept user input, or to make further dispatching decisions inside the application.</span></span>

<span data-ttu-id="67685-138">`RouteData.DataTokens` — это контейнер свойств с дополнительными данными, связанными с соответствующим маршрутом.</span><span class="sxs-lookup"><span data-stu-id="67685-138">`RouteData.DataTokens`  is a property bag of additional data related to the matched route.</span></span> <span data-ttu-id="67685-139">Свойства `DataTokens` обеспечивают связывание данных состояния с каждым маршрутом, что позволяет приложению в дальнейшем принимать решения в зависимости от соответствующего маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-139">`DataTokens` are provided to support associating state data with each route so the application can make decisions later based on which route matched.</span></span> <span data-ttu-id="67685-140">Эти значения определяются разработчиком и никоим образом **не** влияют на поведение маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="67685-140">These values are developer-defined and do **not** affect the behavior of routing in any way.</span></span> <span data-ttu-id="67685-141">Кроме того, значения, спрятанные в токенах данных, могут быть любого типа в отличие от значений маршрутов, которые должны легко преобразовываться в строки и из строк.</span><span class="sxs-lookup"><span data-stu-id="67685-141">Additionally, values stashed in data tokens can be of any type, in contrast to route values, which must be easily convertible to and from strings.</span></span>

<span data-ttu-id="67685-142">`RouteData.Routers` — это список маршрутов, которые участвовали в успешном сопоставлении с запросом.</span><span class="sxs-lookup"><span data-stu-id="67685-142">`RouteData.Routers` is a list of the routes that took part in successfully matching the request.</span></span> <span data-ttu-id="67685-143">Маршруты могут быть вложенными друг в друга. Свойство `Routers` отражает путь по логическому дереву маршрутов, который привел к совпадению.</span><span class="sxs-lookup"><span data-stu-id="67685-143">Routes can be nested inside one another, and the `Routers` property reflects the path through the logical tree of routes that resulted in a match.</span></span> <span data-ttu-id="67685-144">Как правило, первый элемент в свойстве `Routers` — это коллекция маршрутов, используемая для формирования URL-адресов.</span><span class="sxs-lookup"><span data-stu-id="67685-144">Generally the first item in `Routers` is the route collection, and should be used for URL generation.</span></span> <span data-ttu-id="67685-145">Последний элемент в свойстве `Routers` — это соответствующий обработчик маршрутов.</span><span class="sxs-lookup"><span data-stu-id="67685-145">The last item in `Routers` is the route handler that matched.</span></span>

### <a name="url-generation"></a><span data-ttu-id="67685-146">Формирование URL-адреса</span><span class="sxs-lookup"><span data-stu-id="67685-146">URL generation</span></span>

<span data-ttu-id="67685-147">Формирование URL-адреса — это процесс создания пути URL-адреса функцией маршрутизации на основе набора значений маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-147">URL generation is the process by which routing can create a URL path based on a set of route values.</span></span> <span data-ttu-id="67685-148">Он обеспечивает логическое разделение обработчиков и URL-адресов, по которым к ним осуществляется доступ.</span><span class="sxs-lookup"><span data-stu-id="67685-148">This allows for a logical separation between your handlers and the URLs that access them.</span></span>

<span data-ttu-id="67685-149">Формирование URL-адреса — это итеративный процесс, который начинается с того, что пользовательский код или код платформы вызывает метод `GetVirtualPath` коллекции маршрутов.</span><span class="sxs-lookup"><span data-stu-id="67685-149">URL generation follows a similar iterative process, but starts with user or framework code calling into the `GetVirtualPath` method of the route collection.</span></span> <span data-ttu-id="67685-150">Затем по очереди вызывается метод `GetVirtualPath` каждого *маршрута*, пока не будет возвращен объект `VirtualPathData`, отличный от NULL.</span><span class="sxs-lookup"><span data-stu-id="67685-150">Each *route* will then have its `GetVirtualPath` method called in sequence until a non-null `VirtualPathData` is returned.</span></span>

<span data-ttu-id="67685-151">Основные входные параметры метода `GetVirtualPath`:</span><span class="sxs-lookup"><span data-stu-id="67685-151">The primary inputs to `GetVirtualPath` are:</span></span>

* `VirtualPathContext.HttpContext`

* `VirtualPathContext.Values`

* `VirtualPathContext.AmbientValues`

<span data-ttu-id="67685-152">Для определения возможности создания URL-адреса и включаемых значений в первую очередь используются значения, передаваемые в свойствах `Values` и `AmbientValues`.</span><span class="sxs-lookup"><span data-stu-id="67685-152">Routes primarily use the route values provided by the `Values` and `AmbientValues` to decide where it's possible to generate a URL and what values to include.</span></span> <span data-ttu-id="67685-153">`AmbientValues` — это набор значений маршрута, полученных в результате сопоставления текущего запроса с системой маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="67685-153">The `AmbientValues` are the set of route values that were produced from matching the current request with the routing system.</span></span> <span data-ttu-id="67685-154">В свою очередь, `Values` — это значения, определяющие способ создания нужного URL-адреса для текущей операции.</span><span class="sxs-lookup"><span data-stu-id="67685-154">In contrast, `Values` are the route values that specify how to generate the desired URL for the current operation.</span></span> <span data-ttu-id="67685-155">`HttpContext` предоставляется в том случае, если маршруту необходимо получить службы или дополнительные данные, связанные с текущим контекстом.</span><span class="sxs-lookup"><span data-stu-id="67685-155">The `HttpContext` is provided in case a route needs to get services or additional data associated with the current context.</span></span>

<span data-ttu-id="67685-156">Совет. Свойство `Values` можно представить как набор переопределений для `AmbientValues`.</span><span class="sxs-lookup"><span data-stu-id="67685-156">Tip: Think of `Values` as being a set of overrides for the `AmbientValues`.</span></span> <span data-ttu-id="67685-157">При формировании URL-адреса производится попытка повторного использования значений маршрута из текущего запроса, что упрощает создание URL-адресов для ссылок с помощью того же маршрута или значений маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-157">URL generation tries to reuse route values from the current request to make it easy to generate URLs for links using the same route or route values.</span></span>

<span data-ttu-id="67685-158">Выходные данные метода `GetVirtualPath` содержатся в объекте `VirtualPathData`.</span><span class="sxs-lookup"><span data-stu-id="67685-158">The output of `GetVirtualPath` is a `VirtualPathData`.</span></span> <span data-ttu-id="67685-159">Объект `VirtualPathData` аналогичен `RouteData`. Он содержит `VirtualPath` для выходного URL-адреса, а также ряд дополнительных свойств, которые должны быть заданы маршрутом.</span><span class="sxs-lookup"><span data-stu-id="67685-159">`VirtualPathData` is a parallel of `RouteData`; it contains the `VirtualPath` for the output URL and some additional properties that should be set by the route.</span></span>

<span data-ttu-id="67685-160">Свойство `VirtualPathData.VirtualPath` содержит *виртуальный путь*, создаваемый маршрутом.</span><span class="sxs-lookup"><span data-stu-id="67685-160">The `VirtualPathData.VirtualPath` property contains the *virtual path* produced by the route.</span></span> <span data-ttu-id="67685-161">В зависимости от ситуации путь может требовать дальнейшей обработки.</span><span class="sxs-lookup"><span data-stu-id="67685-161">Depending on your needs you may need to process the path further.</span></span> <span data-ttu-id="67685-162">Например, чтобы представить созданный URL-адрес в формате HTML, необходимо добавить в его начало базовый путь приложения.</span><span class="sxs-lookup"><span data-stu-id="67685-162">For instance, if you want to render the generated URL in HTML you need to prepend the base path of the application.</span></span>

<span data-ttu-id="67685-163">`VirtualPathData.Router` — это ссылка на маршрут, который успешно создал URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="67685-163">The `VirtualPathData.Router` is a reference to the route that successfully generated the URL.</span></span>

<span data-ttu-id="67685-164">Свойства `VirtualPathData.DataTokens` представляют собой словарь дополнительных данных, связанных с маршрутом, который создал URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="67685-164">The `VirtualPathData.DataTokens` properties is a dictionary of additional data related to the route that generated the URL.</span></span> <span data-ttu-id="67685-165">Это эквивалент объекта `RouteData.DataTokens`.</span><span class="sxs-lookup"><span data-stu-id="67685-165">This is the parallel of `RouteData.DataTokens`.</span></span>

### <a name="creating-routes"></a><span data-ttu-id="67685-166">Создание маршрутов</span><span class="sxs-lookup"><span data-stu-id="67685-166">Creating routes</span></span>

<span data-ttu-id="67685-167">Маршрутизация предоставляет класс `Route` в качестве стандартной реализации `IRouter`.</span><span class="sxs-lookup"><span data-stu-id="67685-167">Routing provides the `Route` class as the standard implementation of `IRouter`.</span></span> <span data-ttu-id="67685-168">Класс `Route` использует синтаксис *шаблона маршрута* для определения шаблонов, которые будут сопоставляться с путем URL-адреса при вызове метода `RouteAsync`.</span><span class="sxs-lookup"><span data-stu-id="67685-168">`Route` uses the *route template* syntax to define patterns that will match against the URL path when `RouteAsync` is called.</span></span> <span data-ttu-id="67685-169">При вызове метода `GetVirtualPath` объект `Route` будет использовать тот же шаблон маршрута для создания URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="67685-169">`Route` will use the same route template to generate a URL when `GetVirtualPath` is called.</span></span>

<span data-ttu-id="67685-170">Большинство приложений создают маршруты, вызывая метод `MapRoute` или один из аналогичных методов расширения, определенных в интерфейсе `IRouteBuilder`.</span><span class="sxs-lookup"><span data-stu-id="67685-170">Most applications will create routes by calling `MapRoute` or one of the similar extension methods defined on `IRouteBuilder`.</span></span> <span data-ttu-id="67685-171">Все эти методы создают экземпляр класса `Route` и добавляют его в коллекцию маршрутов.</span><span class="sxs-lookup"><span data-stu-id="67685-171">All of these methods will create an instance of `Route` and add it to the route collection.</span></span>

<span data-ttu-id="67685-172">Примечание. Метод `MapRoute` не принимает параметр обработчика маршрутов. Он лишь добавляет маршруты, которые будут обрабатываться объектом `DefaultHandler`.</span><span class="sxs-lookup"><span data-stu-id="67685-172">Note: `MapRoute` doesn't take a route handler parameter - it only adds routes that will be handled by the `DefaultHandler`.</span></span> <span data-ttu-id="67685-173">Так как обработчик по умолчанию — это интерфейс `IRouter`, он может решить не обрабатывать запрос.</span><span class="sxs-lookup"><span data-stu-id="67685-173">Since the default handler is an `IRouter`, it may decide not to handle the request.</span></span> <span data-ttu-id="67685-174">Например, ASP.NET MVC обычно настраивается в качестве обработчика по умолчанию, который обрабатывает только те запросы, которые соответствуют доступным контроллеру и действию.</span><span class="sxs-lookup"><span data-stu-id="67685-174">For example, ASP.NET MVC is typically configured as a default handler that only handles requests that match an available controller and action.</span></span> <span data-ttu-id="67685-175">Дополнительные сведения о маршрутизации в MVC см. в статье [Маршрутизация к действиям контроллера](../mvc/controllers/routing.md).</span><span class="sxs-lookup"><span data-stu-id="67685-175">To learn more about routing to MVC, see [Route to controller actions](../mvc/controllers/routing.md).</span></span>

<span data-ttu-id="67685-176">Вот пример вызова `MapRoute`, используемого в типичном определении маршрута ASP.NET MVC:</span><span class="sxs-lookup"><span data-stu-id="67685-176">This is an example of a `MapRoute` call used by a typical ASP.NET MVC route definition:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="67685-177">Этот шаблон будет соответствовать такому пути URL-адреса, как `/Products/Details/17`, и будет извлекать значения маршрута `{ controller = Products, action = Details, id = 17 }`.</span><span class="sxs-lookup"><span data-stu-id="67685-177">This template will match a URL path like `/Products/Details/17` and extract the route values `{ controller = Products, action = Details, id = 17 }`.</span></span> <span data-ttu-id="67685-178">Значения маршрута определяются путем разделения пути URL-адреса на сегменты и сопоставлением каждого сегмента с именем *параметра маршрута* в шаблоне маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-178">The route values are determined by splitting the URL path into segments, and matching each segment with the *route parameter* name in the route template.</span></span> <span data-ttu-id="67685-179">Параметры маршрута являются именованными.</span><span class="sxs-lookup"><span data-stu-id="67685-179">Route parameters are named.</span></span> <span data-ttu-id="67685-180">Они определяются путем заключения имени параметра в фигурные скобки `{ }`.</span><span class="sxs-lookup"><span data-stu-id="67685-180">They're defined by enclosing the parameter name in braces `{ }`.</span></span>

<span data-ttu-id="67685-181">Приведенный выше шаблон может также соответствовать пути URL-адреса `/`. В этом случае он предоставляет значения `{ controller = Home, action = Index }`.</span><span class="sxs-lookup"><span data-stu-id="67685-181">The template above could also match the URL path `/` and would produce the values `{ controller = Home, action = Index }`.</span></span> <span data-ttu-id="67685-182">Связано это с тем, что параметры маршрута `{controller}` и `{action}` имеют значения по умолчанию, а параметр маршрута `id` является необязательным.</span><span class="sxs-lookup"><span data-stu-id="67685-182">This happens because the `{controller}` and `{action}` route parameters have default values, and the `id` route parameter is optional.</span></span> <span data-ttu-id="67685-183">Значение по умолчанию для параметра маршрута определяется с помощью знака равенства `=`, за которым следует значение, после имени параметра.</span><span class="sxs-lookup"><span data-stu-id="67685-183">An equals `=` sign followed by a value after the route parameter name defines a default value for the parameter.</span></span> <span data-ttu-id="67685-184">Вопросительный знак `?` после имени параметра маршрута определяет параметр как необязательный.</span><span class="sxs-lookup"><span data-stu-id="67685-184">A question mark `?` after the route parameter name defines the parameter as optional.</span></span> <span data-ttu-id="67685-185">Параметры маршрута со значением по умолчанию *всегда* предоставляют значения маршрута при соответствии маршрута. Необязательные параметры не предоставляют значений, если нет соответствующих сегментов в пути URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="67685-185">Route parameters with a default value *always* produce a route value when the route matches - optional parameters won't produce a route value if there was no corresponding URL path segment.</span></span>

<span data-ttu-id="67685-186">Подробное описание функций и синтаксиса шаблона маршрута см. в разделе [Справочник по шаблону маршрута](#route-template-reference).</span><span class="sxs-lookup"><span data-stu-id="67685-186">See [route-template-reference](#route-template-reference) for a thorough description of route template features and syntax.</span></span>

<span data-ttu-id="67685-187">В этом примере применяется *ограничение маршрута*:</span><span class="sxs-lookup"><span data-stu-id="67685-187">This example includes a *route constraint*:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id:int}");
```

<span data-ttu-id="67685-188">Этот шаблон соответствует такому пути URL-адреса, как `/Products/Details/17`, но не `/Products/Details/Apples`.</span><span class="sxs-lookup"><span data-stu-id="67685-188">This template will match a URL path like `/Products/Details/17`, but not `/Products/Details/Apples`.</span></span> <span data-ttu-id="67685-189">В определении параметра маршрута `{id:int}` определяется *ограничение маршрута* для параметра маршрута `id`.</span><span class="sxs-lookup"><span data-stu-id="67685-189">The route parameter definition `{id:int}` defines a *route constraint* for the `id` route parameter.</span></span> <span data-ttu-id="67685-190">Ограничения маршрута реализуют интерфейс `IRouteConstraint` и проверяют значения маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-190">Route constraints implement `IRouteConstraint` and inspect route values to verify them.</span></span> <span data-ttu-id="67685-191">В этом примере значение маршрута `id` должно иметь возможность преобразования в целое число.</span><span class="sxs-lookup"><span data-stu-id="67685-191">In this example the route value `id` must be convertible to an integer.</span></span> <span data-ttu-id="67685-192">Более подробное описание ограничений маршрутов, предоставляемых платформой, см. в разделе [Справочник по ограничениям маршрутов](#route-constraint-reference).</span><span class="sxs-lookup"><span data-stu-id="67685-192">See [route-constraint-reference](#route-constraint-reference) for a more detailed explanation of route constraints that are provided by the framework.</span></span>

<span data-ttu-id="67685-193">Дополнительные перегрузки `MapRoute` принимают значения для параметров `constraints`, `dataTokens` и `defaults`.</span><span class="sxs-lookup"><span data-stu-id="67685-193">Additional overloads of `MapRoute` accept values for `constraints`, `dataTokens`, and `defaults`.</span></span> <span data-ttu-id="67685-194">Эти дополнительные параметры метода `MapRoute` определены как имеющие тип `object`.</span><span class="sxs-lookup"><span data-stu-id="67685-194">These additional parameters of `MapRoute` are defined as type `object`.</span></span> <span data-ttu-id="67685-195">Типичное применение этих параметров состоит в передаче анонимно типизированного объекта, причем имена свойств анонимного типа соответствуют именам параметров маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-195">The typical usage of these parameters is to pass an anonymously typed object, where the property names of the anonymous type match route parameter names.</span></span>

<span data-ttu-id="67685-196">В двух следующих примерах создаются эквивалентные маршруты:</span><span class="sxs-lookup"><span data-stu-id="67685-196">The following two examples create equivalent routes:</span></span>

```csharp
routes.MapRoute(
    name: "default_route",
    template: "{controller}/{action}/{id?}",
    defaults: new { controller = "Home", action = "Index" });

routes.MapRoute(
    name: "default_route",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="67685-197">Совет. Встроенный синтаксис определения ограничений и значений по умолчанию может быть удобнее для простых маршрутов.</span><span class="sxs-lookup"><span data-stu-id="67685-197">Tip: The inline syntax for defining constraints and defaults can be more convenient for simple routes.</span></span> <span data-ttu-id="67685-198">Однако некоторые возможности, например токены данных, не поддерживаются встроенным синтаксисом.</span><span class="sxs-lookup"><span data-stu-id="67685-198">However, there are features such as data tokens which are not supported by inline syntax.</span></span>

<span data-ttu-id="67685-199">В этом примере представлен еще ряд возможностей:</span><span class="sxs-lookup"><span data-stu-id="67685-199">This example demonstrates a few more features:</span></span>

```csharp
routes.MapRoute(
  name: "blog",
  template: "Blog/{*article}",
  defaults: new { controller = "Blog", action = "ReadArticle" });
```

<span data-ttu-id="67685-200">Этот шаблон будет соответствовать такому пути URL-адреса, как `/Blog/All-About-Routing/Introduction`, и будет извлекать значения `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span><span class="sxs-lookup"><span data-stu-id="67685-200">This template will match a URL path like `/Blog/All-About-Routing/Introduction` and will extract the values `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span></span> <span data-ttu-id="67685-201">Значения маршрута по умолчанию для `controller` и `action` предоставляются маршрутом несмотря на то, что в шаблоне нет соответствующих параметров маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-201">The default route values for `controller` and `action` are produced by the route even though there are no corresponding route parameters in the template.</span></span> <span data-ttu-id="67685-202">Значения по умолчанию можно указать в шаблоне маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-202">Default values can be specified in the route template.</span></span> <span data-ttu-id="67685-203">Параметр маршрута `article` определяется как *универсальный* с помощью звездочки `*` перед его именем.</span><span class="sxs-lookup"><span data-stu-id="67685-203">The `article` route parameter is defined as a *catch-all* by the appearance of an asterisk `*` before the route parameter name.</span></span> <span data-ttu-id="67685-204">Универсальные параметры маршрута служат для фиксации оставшейся части пути URL-адреса, а также могут соответствовать пустой строке.</span><span class="sxs-lookup"><span data-stu-id="67685-204">Catch-all route parameters capture the remainder of the URL path, and can also match the empty string.</span></span>

<span data-ttu-id="67685-205">В этом примере добавляются ограничения маршрута и токены данных:</span><span class="sxs-lookup"><span data-stu-id="67685-205">This example adds route constraints and data tokens:</span></span>

```csharp
routes.MapRoute(
    name: "us_english_products",
    template: "en-US/Products/{id}",
    defaults: new { controller = "Products", action = "Details" },
    constraints: new { id = new IntRouteConstraint() },
    dataTokens: new { locale = "en-US" });
```

<span data-ttu-id="67685-206">Этот шаблон будет соответствовать такому пути URL-адреса, как `/en-US/Products/5`, и будет извлекать значения `{ controller = Products, action = Details, id = 5 }` и токены данных `{ locale = en-US }`.</span><span class="sxs-lookup"><span data-stu-id="67685-206">This template matches a URL path like `/en-US/Products/5` and extracts the values `{ controller = Products, action = Details, id = 5 }` and the data tokens `{ locale = en-US }`.</span></span>

![Токены в окне "Локальные"](routing/_static/tokens.png)

<a name="id1"></a>

### <a name="url-generation"></a><span data-ttu-id="67685-208">Формирование URL-адреса</span><span class="sxs-lookup"><span data-stu-id="67685-208">URL generation</span></span>

<span data-ttu-id="67685-209">Класс `Route` может также формировать URL-адрес, объединяя набор значений маршрута с шаблоном маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-209">The `Route` class can also perform URL generation by combining a set of route values with its route template.</span></span> <span data-ttu-id="67685-210">С логической точки зрения, этот процесс обратен сопоставлению пути URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="67685-210">This is logically the reverse process of matching the URL path.</span></span>

<span data-ttu-id="67685-211">Совет. Чтобы лучше понять процесс формирования URL-адреса, представьте себе, какой URL-адрес нужно создать, а затем подумайте, как шаблон маршрута будет сопоставляться с этим URL-адресом.</span><span class="sxs-lookup"><span data-stu-id="67685-211">Tip: To better understand URL generation, imagine what URL you want to generate and then think about how a route template would match that URL.</span></span> <span data-ttu-id="67685-212">Какие значения будут получены?</span><span class="sxs-lookup"><span data-stu-id="67685-212">What values would be produced?</span></span> <span data-ttu-id="67685-213">Примерно так производится формирование URL-адреса в классе `Route`.</span><span class="sxs-lookup"><span data-stu-id="67685-213">This is the rough equivalent of how URL generation works in the `Route` class.</span></span>

<span data-ttu-id="67685-214">В этом примере используется базовый маршрут в стиле ASP.NET MVC:</span><span class="sxs-lookup"><span data-stu-id="67685-214">This example uses a basic ASP.NET MVC style route:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="67685-215">При значениях маршрута `{ controller = Products, action = List }` этот маршрут создаст URL-адрес `/Products/List`.</span><span class="sxs-lookup"><span data-stu-id="67685-215">With the route values `{ controller = Products, action = List }`, this route will generate the URL `/Products/List`.</span></span> <span data-ttu-id="67685-216">Значения маршрута заменяются на соответствующие параметры маршрута для образования пути URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="67685-216">The route values are substituted for the corresponding route parameters to form the URL path.</span></span> <span data-ttu-id="67685-217">Так как `id` — это необязательный параметр маршрута, отсутствие у него значения не представляет проблемы.</span><span class="sxs-lookup"><span data-stu-id="67685-217">Since `id` is an optional route parameter, it's no problem that it doesn't have a value.</span></span>

<span data-ttu-id="67685-218">При значениях маршрута `{ controller = Home, action = Index }` этот маршрут создаст URL-адрес `/`.</span><span class="sxs-lookup"><span data-stu-id="67685-218">With the route values `{ controller = Home, action = Index }`, this route will generate the URL `/`.</span></span> <span data-ttu-id="67685-219">Предоставленные значения маршрута соответствуют значениям по умолчанию, поэтому соответствующие им сегменты можно спокойно опустить.</span><span class="sxs-lookup"><span data-stu-id="67685-219">The route values that were provided match the default values so the segments corresponding to those values can be safely omitted.</span></span> <span data-ttu-id="67685-220">Обратите внимание на то, что оба созданных URL-адреса будут совершать круговой путь с таким определением маршрута и предоставлять те же значения маршрута, которые использовались для формирования URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="67685-220">Note that both URLs generated would round-trip with this route definition and produce the same route values that were used to generate the URL.</span></span>

<span data-ttu-id="67685-221">Совет. Приложение, использующее платформу ASP.NET MVC, должно создавать URL-адреса с помощью объекта `UrlHelper`, а не вызывать маршрутизацию напрямую.</span><span class="sxs-lookup"><span data-stu-id="67685-221">Tip: An app using ASP.NET MVC should use `UrlHelper` to generate URLs instead of calling into routing directly.</span></span>

<span data-ttu-id="67685-222">Дополнительные сведения о процессе формирования URL-адреса см. в разделе [Справочник по формированию URL-адресов](#url-generation-reference).</span><span class="sxs-lookup"><span data-stu-id="67685-222">For more details about the URL generation process, see [url-generation-reference](#url-generation-reference).</span></span>

## <a name="using-routing-middleware"></a><span data-ttu-id="67685-223">Использование ПО промежуточного слоя маршрутизации</span><span class="sxs-lookup"><span data-stu-id="67685-223">Using Routing Middleware</span></span>

<span data-ttu-id="67685-224">Добавьте пакет NuGet Microsoft.AspNetCore.Routing.</span><span class="sxs-lookup"><span data-stu-id="67685-224">Add the NuGet package "Microsoft.AspNetCore.Routing".</span></span>

<span data-ttu-id="67685-225">Добавьте маршрутизацию в контейнер службы в файле *Startup.cs*:</span><span class="sxs-lookup"><span data-stu-id="67685-225">Add routing to the service container in *Startup.cs*:</span></span>

[!code-csharp[](../fundamentals/routing/sample/RoutingSample/Startup.cs?highlight=3&start=11&end=14)]

<span data-ttu-id="67685-226">Маршруты должны настраиваться в методе `Configure` класса `Startup`.</span><span class="sxs-lookup"><span data-stu-id="67685-226">Routes must be configured in the `Configure` method in the `Startup` class.</span></span> <span data-ttu-id="67685-227">В приведенном ниже примере используются следующие интерфейсы API:</span><span class="sxs-lookup"><span data-stu-id="67685-227">The sample below uses these APIs:</span></span>

* `RouteBuilder`
* `Build`
* <span data-ttu-id="67685-228">`MapGet` — соответствует только HTTP-запросам GET</span><span class="sxs-lookup"><span data-stu-id="67685-228">`MapGet`  Matches only HTTP GET requests</span></span>
* `UseRouter`

```csharp
public void Configure(IApplicationBuilder app, ILoggerFactory loggerFactory)
{
    var trackPackageRouteHandler = new RouteHandler(context =>
    {
        var routeValues = context.GetRouteData().Values;
        return context.Response.WriteAsync(
            $"Hello! Route values: {string.Join(", ", routeValues)}");
    });

    var routeBuilder = new RouteBuilder(app, trackPackageRouteHandler);

    routeBuilder.MapRoute(
        "Track Package Route",
        "package/{operation:regex(^(track|create|detonate)$)}/{id:int}");

    routeBuilder.MapGet("hello/{name}", context =>
    {
        var name = context.GetRouteValue("name");
        // This is the route handler when HTTP GET "hello/<anything>"  matches
        // To match HTTP GET "hello/<anything>/<anything>,
        // use routeBuilder.MapGet("hello/{*name}"
        return context.Response.WriteAsync($"Hi, {name}!");
    });

    var routes = routeBuilder.Build();
    app.UseRouter(routes);
}
```

<span data-ttu-id="67685-229">В таблице ниже приведены ответы с данными универсальными кодами ресурсов (URI).</span><span class="sxs-lookup"><span data-stu-id="67685-229">The table below shows the responses with the given URIs.</span></span>

| <span data-ttu-id="67685-230">URI</span><span class="sxs-lookup"><span data-stu-id="67685-230">URI</span></span> | <span data-ttu-id="67685-231">Ответ</span><span class="sxs-lookup"><span data-stu-id="67685-231">Response</span></span>  |
| ------- | -------- |
| <span data-ttu-id="67685-232">/package/create/3</span><span class="sxs-lookup"><span data-stu-id="67685-232">/package/create/3</span></span>  | <span data-ttu-id="67685-233">Hello!</span><span class="sxs-lookup"><span data-stu-id="67685-233">Hello!</span></span> <span data-ttu-id="67685-234">Значения маршрута: [operation, create], [id, 3]</span><span class="sxs-lookup"><span data-stu-id="67685-234">Route values: [operation, create], [id, 3]</span></span> |
| <span data-ttu-id="67685-235">/package/track/-3</span><span class="sxs-lookup"><span data-stu-id="67685-235">/package/track/-3</span></span>  | <span data-ttu-id="67685-236">Hello!</span><span class="sxs-lookup"><span data-stu-id="67685-236">Hello!</span></span> <span data-ttu-id="67685-237">Значения маршрута: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="67685-237">Route values: [operation, track], [id, -3]</span></span> |
| <span data-ttu-id="67685-238">/package/track/-3/</span><span class="sxs-lookup"><span data-stu-id="67685-238">/package/track/-3/</span></span> | <span data-ttu-id="67685-239">Hello!</span><span class="sxs-lookup"><span data-stu-id="67685-239">Hello!</span></span> <span data-ttu-id="67685-240">Значения маршрута: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="67685-240">Route values: [operation, track], [id, -3]</span></span>  |
| <span data-ttu-id="67685-241">/package/track/</span><span class="sxs-lookup"><span data-stu-id="67685-241">/package/track/</span></span> | <span data-ttu-id="67685-242">\<Неудачно, нет совпадения></span><span class="sxs-lookup"><span data-stu-id="67685-242">\<Fall through, no match></span></span> |
| <span data-ttu-id="67685-243">GET /hello/Joe</span><span class="sxs-lookup"><span data-stu-id="67685-243">GET /hello/Joe</span></span> | <span data-ttu-id="67685-244">Hi, Joe!</span><span class="sxs-lookup"><span data-stu-id="67685-244">Hi, Joe!</span></span> |
| <span data-ttu-id="67685-245">POST /hello/Joe</span><span class="sxs-lookup"><span data-stu-id="67685-245">POST /hello/Joe</span></span> | <span data-ttu-id="67685-246">\<Неудачно, совпадение только с HTTP GET></span><span class="sxs-lookup"><span data-stu-id="67685-246">\<Fall through, matches HTTP GET only></span></span> |
| <span data-ttu-id="67685-247">GET /hello/Joe/Smith</span><span class="sxs-lookup"><span data-stu-id="67685-247">GET /hello/Joe/Smith</span></span> | <span data-ttu-id="67685-248">\<Неудачно, нет совпадения></span><span class="sxs-lookup"><span data-stu-id="67685-248">\<Fall through, no match></span></span> |

<span data-ttu-id="67685-249">Если вы настраиваете один маршрут, вызовите `app.UseRouter`, передав экземпляр `IRouter`.</span><span class="sxs-lookup"><span data-stu-id="67685-249">If you are configuring a single route, call `app.UseRouter` passing in an `IRouter` instance.</span></span> <span data-ttu-id="67685-250">Вызывать `RouteBuilder` не нужно.</span><span class="sxs-lookup"><span data-stu-id="67685-250">You won't need to call `RouteBuilder`.</span></span>

<span data-ttu-id="67685-251">Платформа предоставляет наборов методов расширения для создания маршрутов, включая следующие:</span><span class="sxs-lookup"><span data-stu-id="67685-251">The framework provides a set of extension methods for creating routes such as:</span></span>

* `MapRoute`
* `MapGet`
* `MapPost`
* `MapPut`
* `MapDelete`
* `MapVerb`

<span data-ttu-id="67685-252">Некоторые из этих методов, например `MapGet`, требуют предоставления `RequestDelegate`.</span><span class="sxs-lookup"><span data-stu-id="67685-252">Some of these methods such as `MapGet` require a `RequestDelegate` to be provided.</span></span> <span data-ttu-id="67685-253">`RequestDelegate` будет использоваться в качестве *обработчика маршрутов* при совпадении маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-253">The `RequestDelegate` will be used as the *route handler* when the route matches.</span></span> <span data-ttu-id="67685-254">Другие методы из этого семейства позволяют настраивать конвейер ПО промежуточного слоя, который будет использоваться в качестве обработчика маршрутов.</span><span class="sxs-lookup"><span data-stu-id="67685-254">Other methods in this family allow configuring a middleware pipeline which will be used as the route handler.</span></span> <span data-ttu-id="67685-255">Если метод *Map* не принимает обработчик, например `MapRoute`, он будет использовать объект `DefaultHandler`.</span><span class="sxs-lookup"><span data-stu-id="67685-255">If the *Map* method doesn't accept a handler, such as `MapRoute`, then it will use the `DefaultHandler`.</span></span>

<span data-ttu-id="67685-256">Методы `Map[Verb]` используют ограничения, чтобы ограничить маршрут к HTTP-команде в имени метода.</span><span class="sxs-lookup"><span data-stu-id="67685-256">The `Map[Verb]` methods use constraints to limit the route to the HTTP Verb in the method name.</span></span> <span data-ttu-id="67685-257">Например, см. описание методов [MapGet](https://github.com/aspnet/Routing/blob/1.0.0/src/Microsoft.AspNetCore.Routing/RequestDelegateRouteBuilderExtensions.cs#L85-L88) и [MapVerb](https://github.com/aspnet/Routing/blob/1.0.0/src/Microsoft.AspNetCore.Routing/RequestDelegateRouteBuilderExtensions.cs#L156-L180).</span><span class="sxs-lookup"><span data-stu-id="67685-257">For example, see [MapGet](https://github.com/aspnet/Routing/blob/1.0.0/src/Microsoft.AspNetCore.Routing/RequestDelegateRouteBuilderExtensions.cs#L85-L88) and [MapVerb](https://github.com/aspnet/Routing/blob/1.0.0/src/Microsoft.AspNetCore.Routing/RequestDelegateRouteBuilderExtensions.cs#L156-L180).</span></span>

## <a name="route-template-reference"></a><span data-ttu-id="67685-258">Справочник по шаблону маршрута</span><span class="sxs-lookup"><span data-stu-id="67685-258">Route Template Reference</span></span>

<span data-ttu-id="67685-259">Токены в фигурных скобках (`{ }`) определяют *параметры маршрута*, которые будут привязаны при совпадении маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-259">Tokens within curly braces (`{ }`) define *route parameters* which will be bound if the route is matched.</span></span> <span data-ttu-id="67685-260">В сегменте маршрута можно определить несколько параметров маршрута, но они должны разделяться литеральным значением.</span><span class="sxs-lookup"><span data-stu-id="67685-260">You can define more than one route parameter in a route segment, but they must be separated by a literal value.</span></span> <span data-ttu-id="67685-261">Например, `{controller=Home}{action=Index}` будет недопустимым маршрутом, так как между `{controller}` и `{action}` нет литерального значения.</span><span class="sxs-lookup"><span data-stu-id="67685-261">For example `{controller=Home}{action=Index}` wouldn't be a valid route, since there's no literal value between `{controller}` and `{action}`.</span></span> <span data-ttu-id="67685-262">Эти параметры маршрута должны иметь имена, и для них могут быть определены дополнительные атрибуты.</span><span class="sxs-lookup"><span data-stu-id="67685-262">These route parameters must have a name, and may have additional attributes specified.</span></span>

<span data-ttu-id="67685-263">Весь текст, кроме параметров маршрута (например, `{id}`) и разделителя пути `/`, должен соответствовать тексту в URL-адресе.</span><span class="sxs-lookup"><span data-stu-id="67685-263">Literal text other than route parameters (for example, `{id}`) and the path separator `/` must match the text in the URL.</span></span> <span data-ttu-id="67685-264">Сопоставление текста производится без учета регистра на основе декодированного представления путь URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="67685-264">Text matching is case-insensitive and based on the decoded representation of the URLs path.</span></span> <span data-ttu-id="67685-265">Для сопоставления с литеральным разделителем параметров маршрута `{` или `}` его следует экранировать путем повтора символа (`{{` или `}}`).</span><span class="sxs-lookup"><span data-stu-id="67685-265">To match the literal route parameter delimiter `{` or  `}`, escape it by repeating the character (`{{` or `}}`).</span></span>

<span data-ttu-id="67685-266">Шаблоны URL-адресов, которые пытаются получить имя файла с необязательным расширением, имеют свои особенности.</span><span class="sxs-lookup"><span data-stu-id="67685-266">URL patterns that attempt to capture a filename with an optional file extension have additional considerations.</span></span> <span data-ttu-id="67685-267">Например, если при использовании шаблона `files/{filename}.{ext?}` существуют и `filename`, и `ext`, заполняются оба значения.</span><span class="sxs-lookup"><span data-stu-id="67685-267">For example, using the template `files/{filename}.{ext?}` - When both `filename` and `ext` exist, both values will be populated.</span></span> <span data-ttu-id="67685-268">Если в URL-адресе есть только `filename`, маршрут совпадает, так как точка в конце `.` является необязательной.</span><span class="sxs-lookup"><span data-stu-id="67685-268">If only `filename` exists in the URL, the route matches because the trailing period `.` is  optional.</span></span> <span data-ttu-id="67685-269">Следующие URL-адреса соответствуют этому маршруту:</span><span class="sxs-lookup"><span data-stu-id="67685-269">The following URLs would match this route:</span></span>

* `/files/myFile.txt`
* `/files/myFile`

<span data-ttu-id="67685-270">Вы можете использовать символ `*` в качестве префикса параметра маршрута для привязки к остальной части универсального кода ресурса (URI) — такой параметр называется *универсальным*.</span><span class="sxs-lookup"><span data-stu-id="67685-270">You can use the `*` character as a prefix to a route parameter to bind to the rest of the URI - this is called a *catch-all* parameter.</span></span> <span data-ttu-id="67685-271">Например, `blog/{*slug}` будет соответствовать любому универсальному коду ресурса (URI), начинающемуся с сегмента `/blog`, за которым следует любое значение (присваиваемое в качестве значения маршрута `slug`).</span><span class="sxs-lookup"><span data-stu-id="67685-271">For example, `blog/{*slug}` would match any URI that started with `/blog` and had any value following it (which would be assigned to the `slug` route value).</span></span> <span data-ttu-id="67685-272">Универсальные параметры также могут соответствовать пустой строке.</span><span class="sxs-lookup"><span data-stu-id="67685-272">Catch-all parameters can also match the empty string.</span></span>

<span data-ttu-id="67685-273">Параметры маршрута могут иметь *значения по умолчанию*. Они указываются после имени параметра и знака равенства `=`.</span><span class="sxs-lookup"><span data-stu-id="67685-273">Route parameters may have *default values*, designated by specifying the default after the parameter name, separated by an `=`.</span></span> <span data-ttu-id="67685-274">Например, `{controller=Home}` определяет `Home` в качестве значения по умолчанию для `controller`.</span><span class="sxs-lookup"><span data-stu-id="67685-274">For example, `{controller=Home}` would define `Home` as the default value for `controller`.</span></span> <span data-ttu-id="67685-275">Значение по умолчанию используется, если для параметра нет значения в URL-адресе.</span><span class="sxs-lookup"><span data-stu-id="67685-275">The default value is used if no value is present in the URL for the parameter.</span></span> <span data-ttu-id="67685-276">Помимо значений по умолчанию, параметры маршрута могут быть необязательными (для этого необходимо добавить символ `?` в конец имени параметра, например `id?`).</span><span class="sxs-lookup"><span data-stu-id="67685-276">In addition to default values, route parameters may be optional (specified by appending a `?` to the end of the parameter name, as in `id?`).</span></span> <span data-ttu-id="67685-277">Различие между необязательными параметрами и параметрами со значениями по умолчанию в том, что вторые всегда имеют значения; необязательный параметр имеет значение, только если оно предоставлено.</span><span class="sxs-lookup"><span data-stu-id="67685-277">The difference between optional and "has default" is that a route parameter with a default value always produces a value; an optional parameter has a value only when one is provided.</span></span>

<span data-ttu-id="67685-278">Параметры маршрута также могут иметь ограничения, которые должны соответствовать значению маршрута из URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="67685-278">Route parameters may also have constraints, which must match the route value bound from the URL.</span></span> <span data-ttu-id="67685-279">Добавив двоеточие `:` и имя ограничения после имени параметра маршрута, можно указать *встроенные ограничения* для параметра маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-279">Adding a colon `:` and constraint name after the route parameter name specifies an *inline constraint* on a route parameter.</span></span> <span data-ttu-id="67685-280">Если ограничение требует аргументов, они указываются в скобках `( )` после имени ограничения.</span><span class="sxs-lookup"><span data-stu-id="67685-280">If the constraint requires arguments those are provided enclosed in parentheses `( )` after the constraint name.</span></span> <span data-ttu-id="67685-281">Чтобы указать несколько встроенных ограничений, добавьте еще одно двоеточие `:` и имя ограничения.</span><span class="sxs-lookup"><span data-stu-id="67685-281">Multiple inline constraints can be specified by appending another colon `:` and constraint name.</span></span> <span data-ttu-id="67685-282">Имя ограничения передается в службу `IInlineConstraintResolver` для создания экземпляра интерфейса `IRouteConstraint`, который будет использоваться при обработке URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="67685-282">The constraint name is passed to the `IInlineConstraintResolver` service to create an instance of `IRouteConstraint` to use in URL processing.</span></span> <span data-ttu-id="67685-283">Например, в шаблоне маршрута `blog/{article:minlength(10)}` определяется ограничение `minlength` с аргументом `10`.</span><span class="sxs-lookup"><span data-stu-id="67685-283">For example, the route template `blog/{article:minlength(10)}` specifies the `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="67685-284">Более подробное описание ограничений маршрутов и список ограничений, предоставляемых платформой, см. в разделе [Справочник по ограничениям маршрутов](#route-constraint-reference).</span><span class="sxs-lookup"><span data-stu-id="67685-284">For more description route constraints, and a listing of the constraints provided by the framework, see [route-constraint-reference](#route-constraint-reference).</span></span>

<span data-ttu-id="67685-285">В приведенной ниже таблице показаны некоторые шаблоны маршрутов и их поведение.</span><span class="sxs-lookup"><span data-stu-id="67685-285">The following table demonstrates some route templates and their behavior.</span></span>

| <span data-ttu-id="67685-286">Шаблон маршрута</span><span class="sxs-lookup"><span data-stu-id="67685-286">Route Template</span></span> | <span data-ttu-id="67685-287">Пример соответствующего URL-адреса</span><span class="sxs-lookup"><span data-stu-id="67685-287">Example Matching URL</span></span> | <span data-ttu-id="67685-288">Примечания</span><span class="sxs-lookup"><span data-stu-id="67685-288">Notes</span></span> |
| -------- | -------- | ------- |
| <span data-ttu-id="67685-289">hello</span><span class="sxs-lookup"><span data-stu-id="67685-289">hello</span></span>  | <span data-ttu-id="67685-290">/hello</span><span class="sxs-lookup"><span data-stu-id="67685-290">/hello</span></span>  | <span data-ttu-id="67685-291">Соответствует только одному пути `/hello`</span><span class="sxs-lookup"><span data-stu-id="67685-291">Only matches the single path `/hello`</span></span> |
| <span data-ttu-id="67685-292">{Page=Home}</span><span class="sxs-lookup"><span data-stu-id="67685-292">{Page=Home}</span></span> | / | <span data-ttu-id="67685-293">Соответствует и задает для параметра `Page` значение `Home`</span><span class="sxs-lookup"><span data-stu-id="67685-293">Matches and sets `Page` to `Home`</span></span> |
| <span data-ttu-id="67685-294">{Page=Home}</span><span class="sxs-lookup"><span data-stu-id="67685-294">{Page=Home}</span></span>  | <span data-ttu-id="67685-295">/Contact</span><span class="sxs-lookup"><span data-stu-id="67685-295">/Contact</span></span>  | <span data-ttu-id="67685-296">Соответствует и задает для параметра `Page` значение `Contact`</span><span class="sxs-lookup"><span data-stu-id="67685-296">Matches and sets `Page` to `Contact`</span></span> |
| <span data-ttu-id="67685-297">{controller}/{action}/{id?}</span><span class="sxs-lookup"><span data-stu-id="67685-297">{controller}/{action}/{id?}</span></span> | <span data-ttu-id="67685-298">/Products/List</span><span class="sxs-lookup"><span data-stu-id="67685-298">/Products/List</span></span> | <span data-ttu-id="67685-299">Сопоставляется с контроллером `Products` и действием `List`</span><span class="sxs-lookup"><span data-stu-id="67685-299">Maps to `Products` controller and `List`  action</span></span> |
| <span data-ttu-id="67685-300">{controller}/{action}/{id?}</span><span class="sxs-lookup"><span data-stu-id="67685-300">{controller}/{action}/{id?}</span></span> | <span data-ttu-id="67685-301">/Products/Details/123</span><span class="sxs-lookup"><span data-stu-id="67685-301">/Products/Details/123</span></span>  |  <span data-ttu-id="67685-302">Сопоставляется с контроллером `Products` и действием `Details`.</span><span class="sxs-lookup"><span data-stu-id="67685-302">Maps to `Products` controller and  `Details` action.</span></span>  <span data-ttu-id="67685-303">`id` присваивается значение 123</span><span class="sxs-lookup"><span data-stu-id="67685-303">`id` set to 123</span></span> |
| <span data-ttu-id="67685-304">{controller=Home}/{action=Index}/{id?}</span><span class="sxs-lookup"><span data-stu-id="67685-304">{controller=Home}/{action=Index}/{id?}</span></span> | /  |  <span data-ttu-id="67685-305">Сопоставляется с контроллером `Home` и методом `Index`; `id` пропускается.</span><span class="sxs-lookup"><span data-stu-id="67685-305">Maps to `Home` controller and `Index`  method; `id` is ignored.</span></span> |

<span data-ttu-id="67685-306">Использование шаблона — это, как правило, самый простой подход к маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="67685-306">Using a template is generally the simplest approach to routing.</span></span> <span data-ttu-id="67685-307">Ограничения и значения по умолчанию также могут указываться вне шаблона маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-307">Constraints and defaults can also be specified outside the route template.</span></span>

<span data-ttu-id="67685-308">Совет. Чтобы увидеть, как встроенные реализации маршрутизации, такие как `Route`, сопоставляются с запросами, включите [ведение журнала](xref:fundamentals/logging/index).</span><span class="sxs-lookup"><span data-stu-id="67685-308">Tip: Enable [Logging](xref:fundamentals/logging/index) to see how the built in routing implementations, such as `Route`, match requests.</span></span>

## <a name="reserved-routing-names"></a><span data-ttu-id="67685-309">Зарезервированные имена маршрутизации</span><span class="sxs-lookup"><span data-stu-id="67685-309">Reserved routing names</span></span>

<span data-ttu-id="67685-310">Следующие ключевые слова являются зарезервированными именами и не могут использоваться как имена маршрутов или параметры:</span><span class="sxs-lookup"><span data-stu-id="67685-310">The following keywords are reserved names and can't be used as route names or parameters:</span></span>

* `action`
* `area`
* `controller`
* `handler`
* `page`

## <a name="route-constraint-reference"></a><span data-ttu-id="67685-311">Справочник по ограничениям маршрутов</span><span class="sxs-lookup"><span data-stu-id="67685-311">Route constraint reference</span></span>

<span data-ttu-id="67685-312">Ограничения маршрута применяются, когда объект `Route` соответствует синтаксису входящего URL-адреса и путь URL-адреса был разобран на значения маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-312">Route constraints execute when a `Route` has matched the syntax of the incoming URL and tokenized the URL path into route values.</span></span> <span data-ttu-id="67685-313">Как правило, ограничения маршрута служат для проверки значения маршрута, связанного посредством шаблона маршрута, и принятия решения касательно того, является ли значение приемлемым (да или нет).</span><span class="sxs-lookup"><span data-stu-id="67685-313">Route constraints generally inspect the route value associated via the route template and make a simple yes/no decision about whether or not the value is acceptable.</span></span> <span data-ttu-id="67685-314">Некоторые ограничения маршрута используют данные, не относящиеся к значению маршрута, для определения возможности маршрутизации запроса.</span><span class="sxs-lookup"><span data-stu-id="67685-314">Some route constraints use data outside the route value to consider whether the request can be routed.</span></span> <span data-ttu-id="67685-315">Например, `HttpMethodRouteConstraint` может принимать или отклонять запрос в зависимости от HTTP-команды.</span><span class="sxs-lookup"><span data-stu-id="67685-315">For example, the `HttpMethodRouteConstraint` can accept or reject a request based on its HTTP verb.</span></span>

>[!WARNING]
> <span data-ttu-id="67685-316">Старайтесь не использовать ограничения для **проверки входных данных**, так как в результате недопустимые входные данные будут вызывать ошибку 404 (не найдено) вместо ошибки 400 с соответствующим сообщением.</span><span class="sxs-lookup"><span data-stu-id="67685-316">Avoid using constraints for **input validation**, because doing so means that invalid input will result in a 404 (Not Found) instead of a 400 with an appropriate error message.</span></span> <span data-ttu-id="67685-317">Ограничения маршрутов следует использовать для **разрешения неоднозначности** похожих маршрутов, а не для проверки входных данных определенного маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-317">Route constraints should be used to **disambiguate** between similar routes, not to validate the inputs for a particular route.</span></span>

<span data-ttu-id="67685-318">В приведенной ниже таблице показаны некоторые ограничения маршрутов и их ожидаемое поведение.</span><span class="sxs-lookup"><span data-stu-id="67685-318">The following table demonstrates some route constraints and their expected behavior.</span></span>

| <span data-ttu-id="67685-319">ограничение</span><span class="sxs-lookup"><span data-stu-id="67685-319">constraint</span></span> | <span data-ttu-id="67685-320">Пример</span><span class="sxs-lookup"><span data-stu-id="67685-320">Example</span></span> | <span data-ttu-id="67685-321">Примеры совпадений</span><span class="sxs-lookup"><span data-stu-id="67685-321">Example Matches</span></span> | <span data-ttu-id="67685-322">Примечания</span><span class="sxs-lookup"><span data-stu-id="67685-322">Notes</span></span> |
| --------   | ------- | ------------- | ----- |
| `int` | `{id:int}` | <span data-ttu-id="67685-323">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="67685-323">`123456789`, `-123456789`</span></span>  | <span data-ttu-id="67685-324">Соответствует любому целому числу</span><span class="sxs-lookup"><span data-stu-id="67685-324">Matches any integer</span></span> |
| `bool`  | `{active:bool}` | <span data-ttu-id="67685-325">`true`, `FALSE`</span><span class="sxs-lookup"><span data-stu-id="67685-325">`true`, `FALSE`</span></span> | <span data-ttu-id="67685-326">Соответствует `true` или `false` (без учета регистра)</span><span class="sxs-lookup"><span data-stu-id="67685-326">Matches `true` or `false` (case-insensitive)</span></span> |
| `datetime` | `{dob:datetime}` | <span data-ttu-id="67685-327">`2016-12-31`, `2016-12-31 7:32pm`</span><span class="sxs-lookup"><span data-stu-id="67685-327">`2016-12-31`, `2016-12-31 7:32pm`</span></span>  | <span data-ttu-id="67685-328">Соответствует допустимому значению `DateTime` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="67685-328">Matches a valid `DateTime` value (in the invariant culture - see warning)</span></span> |
| `decimal` | `{price:decimal}` | <span data-ttu-id="67685-329">`49.99`, `-1,000.01`</span><span class="sxs-lookup"><span data-stu-id="67685-329">`49.99`, `-1,000.01`</span></span> | <span data-ttu-id="67685-330">Соответствует допустимому значению `decimal` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="67685-330">Matches a valid `decimal` value (in the invariant culture - see warning)</span></span> |
| `double`  | `{weight:double}` | <span data-ttu-id="67685-331">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="67685-331">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="67685-332">Соответствует допустимому значению `double` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="67685-332">Matches a valid `double` value (in the invariant culture - see warning)</span></span> |
| `float`  | `{weight:float}` | <span data-ttu-id="67685-333">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="67685-333">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="67685-334">Соответствует допустимому значению `float` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="67685-334">Matches a valid `float` value (in the invariant culture - see warning)</span></span> |
| `guid`  | `{id:guid}` | <span data-ttu-id="67685-335">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span><span class="sxs-lookup"><span data-stu-id="67685-335">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span></span> | <span data-ttu-id="67685-336">Соответствует допустимому значению `Guid`</span><span class="sxs-lookup"><span data-stu-id="67685-336">Matches a valid `Guid` value</span></span> |
| `long` | `{ticks:long}` | <span data-ttu-id="67685-337">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="67685-337">`123456789`, `-123456789`</span></span> | <span data-ttu-id="67685-338">Соответствует допустимому значению `long`</span><span class="sxs-lookup"><span data-stu-id="67685-338">Matches a valid `long` value</span></span> |
| `minlength(value)` | `{username:minlength(4)}` | `Rick` | <span data-ttu-id="67685-339">Строка должна содержать не менее 4 символов</span><span class="sxs-lookup"><span data-stu-id="67685-339">String must be at least 4 characters</span></span> |
| `maxlength(value)` | `{filename:maxlength(8)}` | `Richard` | <span data-ttu-id="67685-340">Строка должна содержать не более 8 символов</span><span class="sxs-lookup"><span data-stu-id="67685-340">String must be no more than 8 characters</span></span> |
| `length(length)` | `{filename:length(12)}` | `somefile.txt` | <span data-ttu-id="67685-341">Длина строки должна составлять ровно 12 символов</span><span class="sxs-lookup"><span data-stu-id="67685-341">String must be exactly 12 characters long</span></span> |
| `length(min,max)` | `{filename:length(8,16)}` | `somefile.txt` | <span data-ttu-id="67685-342">Строка должна содержать от 8 до 16 символов</span><span class="sxs-lookup"><span data-stu-id="67685-342">String must be at least 8 and no more than 16 characters long</span></span> |
| `min(value)` | `{age:min(18)}` | `19` | <span data-ttu-id="67685-343">Целочисленное значение не меньше 18</span><span class="sxs-lookup"><span data-stu-id="67685-343">Integer value must be at least 18</span></span> |
| `max(value)` | `{age:max(120)}` |  `91` | <span data-ttu-id="67685-344">Целочисленное значение не больше 120</span><span class="sxs-lookup"><span data-stu-id="67685-344">Integer value must be no more than 120</span></span> |
| `range(min,max)` | `{age:range(18,120)}` | `91` | <span data-ttu-id="67685-345">Целочисленное значение от 18 до 120</span><span class="sxs-lookup"><span data-stu-id="67685-345">Integer value must be at least 18 but no more than 120</span></span> |
| `alpha` | `{name:alpha}` | `Rick` | <span data-ttu-id="67685-346">Строка должна состоять из одной или нескольких букв (`a`-`z`, без учета регистра)</span><span class="sxs-lookup"><span data-stu-id="67685-346">String must consist of one or more alphabetical characters (`a`-`z`, case-insensitive)</span></span> |
| `regex(expression)` | `{ssn:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}` | `123-45-6789` | <span data-ttu-id="67685-347">Строка должна соответствовать регулярному выражению (см. советы по определению регулярного выражения)</span><span class="sxs-lookup"><span data-stu-id="67685-347">String must match the regular expression (see tips about defining a regular expression)</span></span> |
| `required`  | `{name:required}` | `Rick` |  <span data-ttu-id="67685-348">Определяет обязательное наличие значения, не относящегося к параметру, во время формирования URL-адреса</span><span class="sxs-lookup"><span data-stu-id="67685-348">Used to enforce that a non-parameter value is present during URL generation</span></span> |

>[!WARNING]
> <span data-ttu-id="67685-349">Ограничения маршрута, которые проверяют URL-адрес и могут быть преобразованы в тип CLR (например, `int` или `DateTime`), всегда используют инвариантные язык и региональные параметры, то есть они предполагают, что URL-адрес является нелокализуемым.</span><span class="sxs-lookup"><span data-stu-id="67685-349">Route constraints that verify the URL can be converted to a CLR type (such as `int` or `DateTime`) always use the invariant culture - they assume the URL is non-localizable.</span></span> <span data-ttu-id="67685-350">Предоставляемые платформой ограничения маршрутов не изменяют значения, хранящиеся в значениях маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-350">The framework-provided route constraints don't modify the values stored in route values.</span></span> <span data-ttu-id="67685-351">Все значения маршрута, переданные из URL-адреса, сохраняются как строки.</span><span class="sxs-lookup"><span data-stu-id="67685-351">All route values parsed from the URL will be stored as strings.</span></span> <span data-ttu-id="67685-352">Например, [ограничение маршрута FloatRouteConstraint](https://github.com/aspnet/Routing/blob/1.0.0/src/Microsoft.AspNetCore.Routing/Constraints/FloatRouteConstraint.cs#L44-L60) пытается преобразовать значение маршрута в число с плавающей запятой, но преобразованное значение служит только для проверки возможности такого преобразования.</span><span class="sxs-lookup"><span data-stu-id="67685-352">For example, the [Float route constraint](https://github.com/aspnet/Routing/blob/1.0.0/src/Microsoft.AspNetCore.Routing/Constraints/FloatRouteConstraint.cs#L44-L60) will attempt to convert the route value to a float, but the converted value is used only to verify it can be converted to a float.</span></span>

## <a name="regular-expressions"></a><span data-ttu-id="67685-353">Регулярные выражения</span><span class="sxs-lookup"><span data-stu-id="67685-353">Regular expressions</span></span> 

<span data-ttu-id="67685-354">В платформе ASP.NET Core в конструктор регулярных выражений добавляются члены `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant`.</span><span class="sxs-lookup"><span data-stu-id="67685-354">The ASP.NET Core framework adds `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` to the regular expression constructor.</span></span> <span data-ttu-id="67685-355">Их описание см. в статье [Перечисление RegexOptions](/dotnet/api/system.text.regularexpressions.regexoptions).</span><span class="sxs-lookup"><span data-stu-id="67685-355">See [RegexOptions Enumeration](/dotnet/api/system.text.regularexpressions.regexoptions) for a description of these members.</span></span>

<span data-ttu-id="67685-356">В регулярных выражениях применяются разделители и токены, аналогичные используемым функцией маршрутизации и в языке C#.</span><span class="sxs-lookup"><span data-stu-id="67685-356">Regular expressions use delimiters and tokens similar to those used by Routing and the C# language.</span></span> <span data-ttu-id="67685-357">Токены регулярного выражения должны быть экранированы.</span><span class="sxs-lookup"><span data-stu-id="67685-357">Regular expression tokens must be escaped.</span></span> <span data-ttu-id="67685-358">Например, чтобы использовать регулярное выражение `^\d{3}-\d{2}-\d{4}$` при маршрутизации, необходимо ввести символы `\` в виде `\\` в исходном файле C# для экранирования escape-символов строки `\` (если не используются [буквальные строковые литералы](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/string)).</span><span class="sxs-lookup"><span data-stu-id="67685-358">For example, to use the regular expression `^\d{3}-\d{2}-\d{4}$` in Routing, it needs to have the `\` characters typed in as `\\` in the C# source file to escape the `\` string escape character (unless using [verbatim string literals](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/string).</span></span> <span data-ttu-id="67685-359">Символы `{`, `}`, "[" и "]" необходимо экранировать путем их удвоения, чтобы экранировать символы-разделители параметров маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="67685-359">The `{` , `}` , '[' and ']' characters need to be escaped by doubling them to escape the Routing parameter delimiter characters.</span></span>  <span data-ttu-id="67685-360">В приведенной ниже таблице показаны регулярные выражения и их экранированные варианты.</span><span class="sxs-lookup"><span data-stu-id="67685-360">The table below shows a regular expression and the escaped version.</span></span>

| <span data-ttu-id="67685-361">Выражение</span><span class="sxs-lookup"><span data-stu-id="67685-361">Expression</span></span>               | <span data-ttu-id="67685-362">Бумага для заметок</span><span class="sxs-lookup"><span data-stu-id="67685-362">Note</span></span> |
| ----------------- | ------------ | 
| `^\d{3}-\d{2}-\d{4}$` | <span data-ttu-id="67685-363">Регулярное выражение</span><span class="sxs-lookup"><span data-stu-id="67685-363">Regular expression</span></span> |
| `^\\d{{3}}-\\d{{2}}-\\d{{4}}$` | <span data-ttu-id="67685-364">Экранированное</span><span class="sxs-lookup"><span data-stu-id="67685-364">Escaped</span></span>  |
| `^[a-z]{2}$` | <span data-ttu-id="67685-365">Регулярное выражение</span><span class="sxs-lookup"><span data-stu-id="67685-365">Regular expression</span></span> |
| `^[[a-z]]{{2}}$` | <span data-ttu-id="67685-366">Экранированное</span><span class="sxs-lookup"><span data-stu-id="67685-366">Escaped</span></span>  |

<span data-ttu-id="67685-367">Регулярные выражения, используемые при маршрутизации, часто начинаются с символа `^` (соответствие с начальной позицией строки) и заканчиваются символом `$` (соответствие с конечной позицией строки).</span><span class="sxs-lookup"><span data-stu-id="67685-367">Regular expressions used in routing will often start with the `^` character (match starting position of the string) and end with the `$` character (match ending position of the string).</span></span> <span data-ttu-id="67685-368">Благодаря символам `^` и `$` регулярное выражение сопоставляется со всем значением параметра маршрута.</span><span class="sxs-lookup"><span data-stu-id="67685-368">The `^` and `$` characters ensure that the regular expression match the entire route parameter value.</span></span> <span data-ttu-id="67685-369">Если символы `^` и `$` отсутствуют, регулярное выражение сопоставляется с любой подстрокой внутри строки, что зачастую не требуется.</span><span class="sxs-lookup"><span data-stu-id="67685-369">Without the `^` and `$` characters the regular expression will match any sub-string within the string, which is often not what you want.</span></span> <span data-ttu-id="67685-370">В приведенной ниже таблице представлен ряд примеров и объясняются причины соответствия или несоответствия.</span><span class="sxs-lookup"><span data-stu-id="67685-370">The table below shows some examples and explains why they match or fail to match.</span></span>

| <span data-ttu-id="67685-371">Выражение</span><span class="sxs-lookup"><span data-stu-id="67685-371">Expression</span></span>               | <span data-ttu-id="67685-372">String</span><span class="sxs-lookup"><span data-stu-id="67685-372">String</span></span> | <span data-ttu-id="67685-373">Соответствие</span><span class="sxs-lookup"><span data-stu-id="67685-373">Match</span></span> | <span data-ttu-id="67685-374">Комментарий</span><span class="sxs-lookup"><span data-stu-id="67685-374">Comment</span></span> |
| ----------------- | ------------ |  ------------ |  ------------ | 
| `[a-z]{2}` | <span data-ttu-id="67685-375">hello</span><span class="sxs-lookup"><span data-stu-id="67685-375">hello</span></span> | <span data-ttu-id="67685-376">да</span><span class="sxs-lookup"><span data-stu-id="67685-376">yes</span></span> | <span data-ttu-id="67685-377">соответствие подстроки</span><span class="sxs-lookup"><span data-stu-id="67685-377">substring matches</span></span> |
| `[a-z]{2}` | <span data-ttu-id="67685-378">123abc456</span><span class="sxs-lookup"><span data-stu-id="67685-378">123abc456</span></span> | <span data-ttu-id="67685-379">да</span><span class="sxs-lookup"><span data-stu-id="67685-379">yes</span></span> | <span data-ttu-id="67685-380">соответствие подстроки</span><span class="sxs-lookup"><span data-stu-id="67685-380">substring matches</span></span> |
| `[a-z]{2}` | <span data-ttu-id="67685-381">mz</span><span class="sxs-lookup"><span data-stu-id="67685-381">mz</span></span> | <span data-ttu-id="67685-382">да</span><span class="sxs-lookup"><span data-stu-id="67685-382">yes</span></span> | <span data-ttu-id="67685-383">соответствует выражению</span><span class="sxs-lookup"><span data-stu-id="67685-383">matches expression</span></span> |
| `[a-z]{2}` | <span data-ttu-id="67685-384">MZ</span><span class="sxs-lookup"><span data-stu-id="67685-384">MZ</span></span> | <span data-ttu-id="67685-385">да</span><span class="sxs-lookup"><span data-stu-id="67685-385">yes</span></span> | <span data-ttu-id="67685-386">без учета регистра</span><span class="sxs-lookup"><span data-stu-id="67685-386">not case sensitive</span></span> |
| `^[a-z]{2}$` |  <span data-ttu-id="67685-387">hello</span><span class="sxs-lookup"><span data-stu-id="67685-387">hello</span></span> | <span data-ttu-id="67685-388">Нет</span><span class="sxs-lookup"><span data-stu-id="67685-388">no</span></span> | <span data-ttu-id="67685-389">см. замечания, касающиеся символов `^` и `$`, выше</span><span class="sxs-lookup"><span data-stu-id="67685-389">see `^` and `$` above</span></span> |
| `^[a-z]{2}$` |  <span data-ttu-id="67685-390">123abc456</span><span class="sxs-lookup"><span data-stu-id="67685-390">123abc456</span></span> | <span data-ttu-id="67685-391">Нет</span><span class="sxs-lookup"><span data-stu-id="67685-391">no</span></span> | <span data-ttu-id="67685-392">см. замечания, касающиеся символов `^` и `$`, выше</span><span class="sxs-lookup"><span data-stu-id="67685-392">see `^` and `$` above</span></span> |

<span data-ttu-id="67685-393">Дополнительные сведения о синтаксисе регулярных выражений см. в статье [Регулярные выражения в .NET Framework](https://docs.microsoft.com/dotnet/standard/base-types/regular-expression-language-quick-reference).</span><span class="sxs-lookup"><span data-stu-id="67685-393">Refer to [.NET Framework Regular Expressions](https://docs.microsoft.com/dotnet/standard/base-types/regular-expression-language-quick-reference) for more information on regular expression syntax.</span></span>

<span data-ttu-id="67685-394">Чтобы ограничить возможные значения параметра набором известных значений, используйте регулярное выражение.</span><span class="sxs-lookup"><span data-stu-id="67685-394">To constrain a parameter to a known set of possible values, use a regular expression.</span></span> <span data-ttu-id="67685-395">Например, при использовании выражения `{action:regex(^(list|get|create)$)}` значение маршрута `action` будет соответствовать только `list`, `get` или `create`.</span><span class="sxs-lookup"><span data-stu-id="67685-395">For example `{action:regex(^(list|get|create)$)}` only matches the `action` route value to `list`, `get`, or `create`.</span></span> <span data-ttu-id="67685-396">При передаче в словарь ограничений строка "^(list|get|create)$" будет эквивалентной.</span><span class="sxs-lookup"><span data-stu-id="67685-396">If passed into the constraints dictionary, the string "^(list|get|create)$" would be equivalent.</span></span> <span data-ttu-id="67685-397">Ограничения, которые передаются в словарь ограничений (то есть не являются встроенными ограничениями шаблона) и не соответствуют одному из известных ограничений, также рассматриваются как регулярные выражения.</span><span class="sxs-lookup"><span data-stu-id="67685-397">Constraints that are passed in the constraints dictionary (not inline within a template) that don't match one of the known constraints are also treated as regular expressions.</span></span>

## <a name="url-generation-reference"></a><span data-ttu-id="67685-398">Справочник по формированию URL-адресов</span><span class="sxs-lookup"><span data-stu-id="67685-398">URL Generation Reference</span></span>

<span data-ttu-id="67685-399">В приведенном ниже примере показано, как создать ссылку на маршрут с использованием словаря значений маршрута и коллекции `RouteCollection`.</span><span class="sxs-lookup"><span data-stu-id="67685-399">The example below shows how to generate a link to a route given a dictionary of route values and a `RouteCollection`.</span></span>

[!code-csharp[](../fundamentals/routing/sample/RoutingSample/Startup.cs?range=45-59)]

<span data-ttu-id="67685-400">В результате приведенного выше примера создается `VirtualPath` со значением `/package/create/123`.</span><span class="sxs-lookup"><span data-stu-id="67685-400">The `VirtualPath` generated at the end of the sample above is `/package/create/123`.</span></span>

<span data-ttu-id="67685-401">Второй параметр конструктора `VirtualPathContext` — это коллекция *значений окружения*.</span><span class="sxs-lookup"><span data-stu-id="67685-401">The second parameter to the `VirtualPathContext` constructor is a collection of *ambient values*.</span></span> <span data-ttu-id="67685-402">Значения окружения упрощают разработку, ограничивая число значений, которые необходимо указывать в определенном контексте запроса.</span><span class="sxs-lookup"><span data-stu-id="67685-402">Ambient values provide convenience by limiting the number of values a developer must specify within a certain request context.</span></span> <span data-ttu-id="67685-403">Текущие значения маршрута текущего запроса считаются значениями окружения для создания ссылки.</span><span class="sxs-lookup"><span data-stu-id="67685-403">The current route values of the current request are considered ambient values for link generation.</span></span> <span data-ttu-id="67685-404">Например, в приложении ASP.NET MVC в действии `About` контроллера `HomeController` не нужно задавать значение маршрута контроллера, указывающее на действие `Index` (используется значение окружения `Home`).</span><span class="sxs-lookup"><span data-stu-id="67685-404">For example, in an ASP.NET MVC app if you are in the `About` action of the `HomeController`, you don't need to specify the controller route value to link to the `Index` action (the ambient value of `Home` will be used).</span></span>

<span data-ttu-id="67685-405">Значения окружения, которые не соответствуют параметру, игнорируются. Они также игнорируются при переопределении явно предоставленными значениями (значения следуют в URL-адресе слева направо).</span><span class="sxs-lookup"><span data-stu-id="67685-405">Ambient values that don't match a parameter are ignored, and ambient values are also ignored when an explicitly-provided value overrides it, going from left to right in the URL.</span></span>

<span data-ttu-id="67685-406">Явно предоставленные значения, которым нет соответствий, добавляются в строку запроса.</span><span class="sxs-lookup"><span data-stu-id="67685-406">Values that are explicitly provided but which don't match anything are added to the query string.</span></span> <span data-ttu-id="67685-407">В приведенной ниже таблице показан результат использования шаблона маршрута `{controller}/{action}/{id?}`.</span><span class="sxs-lookup"><span data-stu-id="67685-407">The following table shows the result when using the route template `{controller}/{action}/{id?}`.</span></span>

| <span data-ttu-id="67685-408">Значения окружения</span><span class="sxs-lookup"><span data-stu-id="67685-408">Ambient Values</span></span> | <span data-ttu-id="67685-409">Явные значения</span><span class="sxs-lookup"><span data-stu-id="67685-409">Explicit Values</span></span> | <span data-ttu-id="67685-410">Результат</span><span class="sxs-lookup"><span data-stu-id="67685-410">Result</span></span> |
| -------------   | -------------- | ------ |
| <span data-ttu-id="67685-411">controller="Home"</span><span class="sxs-lookup"><span data-stu-id="67685-411">controller="Home"</span></span> | <span data-ttu-id="67685-412">action="About"</span><span class="sxs-lookup"><span data-stu-id="67685-412">action="About"</span></span> | `/Home/About` |
| <span data-ttu-id="67685-413">controller="Home"</span><span class="sxs-lookup"><span data-stu-id="67685-413">controller="Home"</span></span> | <span data-ttu-id="67685-414">controller="Order",action="About"</span><span class="sxs-lookup"><span data-stu-id="67685-414">controller="Order",action="About"</span></span> | `/Order/About` |
| <span data-ttu-id="67685-415">controller="Home",color="Red"</span><span class="sxs-lookup"><span data-stu-id="67685-415">controller="Home",color="Red"</span></span> | <span data-ttu-id="67685-416">action="About"</span><span class="sxs-lookup"><span data-stu-id="67685-416">action="About"</span></span> | `/Home/About` |
| <span data-ttu-id="67685-417">controller="Home"</span><span class="sxs-lookup"><span data-stu-id="67685-417">controller="Home"</span></span> | <span data-ttu-id="67685-418">action="About",color="Red"</span><span class="sxs-lookup"><span data-stu-id="67685-418">action="About",color="Red"</span></span> | `/Home/About?color=Red`

<span data-ttu-id="67685-419">Если маршрут имеет значение по умолчанию, которое не соответствует параметру, и это значение предоставлено явным образом, оно должно соответствовать значению по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="67685-419">If a route has a default value that doesn't correspond to a parameter and that value is explicitly provided, it must match the default value.</span></span> <span data-ttu-id="67685-420">Пример:</span><span class="sxs-lookup"><span data-stu-id="67685-420">For example:</span></span>

```csharp
routes.MapRoute("blog_route", "blog/{*slug}",
  defaults: new { controller = "Blog", action = "ReadPost" });
```

<span data-ttu-id="67685-421">Для этого маршрута ссылка будет создана только в том случае, если предоставлены соответствующие значения для контроллера и действия.</span><span class="sxs-lookup"><span data-stu-id="67685-421">Link generation would only generate a link for this route when the matching values for controller and action are provided.</span></span>
