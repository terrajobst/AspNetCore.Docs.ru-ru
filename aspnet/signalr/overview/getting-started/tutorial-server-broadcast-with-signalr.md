---
uid: signalr/overview/getting-started/tutorial-server-broadcast-with-signalr
title: 'Руководство: Передача сообщений с сервера с помощью SignalR 2 | Документация Майкрософт'
author: tdykstra
description: Этом руководстве показано, как создать веб-приложения, использующего ASP.NET SignalR 2 для предоставления широковещательных функциональные возможности сервера. Вещание сервера означает, что commun...
ms.author: aspnetcontent
ms.date: 10/13/2014
ms.assetid: 1568247f-60b5-4eca-96e0-e661fbb2b273
msc.legacyurl: /signalr/overview/getting-started/tutorial-server-broadcast-with-signalr
msc.type: authoredcontent
ms.openlocfilehash: 0e86fbea9c5668e20fce7a494c76c52f9c089c09
ms.sourcegitcommit: b28cd0313af316c051c2ff8549865bff67f2fbb4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/05/2018
ms.locfileid: "37820701"
---
<a name="tutorial-server-broadcast-with-signalr-2"></a><span data-ttu-id="6cdac-104">Руководство: Передача сообщений с сервера с помощью SignalR 2</span><span class="sxs-lookup"><span data-stu-id="6cdac-104">Tutorial: Server Broadcast with SignalR 2</span></span>
====================
<span data-ttu-id="6cdac-105">по [том Дайкстра](https://github.com/tdykstra), [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="6cdac-105">by [Tom Dykstra](https://github.com/tdykstra), [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="6cdac-106">Этом руководстве показано, как создать веб-приложения, использующего ASP.NET SignalR 2 для предоставления широковещательных функциональные возможности сервера.</span><span class="sxs-lookup"><span data-stu-id="6cdac-106">This tutorial shows how to create a web application that uses ASP.NET SignalR 2 to provide server broadcast functionality.</span></span> <span data-ttu-id="6cdac-107">Рассылка сервера означает, что связям клиентам инициируются сервером.</span><span class="sxs-lookup"><span data-stu-id="6cdac-107">Server broadcast means that communications sent to clients are initiated by the server.</span></span> <span data-ttu-id="6cdac-108">Данный сценарий требует другого подхода программирования, чем peer-to-peer сценариев, таких как приложения чата, в которых инициируется связям клиентам по одному или нескольким из клиентов.</span><span class="sxs-lookup"><span data-stu-id="6cdac-108">This scenario requires a different programming approach than peer-to-peer scenarios such as chat applications, in which communications sent to clients are initiated by one or more of the clients.</span></span>
> 
> <span data-ttu-id="6cdac-109">Приложение, которое вы создадите в этом руководстве имитирует биржевые сводки, типичный сценарий для широковещательных функциональные возможности сервера.</span><span class="sxs-lookup"><span data-stu-id="6cdac-109">The application that you'll create in this tutorial simulates a stock ticker, a typical scenario for server broadcast functionality.</span></span>
> 
> <span data-ttu-id="6cdac-110">В этом разделе был первоначально написан Майклом Патрик Флетчера.</span><span class="sxs-lookup"><span data-stu-id="6cdac-110">This topic was originally written by Patrick Fletcher.</span></span>
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="6cdac-111">Версии программного обеспечения, используемые в этом руководстве</span><span class="sxs-lookup"><span data-stu-id="6cdac-111">Software versions used in the tutorial</span></span>
> 
> 
> - [<span data-ttu-id="6cdac-112">Visual Studio 2013</span><span class="sxs-lookup"><span data-stu-id="6cdac-112">Visual Studio 2013</span></span>](https://www.microsoft.com/visualstudio/eng/2013-downloads)
> - <span data-ttu-id="6cdac-113">.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="6cdac-113">.NET 4.5</span></span>
> - <span data-ttu-id="6cdac-114">SignalR версии 2</span><span class="sxs-lookup"><span data-stu-id="6cdac-114">SignalR version 2</span></span>
>   
> 
> 
> ## <a name="using-visual-studio-2012-with-this-tutorial"></a><span data-ttu-id="6cdac-115">С помощью Visual Studio 2012 с помощью этого руководства</span><span class="sxs-lookup"><span data-stu-id="6cdac-115">Using Visual Studio 2012 with this tutorial</span></span>
> 
> 
> <span data-ttu-id="6cdac-116">Чтобы использовать Visual Studio 2012 с этим руководством, сделайте следующее:</span><span class="sxs-lookup"><span data-stu-id="6cdac-116">To use Visual Studio 2012 with this tutorial, do the following:</span></span>
> 
> - <span data-ttu-id="6cdac-117">Обновление вашей [диспетчера пакетов](http://docs.nuget.org/docs/start-here/installing-nuget) до последней версии.</span><span class="sxs-lookup"><span data-stu-id="6cdac-117">Update your [Package Manager](http://docs.nuget.org/docs/start-here/installing-nuget) to the latest version.</span></span>
> - <span data-ttu-id="6cdac-118">Установка [установщик веб-платформы](https://www.microsoft.com/web/downloads/platform.aspx).</span><span class="sxs-lookup"><span data-stu-id="6cdac-118">Install the [Web Platform Installer](https://www.microsoft.com/web/downloads/platform.aspx).</span></span>
> - <span data-ttu-id="6cdac-119">В установщик веб-платформы, найдите и установите **ASP.NET и Web Tools 2013.1 для Visual Studio 2012**.</span><span class="sxs-lookup"><span data-stu-id="6cdac-119">In the Web Platform Installer, search for and install **ASP.NET and Web Tools 2013.1 for Visual Studio 2012**.</span></span> <span data-ttu-id="6cdac-120">Это будет установки Visual Studio шаблоны для SignalR классов, таких как **центр**.</span><span class="sxs-lookup"><span data-stu-id="6cdac-120">This will install Visual Studio templates for SignalR classes such as **Hub**.</span></span>
> - <span data-ttu-id="6cdac-121">Некоторые шаблоны (такие как **класс запуска OWIN**) будут недоступны; для этого используйте файл класса.</span><span class="sxs-lookup"><span data-stu-id="6cdac-121">Some templates (such as **OWIN Startup Class**) will not be available; for these, use a Class file instead.</span></span>
> 
> 
> ## <a name="tutorial-versions"></a><span data-ttu-id="6cdac-122">Учебника по версии</span><span class="sxs-lookup"><span data-stu-id="6cdac-122">Tutorial Versions</span></span>
> 
> <span data-ttu-id="6cdac-123">Сведения о более ранних версий SignalR, см. в разделе [более старых версий SignalR](../older-versions/index.md).</span><span class="sxs-lookup"><span data-stu-id="6cdac-123">For information about earlier versions of SignalR, see [SignalR Older Versions](../older-versions/index.md).</span></span>
> 
> ## <a name="questions-and-comments"></a><span data-ttu-id="6cdac-124">Вопросы и комментарии</span><span class="sxs-lookup"><span data-stu-id="6cdac-124">Questions and comments</span></span>
> 
> <span data-ttu-id="6cdac-125">Оставьте свои отзывы на том, как вам понравилось, и этот учебник и что можно улучшить в комментариях в нижней части страницы.</span><span class="sxs-lookup"><span data-stu-id="6cdac-125">Please leave feedback on how you liked this tutorial and what we could improve in the comments at the bottom of the page.</span></span> <span data-ttu-id="6cdac-126">Если у вас есть вопросы, которые не имеют отношения к руководству, их можно разместить [форум по ASP.NET SignalR](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) или [StackOverflow.com](http://stackoverflow.com/).</span><span class="sxs-lookup"><span data-stu-id="6cdac-126">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET SignalR forum](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) or [StackOverflow.com](http://stackoverflow.com/).</span></span>


## <a name="overview"></a><span data-ttu-id="6cdac-127">Обзор</span><span class="sxs-lookup"><span data-stu-id="6cdac-127">Overview</span></span>

<span data-ttu-id="6cdac-128">В этом руководстве будет создание приложения биржевые сводки, представляющих приложений в реальном времени, в которых требуется периодически «push», или рассылка, уведомлений с сервера все подключенные клиенты.</span><span class="sxs-lookup"><span data-stu-id="6cdac-128">In this tutorial, you'll create a stock ticker application that is representative of real-time applications in which you want to periodically "push," or broadcast, notifications from the server to all connected clients.</span></span> <span data-ttu-id="6cdac-129">В первой части этого учебника вы создадите упрощенную версию этого приложения с нуля.</span><span class="sxs-lookup"><span data-stu-id="6cdac-129">In the first part of this tutorial, you'll create a simplified version of that application from scratch.</span></span> <span data-ttu-id="6cdac-130">В оставшейся части руководства вы установите пакет NuGet, который содержит дополнительные функции и просмотрите код для этих функций.</span><span class="sxs-lookup"><span data-stu-id="6cdac-130">In the remainder of the tutorial, you'll install a NuGet package that contains additional features, and review the code for those features.</span></span>

<span data-ttu-id="6cdac-131">Приложение, которое вы создадите в первой части этого учебника представлена таблица со биржевых данных.</span><span class="sxs-lookup"><span data-stu-id="6cdac-131">The application that you'll build in the first part of this tutorial displays a grid with stock data.</span></span>

![Начальная версия StockTicker](tutorial-server-broadcast-with-signalr/_static/image1.png)

<span data-ttu-id="6cdac-133">Периодически сервер случайным образом обновляет акций и отправляет обновления всех подключенных клиентов.</span><span class="sxs-lookup"><span data-stu-id="6cdac-133">Periodically the server randomly updates stock prices and pushes the updates to all connected clients.</span></span> <span data-ttu-id="6cdac-134">В браузере чисел и символов в **изменить** и **%** динамически изменять столбцы в ответ на уведомления от сервера.</span><span class="sxs-lookup"><span data-stu-id="6cdac-134">In the browser the numbers and symbols in the **Change** and **%** columns dynamically change in response to notifications from the server.</span></span> <span data-ttu-id="6cdac-135">Если открыть дополнительные браузеров на том же URL-адрес, все они Показывать те же данные и те же изменения в данные одновременно.</span><span class="sxs-lookup"><span data-stu-id="6cdac-135">If you open additional browsers to the same URL, they all show the same data and the same changes to the data simultaneously.</span></span>

<span data-ttu-id="6cdac-136">Этот учебник содержит следующие разделы:</span><span class="sxs-lookup"><span data-stu-id="6cdac-136">This tutorial contains the following sections:</span></span>

- [<span data-ttu-id="6cdac-137">Необходимые компоненты</span><span class="sxs-lookup"><span data-stu-id="6cdac-137">Prerequisites</span></span>](#prerequisites)
- [<span data-ttu-id="6cdac-138">Создание проекта</span><span class="sxs-lookup"><span data-stu-id="6cdac-138">Create the project</span></span>](#createproject)
- [<span data-ttu-id="6cdac-139">Настройте серверный код</span><span class="sxs-lookup"><span data-stu-id="6cdac-139">Set up the server code</span></span>](#server)
- [<span data-ttu-id="6cdac-140">Настройка кода клиента</span><span class="sxs-lookup"><span data-stu-id="6cdac-140">Set up the client code</span></span>](#client)
- [<span data-ttu-id="6cdac-141">Тестирование приложения</span><span class="sxs-lookup"><span data-stu-id="6cdac-141">Test the application</span></span>](#test)
- [<span data-ttu-id="6cdac-142">Включение ведения журнала</span><span class="sxs-lookup"><span data-stu-id="6cdac-142">Enable logging</span></span>](#enablelogging)
- [<span data-ttu-id="6cdac-143">Установка и просмотрите полный пример StockTicker</span><span class="sxs-lookup"><span data-stu-id="6cdac-143">Install and review the full StockTicker sample</span></span>](#fullsample)
- [<span data-ttu-id="6cdac-144">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="6cdac-144">Next steps</span></span>](#nextsteps)

<span data-ttu-id="6cdac-145">[Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) пакет NuGet устанавливает пример simulated биржевые сводки приложения в проекте Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6cdac-145">The [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package installs a sample simulated stock ticker application in a Visual Studio project.</span></span>

> [!NOTE]
> <span data-ttu-id="6cdac-146">Если вы не хотите работать шаги по созданию приложения, можно установить пакет SignalR.Sample в новом проекте пустое веб-приложение ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="6cdac-146">If you don't want to work through the steps of building the application, you can install the SignalR.Sample package in a new Empty ASP.NET Web Application project.</span></span> <span data-ttu-id="6cdac-147">Если вы установите пакет NuGet без выполнения действия в этом руководстве **необходимо выполнить инструкции в файле readme.txt**.</span><span class="sxs-lookup"><span data-stu-id="6cdac-147">If you install the NuGet package without performing the steps in this tutorial, **you must follow the instructions in the readme.txt file**.</span></span> <span data-ttu-id="6cdac-148">Чтобы запустить пакет, необходимо добавить класс запуска OWIN, который вызывает метод ConfigureSignalR в установленном пакете.</span><span class="sxs-lookup"><span data-stu-id="6cdac-148">To run the package you need to add an OWIN startup class which calls the ConfigureSignalR method in the installed package.</span></span> <span data-ttu-id="6cdac-149">Вы получите ошибку, если вы не добавили класс запуска OWIN.</span><span class="sxs-lookup"><span data-stu-id="6cdac-149">You will receive an error if you do not add the OWIN startup class.</span></span>


<a id="prerequisites"></a>

## <a name="prerequisites"></a><span data-ttu-id="6cdac-150">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="6cdac-150">Prerequisites</span></span>

<span data-ttu-id="6cdac-151">Перед началом работы убедитесь, что у вас есть Visual Studio 2013, установленной на компьютере.</span><span class="sxs-lookup"><span data-stu-id="6cdac-151">Before you start, make sure that you have Visual Studio 2013 installed on your computer.</span></span> <span data-ttu-id="6cdac-152">Если у вас нет Visual Studio, см. в разделе [загрузок ASP.NET](https://www.asp.net/downloads) для получения бесплатной Visual Studio 2013 Express.</span><span class="sxs-lookup"><span data-stu-id="6cdac-152">If you don't have Visual Studio, see [ASP.NET Downloads](https://www.asp.net/downloads) to get the free Visual Studio 2013 Express.</span></span>

<a id="createproject"></a>

## <a name="create-the-project"></a><span data-ttu-id="6cdac-153">Создание проекта</span><span class="sxs-lookup"><span data-stu-id="6cdac-153">Create the project</span></span>

1. <span data-ttu-id="6cdac-154">Из **файл** меню, щелкните **новый проект**.</span><span class="sxs-lookup"><span data-stu-id="6cdac-154">From the **File** menu, click **New Project**.</span></span>
2. <span data-ttu-id="6cdac-155">В **новый проект** диалогового окна разверните узел **C#** под **шаблоны** и выберите **Web**.</span><span class="sxs-lookup"><span data-stu-id="6cdac-155">In the **New Project** dialog box, expand **C#** under **Templates** and select **Web**.</span></span>
3. <span data-ttu-id="6cdac-156">Выберите **пустое веб-приложение ASP.NET** шаблон, имя проекта *SignalR.StockTicker*и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="6cdac-156">Select the **ASP.NET Empty Web Application** template, name the project *SignalR.StockTicker*, and click **OK**.</span></span>

    ![Диалоговое окно “Новый проект”](tutorial-server-broadcast-with-signalr/_static/image2.png)
4. <span data-ttu-id="6cdac-158">В **нового ASP.NET** окно проекта, оставьте **пустой** и нажмите кнопку **Создание проекта**.</span><span class="sxs-lookup"><span data-stu-id="6cdac-158">In the **New ASP.NET** Project window, leave **Empty** selected and click **Create Project**.</span></span>

    ![Диалоговое окно нового проекта ASP](tutorial-server-broadcast-with-signalr/_static/image3.png)

<a id="server"></a>

## <a name="set-up-the-server-code"></a><span data-ttu-id="6cdac-160">Настройте серверный код</span><span class="sxs-lookup"><span data-stu-id="6cdac-160">Set up the server code</span></span>

<span data-ttu-id="6cdac-161">В этом разделе можно настроить код, который выполняется на сервере.</span><span class="sxs-lookup"><span data-stu-id="6cdac-161">In this section you set up the code that runs on the server.</span></span>

### <a name="create-the-stock-class"></a><span data-ttu-id="6cdac-162">Создайте класс акции</span><span class="sxs-lookup"><span data-stu-id="6cdac-162">Create the Stock class</span></span>

<span data-ttu-id="6cdac-163">Сначала создается класс модели Stock, которое будет использоваться для хранения и передачи информации о акций.</span><span class="sxs-lookup"><span data-stu-id="6cdac-163">You begin by creating the Stock model class that you'll use to store and transmit information about a stock.</span></span>

1. <span data-ttu-id="6cdac-164">Создайте новый файл класса в папке проекта, назовите его *Stock.cs*, а затем замените код шаблона следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="6cdac-164">Create a new class file in the project folder, name it *Stock.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample1.cs)]

    <span data-ttu-id="6cdac-165">Два свойства, которые вы укажете при создании акции: символ (например, MSFT корпорации Майкрософт) и цену.</span><span class="sxs-lookup"><span data-stu-id="6cdac-165">The two properties that you'll set when you create stocks are the Symbol (for example, MSFT for Microsoft) and the Price.</span></span> <span data-ttu-id="6cdac-166">Другие свойства зависят от того, как и когда можно установить цену.</span><span class="sxs-lookup"><span data-stu-id="6cdac-166">The other properties depend on how and when you set Price.</span></span> <span data-ttu-id="6cdac-167">В первый раз установить цену, значение возвращает распространяются DayOpen.</span><span class="sxs-lookup"><span data-stu-id="6cdac-167">The first time you set Price, the value gets propagated to DayOpen.</span></span> <span data-ttu-id="6cdac-168">В следующий раз, если задается цену, изменения и значения свойств PercentChange вычисляются на основе разницы между ценой и DayOpen.</span><span class="sxs-lookup"><span data-stu-id="6cdac-168">Subsequent times when you set Price, the Change and PercentChange property values are calculated based on the difference between Price and DayOpen.</span></span>

### <a name="create-the-stockticker-and-stocktickerhub-classes"></a><span data-ttu-id="6cdac-169">Создание классов StockTicker и StockTickerHub</span><span class="sxs-lookup"><span data-stu-id="6cdac-169">Create the StockTicker and StockTickerHub classes</span></span>

<span data-ttu-id="6cdac-170">Вы используете API концентратора SignalR для обработки взаимодействия клиентом и сервером.</span><span class="sxs-lookup"><span data-stu-id="6cdac-170">You'll use the SignalR Hub API to handle server-to-client interaction.</span></span> <span data-ttu-id="6cdac-171">StockTickerHub класс, производный от класса концентратора SignalR обрабатывающий получение подключений и вызовы методов из клиентов.</span><span class="sxs-lookup"><span data-stu-id="6cdac-171">A StockTickerHub class that derives from the SignalR Hub class will handle receiving connections and method calls from clients.</span></span> <span data-ttu-id="6cdac-172">Необходимо также поддерживать биржевых данных и выполнения объекта таймера периодически запускать обновления цены, независимо от клиентских подключений.</span><span class="sxs-lookup"><span data-stu-id="6cdac-172">You also need to maintain stock data and run a Timer object to periodically trigger price updates, independently of client connections.</span></span> <span data-ttu-id="6cdac-173">Эти функции нельзя поместить в класс концентратора, так как экземпляры концентратора являются временными.</span><span class="sxs-lookup"><span data-stu-id="6cdac-173">You can't put these functions in a Hub class, because Hub instances are transient.</span></span> <span data-ttu-id="6cdac-174">Экземпляр класса центра создается для каждой операции в концентраторе, такие как подключения и вызовы от клиента к серверу.</span><span class="sxs-lookup"><span data-stu-id="6cdac-174">A Hub class instance is created for each operation on the hub, such as connections and calls from the client to the server.</span></span> <span data-ttu-id="6cdac-175">Поэтому для запуска в отдельном классе, который следует именовать StockTicker имеет механизм, который отслеживает биржевых данных, затем обновляет цены и передает изменения цены.</span><span class="sxs-lookup"><span data-stu-id="6cdac-175">So the mechanism that keeps stock data, updates prices, and broadcasts the price updates has to run in a separate class, which you'll name StockTicker.</span></span>

![Широковещательная рассылка из StockTicker](tutorial-server-broadcast-with-signalr/_static/image5.png)

<span data-ttu-id="6cdac-177">Требуется только один экземпляр класса StockTicker для запуска на сервере, поэтому вам потребуется настроить ссылку из каждого экземпляра StockTickerHub StockTicker одноэлементный экземпляр.</span><span class="sxs-lookup"><span data-stu-id="6cdac-177">You only want one instance of the StockTicker class to run on the server, so you'll need to set up a reference from each StockTickerHub instance to the singleton StockTicker instance.</span></span> <span data-ttu-id="6cdac-178">Класс StockTicker должен быть способен рассылать клиентам, так как он имеет биржевых данных и триггеров обновлений, но StockTicker не является классом концентратора.</span><span class="sxs-lookup"><span data-stu-id="6cdac-178">The StockTicker class has to be able to broadcast to clients because it has the stock data and triggers updates, but StockTicker is not a Hub class.</span></span> <span data-ttu-id="6cdac-179">Таким образом класс StockTicker должен получить ссылку на объект контекста подключения концентратора SignalR.</span><span class="sxs-lookup"><span data-stu-id="6cdac-179">Therefore, the StockTicker class has to get a reference to the SignalR Hub connection context object.</span></span> <span data-ttu-id="6cdac-180">Он этого можно использовать объект контекста подключения SignalR для рассылки клиентам.</span><span class="sxs-lookup"><span data-stu-id="6cdac-180">It can then use the SignalR connection context object to broadcast to clients.</span></span>

1. <span data-ttu-id="6cdac-181">В **обозревателе решений**, щелкните правой кнопкой мыши проект и нажмите кнопку **Add | Класс концентратора SignalR (v2)**.</span><span class="sxs-lookup"><span data-stu-id="6cdac-181">In **Solution Explorer**, right-click the project and click **Add | SignalR Hub Class (v2)**.</span></span>
2. <span data-ttu-id="6cdac-182">Назовите новый концентратор *StockTickerHub.cs*, а затем нажмите кнопку **добавить**.</span><span class="sxs-lookup"><span data-stu-id="6cdac-182">Name the new hub *StockTickerHub.cs*, and then click **Add**.</span></span> <span data-ttu-id="6cdac-183">Пакеты SignalR NuGet будет добавлен в проект.</span><span class="sxs-lookup"><span data-stu-id="6cdac-183">SignalR NuGet packages will be added to your project.</span></span>
3. <span data-ttu-id="6cdac-184">Замените код шаблона следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="6cdac-184">Replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample2.cs)]

    <span data-ttu-id="6cdac-185">[Концентратора](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) класс используется для определения методов, клиенты могут вызывать на сервере.</span><span class="sxs-lookup"><span data-stu-id="6cdac-185">The [Hub](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) class is used to define methods the clients can call on the server.</span></span> <span data-ttu-id="6cdac-186">Вы определяете один метод: `GetAllStocks()`.</span><span class="sxs-lookup"><span data-stu-id="6cdac-186">You are defining one method: `GetAllStocks()`.</span></span> <span data-ttu-id="6cdac-187">Когда клиент сначала производит подключение к серверу, он вызывает этот метод, чтобы получить список всех акций с их текущие цены.</span><span class="sxs-lookup"><span data-stu-id="6cdac-187">When a client initially connects to the server, it will call this method to get a list of all of the stocks with their current prices.</span></span> <span data-ttu-id="6cdac-188">Метод может выполняться синхронно и возвращать `IEnumerable<Stock>` так, как он возвращает данные из памяти.</span><span class="sxs-lookup"><span data-stu-id="6cdac-188">The method can execute synchronously and return `IEnumerable<Stock>` because it is returning data from memory.</span></span> <span data-ttu-id="6cdac-189">Если метод должен получить данные, выполнив то, что будет включать в себя оповещения, такие как поиск в базе данных или вызов веб-службы, следует указать `Task<IEnumerable<Stock>>` как возвращаемое значение асинхронной обработки.</span><span class="sxs-lookup"><span data-stu-id="6cdac-189">If the method had to get the data by doing something that would involve waiting, such as a database lookup or a web service call, you would specify `Task<IEnumerable<Stock>>` as the return value to enable asynchronous processing.</span></span> <span data-ttu-id="6cdac-190">Дополнительные сведения см. в разделе [ASP.NET руководство по API концентраторов SignalR - Server - когда следует выполнить асинхронно](../guide-to-the-api/hubs-api-guide-server.md#asyncmethods).</span><span class="sxs-lookup"><span data-stu-id="6cdac-190">For more information, see [ASP.NET SignalR Hubs API Guide - Server - When to execute asynchronously](../guide-to-the-api/hubs-api-guide-server.md#asyncmethods).</span></span>

    <span data-ttu-id="6cdac-191">HubName атрибут указывает, как концентратор будет ссылаться в коде JavaScript на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="6cdac-191">The HubName attribute specifies how the Hub will be referenced in JavaScript code on the client.</span></span> <span data-ttu-id="6cdac-192">Имя по умолчанию на стороне клиента, если вы не используете этот атрибут — это версия стиле Camel, от имени класса, который в данном случае было бы stockTickerHub.</span><span class="sxs-lookup"><span data-stu-id="6cdac-192">The default name on the client if you don't use this attribute is a camel-cased version of the class name, which in this case would be stockTickerHub.</span></span>

    <span data-ttu-id="6cdac-193">Как вы увидите позже при создании класса StockTicker, одноэлементный экземпляр этого класса создается в его статическое свойство экземпляра.</span><span class="sxs-lookup"><span data-stu-id="6cdac-193">As you'll see later when you create the StockTicker class, a singleton instance of that class is created in its static Instance property.</span></span> <span data-ttu-id="6cdac-194">Одноэлементный экземпляр StockTicker остается в памяти независимо от того, сколько клиентов подключить или отключить, что этот экземпляр используется метод GetAllStocks для возврата текущего биржевых данных.</span><span class="sxs-lookup"><span data-stu-id="6cdac-194">That singleton instance of StockTicker remains in memory no matter how many clients connect or disconnect, and that instance is what the GetAllStocks method uses to return current stock information.</span></span>
4. <span data-ttu-id="6cdac-195">Создайте новый файл класса в папке проекта, назовите его *StockTicker.cs*, а затем замените код шаблона следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="6cdac-195">Create a new class file in the project folder, name it *StockTicker.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample3.cs)]

    <span data-ttu-id="6cdac-196">Так как несколько потоков будут выполняться один и тот же экземпляр кода StockTicker, StockTicker класс должен быть threadsafe.</span><span class="sxs-lookup"><span data-stu-id="6cdac-196">Since multiple threads will be running the same instance of StockTicker code, the StockTicker class has to be threadsafe.</span></span>

    ### <a name="storing-the-singleton-instance-in-a-static-field"></a><span data-ttu-id="6cdac-197">Хранение одноэлементного экземпляра в статическом поле</span><span class="sxs-lookup"><span data-stu-id="6cdac-197">Storing the singleton instance in a static field</span></span>

    <span data-ttu-id="6cdac-198">Этот код инициализирует статические \_экземпляр поля, поддерживающего свойство экземпляра с экземпляром класса, и это является единственным экземпляром класса, которые могут быть созданы, так как конструктор помечен как частный.</span><span class="sxs-lookup"><span data-stu-id="6cdac-198">The code initializes the static \_instance field that backs the Instance property with an instance of the class, and this is the only instance of the class that can be created, because the constructor is marked as private.</span></span> <span data-ttu-id="6cdac-199">[Отложенная инициализация](https://msdn.microsoft.com/library/dd997286.aspx) используется для \_поле экземпляра, а не для повышения производительности, но чтобы обеспечить создание экземпляра threadsafe.</span><span class="sxs-lookup"><span data-stu-id="6cdac-199">[Lazy initialization](https://msdn.microsoft.com/library/dd997286.aspx) is used for the \_instance field, not for performance reasons but to ensure that the instance creation is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample4.cs)]

    <span data-ttu-id="6cdac-200">Каждый раз, когда клиент подключается к серверу, новый экземпляр класса StockTickerHub, работающих в отдельном потоке Получает одноэлементный экземпляр StockTicker из статического свойства StockTicker.Instance, как было показано ранее в классе StockTickerHub.</span><span class="sxs-lookup"><span data-stu-id="6cdac-200">Each time a client connects to the server, a new instance of the StockTickerHub class running in a separate thread gets the StockTicker singleton instance from the StockTicker.Instance static property, as you saw earlier in the StockTickerHub class.</span></span>

    ### <a name="storing-stock-data-in-a-concurrentdictionary"></a><span data-ttu-id="6cdac-201">Хранение данных акций в руководство.</span><span class="sxs-lookup"><span data-stu-id="6cdac-201">Storing stock data in a ConcurrentDictionary</span></span>

    <span data-ttu-id="6cdac-202">Конструктор инициализирует \_коллекция акций с некоторыми биржевых данных образец и GetAllStocks возвращает акций.</span><span class="sxs-lookup"><span data-stu-id="6cdac-202">The constructor initializes the \_stocks collection with some sample stock data, and GetAllStocks returns the stocks.</span></span> <span data-ttu-id="6cdac-203">Как было показано ранее, эта коллекция акции в свою очередь возвращается StockTickerHub.GetAllStocks, этот метод в классе концентратора, который клиенты могут вызывать сервера.</span><span class="sxs-lookup"><span data-stu-id="6cdac-203">As you saw earlier, this collection of stocks is in turn returned by StockTickerHub.GetAllStocks which is a server method in the Hub class that clients can call.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample5.cs)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample6.cs)]

    <span data-ttu-id="6cdac-204">Представляет собой коллекцию акции [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) тип потокобезопасности.</span><span class="sxs-lookup"><span data-stu-id="6cdac-204">The stocks collection is defined as a [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) type for thread safety.</span></span> <span data-ttu-id="6cdac-205">В качестве альтернативы можно использовать [словарь](https://msdn.microsoft.com/library/xfhwa508.aspx) объекта и явным образом блокировка словаря, при внесении изменений в него.</span><span class="sxs-lookup"><span data-stu-id="6cdac-205">As an alternative, you could use a [Dictionary](https://msdn.microsoft.com/library/xfhwa508.aspx) object and explicitly lock the dictionary when you make changes to it.</span></span>

    <span data-ttu-id="6cdac-206">Для этого примера приложения что достаточно для хранения данных приложений в памяти и потери данных при удалении экземпляра StockTicker.</span><span class="sxs-lookup"><span data-stu-id="6cdac-206">For this sample application, it's OK to store application data in memory and to lose the data when the StockTicker instance is disposed.</span></span> <span data-ttu-id="6cdac-207">В реальном приложении будет работать с хранилищем данных серверной части, например в базе данных.</span><span class="sxs-lookup"><span data-stu-id="6cdac-207">In a real application you would work with a back-end data store such as a database.</span></span>

    ### <a name="periodically-updating-stock-prices"></a><span data-ttu-id="6cdac-208">Периодическое обновление акций</span><span class="sxs-lookup"><span data-stu-id="6cdac-208">Periodically updating stock prices</span></span>

    <span data-ttu-id="6cdac-209">Конструктор запуске объект таймера, который периодически вызывает методы, которые обновляют акций на основе случайной выборки.</span><span class="sxs-lookup"><span data-stu-id="6cdac-209">The constructor starts up a Timer object that periodically calls methods that update stock prices on a random basis.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample7.cs)]

    <span data-ttu-id="6cdac-210">UpdateStockPrices вызывается таймер, который передает значения NULL в параметре state.</span><span class="sxs-lookup"><span data-stu-id="6cdac-210">UpdateStockPrices is called by the Timer, which passes in null in the state parameter.</span></span> <span data-ttu-id="6cdac-211">Перед обновлением цены, блокировки \_updateStockPricesLock объекта.</span><span class="sxs-lookup"><span data-stu-id="6cdac-211">Before updating prices, a lock is taken on the \_updateStockPricesLock object.</span></span> <span data-ttu-id="6cdac-212">Код проверяет, если другой поток уже обновляется цены, а затем он вызывает TryUpdateStockPrice на каждой из них в списке.</span><span class="sxs-lookup"><span data-stu-id="6cdac-212">The code checks if another thread is already updating prices, and then it calls TryUpdateStockPrice on each stock in the list.</span></span> <span data-ttu-id="6cdac-213">Метод TryUpdateStockPrice решает, следует ли изменить цену акций и какой объем, чтобы изменить его.</span><span class="sxs-lookup"><span data-stu-id="6cdac-213">The TryUpdateStockPrice method decides whether to change the stock price, and how much to change it.</span></span> <span data-ttu-id="6cdac-214">Если изменяется акций, BroadcastStockPrice называется рассылать изменения цены акций для всех подключенных клиентов.</span><span class="sxs-lookup"><span data-stu-id="6cdac-214">If the stock price is changed, BroadcastStockPrice is called to broadcast the stock price change to all connected clients.</span></span>

    <span data-ttu-id="6cdac-215">\_UpdatingStockPrices флаг помечается как [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) для обеспечения доступа к нему threadsafe.</span><span class="sxs-lookup"><span data-stu-id="6cdac-215">The \_updatingStockPrices flag is marked as [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) to ensure that access to it is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample8.cs)]

    <span data-ttu-id="6cdac-216">В реальном приложении метод TryUpdateStockPrice вызовет веб-службы для поиска цены. в этом коде в нем генератор случайных чисел для внесения изменений случайным образом.</span><span class="sxs-lookup"><span data-stu-id="6cdac-216">In a real application, the TryUpdateStockPrice method would call a web service to look up the price; in this code it uses a random number generator to make changes randomly.</span></span>

    ### <a name="getting-the-signalr-context-so-that-the-stockticker-class-can-broadcast-to-clients"></a><span data-ttu-id="6cdac-217">Получение контекста SignalR, таким образом, чтобы класс StockTicker могут производить широковещательную рассылку для клиентов</span><span class="sxs-lookup"><span data-stu-id="6cdac-217">Getting the SignalR context so that the StockTicker class can broadcast to clients</span></span>

    <span data-ttu-id="6cdac-218">Поскольку изменения цен здесь приходят в объекте StockTicker, это объект, которому требуется вызывать метод updateStockPrice на всех подключенных клиентов.</span><span class="sxs-lookup"><span data-stu-id="6cdac-218">Because the price changes originate here in the StockTicker object, this is the object that needs to call an updateStockPrice method on all connected clients.</span></span> <span data-ttu-id="6cdac-219">В классе центр имеется API, вызов клиентских методов, но StockTicker, не является производным от класса концентратора и не содержит ссылку на объект любого концентратора.</span><span class="sxs-lookup"><span data-stu-id="6cdac-219">In a Hub class you have an API for calling client methods, but StockTicker does not derive from the Hub class and does not have a reference to any Hub object.</span></span> <span data-ttu-id="6cdac-220">Таким образом для передачи подключенным клиентам, класс StockTicker должен получение экземпляра контекста SignalR для класса StockTickerHub и использовать его для вызова методов на клиентах.</span><span class="sxs-lookup"><span data-stu-id="6cdac-220">Therefore, in order to broadcast to connected clients, the StockTicker class has to get the SignalR context instance for the StockTickerHub class and use that to call methods on clients.</span></span>

    <span data-ttu-id="6cdac-221">Код получает ссылку на контекст SignalR, когда он создает одноэлементный экземпляр класса, которые ссылаются на передается конструктору, и конструктор помещает его в свойстве клиентов.</span><span class="sxs-lookup"><span data-stu-id="6cdac-221">The code gets a reference to the SignalR context when it creates the singleton class instance, passes that reference to the constructor, and the constructor puts it in the Clients property.</span></span>

    <span data-ttu-id="6cdac-222">Есть две причины, почему вы хотите получить контекст только один раз: получение контекста является ресурсоемкой операцией и получения его один раз обеспечивает сохранение последовательности сообщений, отправляемых клиентам.</span><span class="sxs-lookup"><span data-stu-id="6cdac-222">There are two reasons why you want to get the context just once: getting the context is an expensive operation, and getting it once ensures that the intended order of messages sent to clients is preserved.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample9.cs)]

    <span data-ttu-id="6cdac-223">Получение свойства контекста клиентов и поместить его в свойстве StockTickerClient позволяет написать код для вызова методов клиента, который выглядит так же, как если бы в классе концентратора.</span><span class="sxs-lookup"><span data-stu-id="6cdac-223">Getting the Clients property of the context and putting it in the StockTickerClient property lets you write code to call client methods that looks the same as it would in a Hub class.</span></span> <span data-ttu-id="6cdac-224">Например чтобы вещать на все клиенты можно написать Clients.All.updateStockPrice(stock).</span><span class="sxs-lookup"><span data-stu-id="6cdac-224">For instance, to broadcast to all clients you can write Clients.All.updateStockPrice(stock).</span></span>

    <span data-ttu-id="6cdac-225">Метод updateStockPrice, который вы вызываете в BroadcastStockPrice не существует; она будет добавлена позже при написании кода, который выполняется на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="6cdac-225">The updateStockPrice method that you are calling in BroadcastStockPrice doesn't exist yet; you'll add it later when you write code that runs on the client.</span></span> <span data-ttu-id="6cdac-226">Могут ссылаться на updateStockPrice здесь, так как Clients.All является динамической, это означает, что выражение будет вычисляться во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="6cdac-226">You can refer to updateStockPrice here because Clients.All is dynamic, which means the expression will be evaluated at runtime.</span></span> <span data-ttu-id="6cdac-227">При выполнении этого вызова метода, SignalR на клиент отправит имя метода и значение параметра и если клиент имеет метод с именем updateStockPrice, этот метод будет вызван, и к нему будет передаваться значение параметра.</span><span class="sxs-lookup"><span data-stu-id="6cdac-227">When this method call executes, SignalR will send the method name and the parameter value to the client, and if the client has a method named updateStockPrice, that method will be called and the parameter value will be passed to it.</span></span>

    <span data-ttu-id="6cdac-228">Clients.All означает отправки всем клиентам.</span><span class="sxs-lookup"><span data-stu-id="6cdac-228">Clients.All means send to all clients.</span></span> <span data-ttu-id="6cdac-229">SignalR предоставляет другие параметры, чтобы указать, какие клиенты или группы клиентов для отправки.</span><span class="sxs-lookup"><span data-stu-id="6cdac-229">SignalR gives you other options to specify which clients or groups of clients to send to.</span></span> <span data-ttu-id="6cdac-230">Дополнительные сведения см. в разделе [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span><span class="sxs-lookup"><span data-stu-id="6cdac-230">For more information, see [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span></span>

### <a name="register-the-signalr-route"></a><span data-ttu-id="6cdac-231">Регистрация маршрутов SignalR</span><span class="sxs-lookup"><span data-stu-id="6cdac-231">Register the SignalR route</span></span>

<span data-ttu-id="6cdac-232">Сервер должен знать, какой URL-адрес для перехвата и направить SignalR.</span><span class="sxs-lookup"><span data-stu-id="6cdac-232">The server needs to know which URL to intercept and direct to SignalR.</span></span> <span data-ttu-id="6cdac-233">Чтобы сделать это, добавьте класс запуска OWIN:</span><span class="sxs-lookup"><span data-stu-id="6cdac-233">To do that, add an OWIN startup class:</span></span>

1. <span data-ttu-id="6cdac-234">В **обозревателе решений**, щелкните правой кнопкой мыши проект и нажмите кнопку **Add | Класс запуска OWIN**.</span><span class="sxs-lookup"><span data-stu-id="6cdac-234">In **Solution Explorer**, right-click the project, and then click **Add | OWIN Startup Class**.</span></span> <span data-ttu-id="6cdac-235">Назовите класс **Startup.cs**.</span><span class="sxs-lookup"><span data-stu-id="6cdac-235">Name the class **Startup.cs**.</span></span>
2. <span data-ttu-id="6cdac-236">Замените код в **Startup.cs** приведенным ниже.</span><span class="sxs-lookup"><span data-stu-id="6cdac-236">Replace the code in **Startup.cs** with the following.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample10.cs)]

<span data-ttu-id="6cdac-237">Вы завершили настройку серверный код.</span><span class="sxs-lookup"><span data-stu-id="6cdac-237">You have now completed setting up the server code.</span></span> <span data-ttu-id="6cdac-238">В следующем разделе будет настройки клиента.</span><span class="sxs-lookup"><span data-stu-id="6cdac-238">In the next section you'll set up the client.</span></span>

<a id="client"></a>

## <a name="set-up-the-client-code"></a><span data-ttu-id="6cdac-239">Настройка кода клиента</span><span class="sxs-lookup"><span data-stu-id="6cdac-239">Set up the client code</span></span>

1. <span data-ttu-id="6cdac-240">Создайте новый HTML-файл в папке проекта и назовите его *StockTicker.html*.</span><span class="sxs-lookup"><span data-stu-id="6cdac-240">Create a new HTML file in the project folder, and name it *StockTicker.html*.</span></span>
2. <span data-ttu-id="6cdac-241">Замените код шаблона следующим кодом.</span><span class="sxs-lookup"><span data-stu-id="6cdac-241">Replace the template code with the following code.</span></span>

    [!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample11.html)]

    <span data-ttu-id="6cdac-242">HTML-код создается таблица с 5 столбцами, строку заголовка и строку данных с одной ячейкой, охватывающий все 5 столбцов.</span><span class="sxs-lookup"><span data-stu-id="6cdac-242">The HTML creates a table with 5 columns, a header row, and a data row with a single cell that spans all 5 columns.</span></span> <span data-ttu-id="6cdac-243">Строка данных отображает «загрузка...» и будет отображаться только мгновенно при запуске приложения.</span><span class="sxs-lookup"><span data-stu-id="6cdac-243">The data row displays "loading..." and will only be shown momentarily when the application starts.</span></span> <span data-ttu-id="6cdac-244">Код JavaScript будет удалить эту строку и добавьте в строках месте биржевых данных, получаемых с сервера.</span><span class="sxs-lookup"><span data-stu-id="6cdac-244">JavaScript code will remove that row and add in its place rows with stock data retrieved from the server.</span></span>

    <span data-ttu-id="6cdac-245">Теги сценария укажите в файле скрипта jQuery, файла скрипта SignalR core, файле SignalR прокси сценария и файл сценария StockTicker, будет создано позже.</span><span class="sxs-lookup"><span data-stu-id="6cdac-245">The script tags specify the jQuery script file, the SignalR core script file, the SignalR proxies script file, and a StockTicker script file that you'll create later.</span></span> <span data-ttu-id="6cdac-246">Файл скрипта SignalR прокси, который указывает URL-адрес «/ signalr/концентраторы», создается динамически и определяет в этом случае для StockTickerHub.GetAllStocks методы прокси-сервера для методов применительно к классу Hub.</span><span class="sxs-lookup"><span data-stu-id="6cdac-246">The SignalR proxies script file, which specifies the "/signalr/hubs" URL, is dynamically generated and defines proxy methods for the methods on the Hub class, in this case for StockTickerHub.GetAllStocks.</span></span> <span data-ttu-id="6cdac-247">При желании можно создать этот файл JavaScript вручную с помощью [служебные программы SignalR](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) и отключить создание динамического файла в вызове метода MapHubs.</span><span class="sxs-lookup"><span data-stu-id="6cdac-247">If you prefer, you can generate this JavaScript file manually by using [SignalR Utilities](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) and disable dynamic file creation in the MapHubs method call.</span></span>
3. > [!IMPORTANT]
   > <span data-ttu-id="6cdac-248">Убедитесь, что ссылается на файл JavaScript в *StockTicker.html* указаны правильно.</span><span class="sxs-lookup"><span data-stu-id="6cdac-248">Make sure that the JavaScript file references in *StockTicker.html* are correct.</span></span> <span data-ttu-id="6cdac-249">Т. е убедитесь, что версия jQuery в тег сценария (1.10.2 в примере) совпадает со значением версии jQuery в вашем проекте *сценариев* папки и убедитесь, что версия SignalR в тег сценария совпадает со значением SignalR версии в вашем проекте *сценариев* папки.</span><span class="sxs-lookup"><span data-stu-id="6cdac-249">That is, make sure that the jQuery version in your script tag (1.10.2 in the example) is the same as the jQuery version in your project's *Scripts* folder, and make sure that the SignalR version in your script tag is the same as the SignalR version in your project's *Scripts* folder.</span></span> <span data-ttu-id="6cdac-250">При необходимости измените имена файлов в теги сценариев.</span><span class="sxs-lookup"><span data-stu-id="6cdac-250">Change the file names in the script tags if necessary.</span></span>
4. <span data-ttu-id="6cdac-251">В **обозревателе решений**, щелкните правой кнопкой мыши *StockTicker.html*, а затем нажмите кнопку **задать в качестве начальной страницы**.</span><span class="sxs-lookup"><span data-stu-id="6cdac-251">In **Solution Explorer**, right-click *StockTicker.html*, and then click **Set as Start Page**.</span></span>
5. <span data-ttu-id="6cdac-252">Создайте новый файл JavaScript в папке проекта и назовите его *StockTicker.js*...</span><span class="sxs-lookup"><span data-stu-id="6cdac-252">Create a new JavaScript file in the project folder and name it *StockTicker.js*..</span></span>
6. <span data-ttu-id="6cdac-253">Замените код шаблона следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="6cdac-253">Replace the template code with the following code:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample12.js)]

    <span data-ttu-id="6cdac-254">$.connection ссылается на прокси-серверы SignalR.</span><span class="sxs-lookup"><span data-stu-id="6cdac-254">$.connection refers to the SignalR proxies.</span></span> <span data-ttu-id="6cdac-255">Код получает ссылку на прокси-сервер для класса StockTickerHub и помещает его в переменной биржевых котировок.</span><span class="sxs-lookup"><span data-stu-id="6cdac-255">The code gets a reference to the proxy for the StockTickerHub class and puts it in the ticker variable.</span></span> <span data-ttu-id="6cdac-256">Имя прокси-сервер имеет имя, которое было задано с помощью атрибута [HubName]:</span><span class="sxs-lookup"><span data-stu-id="6cdac-256">The proxy name is the name that was set by the [HubName] attribute:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample13.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample14.cs)]

    <span data-ttu-id="6cdac-257">Определив все переменные и функции, в последней строке кода в файле инициализирует подключения SignalR путем вызова функции запуска SignalR.</span><span class="sxs-lookup"><span data-stu-id="6cdac-257">After all the variables and functions are defined, the last line of code in the file initializes the SignalR connection by calling the SignalR start function.</span></span> <span data-ttu-id="6cdac-258">Функция запуска выполняется асинхронно и возвращает [объект jQuery отложенный](http://api.jquery.com/category/deferred-object/), который означает, что можно вызвать функцию Готово для указания функция, вызываемая при завершении асинхронной операции...</span><span class="sxs-lookup"><span data-stu-id="6cdac-258">The start function executes asynchronously and returns a [jQuery Deferred object](http://api.jquery.com/category/deferred-object/), which means you can call the done function to specify the function to call when the asynchronous operation is completed..</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample15.js)]

    <span data-ttu-id="6cdac-259">Функция init вызывает функцию getAllStocks на сервере и использует сведения, сервер возвращает для обновления таблицы акций.</span><span class="sxs-lookup"><span data-stu-id="6cdac-259">The init function calls the getAllStocks function on the server and uses the information that the server returns to update the stock table.</span></span> <span data-ttu-id="6cdac-260">Обратите внимание на то, что по умолчанию, необходимо использовать смешанный регистр на клиентском компьютере, несмотря на то, что имя метода в стиле Pascal на сервере.</span><span class="sxs-lookup"><span data-stu-id="6cdac-260">Notice that by default, you have to use camel casing on the client although the method name is pascal-cased on the server.</span></span> <span data-ttu-id="6cdac-261">Регистрах правило применяется только к методам, не объекты.</span><span class="sxs-lookup"><span data-stu-id="6cdac-261">The camel-casing rule only applies to methods, not objects.</span></span> <span data-ttu-id="6cdac-262">Например можно ссылаться на склад. Символ и акции. Цена, не stock.symbol или stock.price.</span><span class="sxs-lookup"><span data-stu-id="6cdac-262">For example, you refer to stock.Symbol and stock.Price, not stock.symbol or stock.price.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample16.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample17.cs)]

    <span data-ttu-id="6cdac-263">Если вы хотите использовать регистра pascal на клиенте, или если вы хотите использовать имя совершенно другой метод, удалось снабдить метода концентратора с атрибутом HubMethodName так же, как вы декорировать классу Hub с атрибутом HubName.</span><span class="sxs-lookup"><span data-stu-id="6cdac-263">If you wanted to use pascal casing on the client, or if you wanted to use a completely different method name, you could decorate the Hub method with the HubMethodName attribute the same way you decorated the Hub class itself with the HubName attribute.</span></span>

    <span data-ttu-id="6cdac-264">В методе init HTML-код для строки таблицы создается для каждого объекта акций, полученных с сервера вызывающего formatStock для свойства форматирования stock-объектом, а путем вызова вытесняют (который определен в верхней части *StockTicker.js*) для замещения местозаполнителей в переменной rowTemplate со значениями свойств stock-объектом.</span><span class="sxs-lookup"><span data-stu-id="6cdac-264">In the init method, HTML for a table row is created for each stock object received from the server by calling formatStock to format properties of the stock object, and then by calling supplant (which is defined at the top of *StockTicker.js*) to replace placeholders in the rowTemplate variable with the stock object property values.</span></span> <span data-ttu-id="6cdac-265">Затем полученный HTML добавляется к таблице акций.</span><span class="sxs-lookup"><span data-stu-id="6cdac-265">The resulting HTML is then appended to the stock table.</span></span>

    <span data-ttu-id="6cdac-266">Вызвать init, передавая его в качестве функции обратного вызова, который выполняется после завершения функции асинхронного запуска.</span><span class="sxs-lookup"><span data-stu-id="6cdac-266">You call init by passing it in as a callback function that executes after the asynchronous start function completes.</span></span> <span data-ttu-id="6cdac-267">Если init вызывается как отдельную инструкцию после начала вызова JavaScript, функция завершится сбоем, так как оно будет выполнено немедленно, не дожидаясь функции запуска для завершения подключения к.</span><span class="sxs-lookup"><span data-stu-id="6cdac-267">If you called init as a separate JavaScript statement after calling start, the function would fail because it would execute immediately without waiting for the start function to finish establishing the connection.</span></span> <span data-ttu-id="6cdac-268">В этом случае функция init будет выполнена попытка вызвать функцию getAllStocks, прежде чем будет установлено соединение с сервером.</span><span class="sxs-lookup"><span data-stu-id="6cdac-268">In that case, the init function would try to call the getAllStocks function before the server connection is established.</span></span>

    <span data-ttu-id="6cdac-269">Когда сервер изменяет цены акции, она вызывает updateStockPrice на подключенных клиентов.</span><span class="sxs-lookup"><span data-stu-id="6cdac-269">When the server changes a stock's price, it calls the updateStockPrice on connected clients.</span></span> <span data-ttu-id="6cdac-270">Функция будет добавлена свойству клиента на прокси-сервере stockTicker, чтобы сделать его доступным для вызовов с сервера.</span><span class="sxs-lookup"><span data-stu-id="6cdac-270">The function is added to the client property of the stockTicker proxy in order to make it available to calls from the server.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample18.js)]

    <span data-ttu-id="6cdac-271">Функция updateStockPrice форматирует получил от сервера в строке таблицы так же, как и в функции init stock-объектом.</span><span class="sxs-lookup"><span data-stu-id="6cdac-271">The updateStockPrice function formats a stock object received from the server into a table row the same way as in the init function.</span></span> <span data-ttu-id="6cdac-272">Тем не менее вместо того чтобы добавить строку в таблицу, он находит акции текущей строки в таблице и заменяет эту строку на новую.</span><span class="sxs-lookup"><span data-stu-id="6cdac-272">However, instead of appending the row to the table, it finds the stock's current row in the table and replaces that row with the new one.</span></span>

<a id="test"></a>

## <a name="test-the-application"></a><span data-ttu-id="6cdac-273">Тестирование приложения</span><span class="sxs-lookup"><span data-stu-id="6cdac-273">Test the application</span></span>

1. <span data-ttu-id="6cdac-274">Нажмите клавишу F5, чтобы запустить приложение в режиме отладки.</span><span class="sxs-lookup"><span data-stu-id="6cdac-274">Press F5 to run the application in debug mode.</span></span>

    <span data-ttu-id="6cdac-275">Таблицы акций изначально отображает «идет загрузка...» строки, затем после небольшой задержки появится начальная биржевых данных, и запустите акций для изменения.</span><span class="sxs-lookup"><span data-stu-id="6cdac-275">The stock table initially displays the "loading..." line, then after a short delay the initial stock data is displayed, and then the stock prices start to change.</span></span>

    ![Загрузка](tutorial-server-broadcast-with-signalr/_static/image6.png)

    ![Начальная таблица акций](tutorial-server-broadcast-with-signalr/_static/image7.png)

    ![Биржевые таблица, получающая изменения с сервера](tutorial-server-broadcast-with-signalr/_static/image8.png)
2. <span data-ttu-id="6cdac-279">Скопируйте URL-адрес в адресной строке браузера и вставьте его в один или несколько новых окна браузера.</span><span class="sxs-lookup"><span data-stu-id="6cdac-279">Copy the URL from the browser address bar and paste it into one or more new browser window(s).</span></span>

    <span data-ttu-id="6cdac-280">Исходное отображение биржевых совпадает с первым браузером, и изменения происходят одновременно.</span><span class="sxs-lookup"><span data-stu-id="6cdac-280">The initial stock display is the same as the first browser and changes happen simultaneously.</span></span>
3. <span data-ttu-id="6cdac-281">Закройте все браузеры и открыть обозреватель, а затем перейдите на том же URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="6cdac-281">Close all browsers and open a new browser, then go to the same URL.</span></span>

    <span data-ttu-id="6cdac-282">Для запуска на сервере, поэтому в примере показано отображение биржевых таблицы акций продолжил изменять продолжает StockTicker одноэлементного объекта.</span><span class="sxs-lookup"><span data-stu-id="6cdac-282">The StockTicker singleton object has continued to run in the server, so the stock table display shows that the stocks have continued to change.</span></span> <span data-ttu-id="6cdac-283">(Вы не видите первоначальной таблицы с нуля изменить данные).</span><span class="sxs-lookup"><span data-stu-id="6cdac-283">(You don't see the initial table with zero change figures.)</span></span>
4. <span data-ttu-id="6cdac-284">Закройте браузер.</span><span class="sxs-lookup"><span data-stu-id="6cdac-284">Close the browser.</span></span>

<a id="enablelogging"></a>

## <a name="enable-logging"></a><span data-ttu-id="6cdac-285">Включение ведения журнала</span><span class="sxs-lookup"><span data-stu-id="6cdac-285">Enable logging</span></span>

<span data-ttu-id="6cdac-286">SignalR имеет встроенные функции, которую можно включить на стороне клиента для устранения неисправностей.</span><span class="sxs-lookup"><span data-stu-id="6cdac-286">SignalR has a built-in logging function that you can enable on the client to aid in troubleshooting.</span></span> <span data-ttu-id="6cdac-287">В этом разделе описано включение ведения журнала и примеры, показывающие, как журналы скажет, какой из следующих методов транспорта использует SignalR см. в разделе:</span><span class="sxs-lookup"><span data-stu-id="6cdac-287">In this section you enable logging and see examples that show how logs tell you which of the following transport methods SignalR is using:</span></span>

- <span data-ttu-id="6cdac-288">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), поддерживается IIS 8 и современных обозревателей.</span><span class="sxs-lookup"><span data-stu-id="6cdac-288">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), supported by IIS 8 and current browsers.</span></span>
- <span data-ttu-id="6cdac-289">[Сервер отправил события](http://en.wikipedia.org/wiki/Server-sent_events), поддерживаемых браузеров, отличных от Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="6cdac-289">[Server-sent events](http://en.wikipedia.org/wiki/Server-sent_events), supported by browsers other than Internet Explorer.</span></span>
- <span data-ttu-id="6cdac-290">[Forever frame](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), поддерживаемых обозревателем Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="6cdac-290">[Forever frame](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), supported by Internet Explorer.</span></span>
- <span data-ttu-id="6cdac-291">[AJAX, длинный опрос](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), поддерживаемый всеми браузерами.</span><span class="sxs-lookup"><span data-stu-id="6cdac-291">[Ajax long polling](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), supported by all browsers.</span></span>

<span data-ttu-id="6cdac-292">Для любого соединения SignalR выбирает лучший метод транспорта, сервер и клиент поддерживают.</span><span class="sxs-lookup"><span data-stu-id="6cdac-292">For any given connection, SignalR chooses the best transport method that both the server and the client support.</span></span>

1. <span data-ttu-id="6cdac-293">Откройте *StockTicker.js* и добавьте строку кода, чтобы включить ведение журнала непосредственно перед код, который инициализирует подключение в конце файла:</span><span class="sxs-lookup"><span data-stu-id="6cdac-293">Open *StockTicker.js* and add a line of code to enable logging immediately before the code that initializes the connection at the end of the file:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample19.js)]
2. <span data-ttu-id="6cdac-294">Нажмите клавишу F5, чтобы запустить проект.</span><span class="sxs-lookup"><span data-stu-id="6cdac-294">Press F5 to run the project.</span></span>
3. <span data-ttu-id="6cdac-295">Откройте окно инструментов разработчика в браузере и выберите консоль, чтобы просмотреть журналы.</span><span class="sxs-lookup"><span data-stu-id="6cdac-295">Open your browser's developer tools window, and select the Console to see the logs.</span></span> <span data-ttu-id="6cdac-296">Может потребоваться обновить страницу, чтобы просмотреть журналы Signalr согласования метода транспорта для нового соединения.</span><span class="sxs-lookup"><span data-stu-id="6cdac-296">You might have to refresh the page to see the logs of Signalr negotiating the transport method for a new connection.</span></span>

    <span data-ttu-id="6cdac-297">Если вы используете Internet Explorer 10 в Windows 8 (IIS 8), метод транспорта является WebSockets.</span><span class="sxs-lookup"><span data-stu-id="6cdac-297">If you are running Internet Explorer 10 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Консоли IE 10 IIS 8](tutorial-server-broadcast-with-signalr/_static/image9.png)

    <span data-ttu-id="6cdac-299">Если вы используете Internet Explorer 10 в Windows 7 (IIS 7.5), метод транспорта является iframe.</span><span class="sxs-lookup"><span data-stu-id="6cdac-299">If you are running Internet Explorer 10 on Windows 7 (IIS 7.5), the transport method is iframe.</span></span>

    ![IE 10 консоли IIS 7.5](tutorial-server-broadcast-with-signalr/_static/image10.png)

    <span data-ttu-id="6cdac-301">В обозревателе Firefox установите надстройка Firebug, чтобы получать окно консоли.</span><span class="sxs-lookup"><span data-stu-id="6cdac-301">In Firefox, install the Firebug add-in to get a Console window.</span></span> <span data-ttu-id="6cdac-302">Если вы используете Firefox 19 в Windows 8 (IIS 8), метод транспорта является WebSockets.</span><span class="sxs-lookup"><span data-stu-id="6cdac-302">If you are running Firefox 19 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Firefox 19 IIS 8 Websockets](tutorial-server-broadcast-with-signalr/_static/image11.png)

    <span data-ttu-id="6cdac-304">Если вы используете Firefox 19 в Windows 7 (IIS 7.5), метод транспорта — события отправки сервером.</span><span class="sxs-lookup"><span data-stu-id="6cdac-304">If you are running Firefox 19 on Windows 7 (IIS 7.5), the transport method is server-sent events.</span></span>

    ![Firefox 19 консоли IIS 7.5](tutorial-server-broadcast-with-signalr/_static/image12.png)

<a id="fullsample"></a>

## <a name="install-and-review-the-full-stockticker-sample"></a><span data-ttu-id="6cdac-306">Установка и просмотрите полный пример StockTicker</span><span class="sxs-lookup"><span data-stu-id="6cdac-306">Install and review the full StockTicker sample</span></span>

<span data-ttu-id="6cdac-307">Приложение StockTicker, которая устанавливается вместе с [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) пакет NuGet включает больше возможностей, чем упрощенная версия, только что созданную с нуля.</span><span class="sxs-lookup"><span data-stu-id="6cdac-307">The StockTicker application that is installed by the [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package includes more features than the simplified version that you just created from scratch.</span></span> <span data-ttu-id="6cdac-308">В этом разделе руководства вы установите пакет NuGet и просмотрите новые функции и код, который реализует их.</span><span class="sxs-lookup"><span data-stu-id="6cdac-308">In this section of the tutorial, you install the NuGet package and review the new features and the code that implements them.</span></span> <span data-ttu-id="6cdac-309">Если установить пакет без выполнения на предыдущих шагах этого учебника, необходимо добавить класс запуска OWIN в проект.</span><span class="sxs-lookup"><span data-stu-id="6cdac-309">If you install the package without performing the earlier steps of this tutorial, you must add an OWIN startup class to your project.</span></span> <span data-ttu-id="6cdac-310">Этот шаг описан в файле readme.txt для пакета NuGet.</span><span class="sxs-lookup"><span data-stu-id="6cdac-310">This step is explained in the readme.txt file for the NuGet package.</span></span>

### <a name="install-the-signalrsample-nuget-package"></a><span data-ttu-id="6cdac-311">Установите пакет SignalR.Sample NuGet</span><span class="sxs-lookup"><span data-stu-id="6cdac-311">Install the SignalR.Sample NuGet package</span></span>

1. <span data-ttu-id="6cdac-312">В **обозревателе решений**, щелкните правой кнопкой мыши проект и нажмите кнопку **управление пакетами NuGet**.</span><span class="sxs-lookup"><span data-stu-id="6cdac-312">In **Solution Explorer**, right-click the project and click **Manage NuGet Packages**.</span></span>
2. <span data-ttu-id="6cdac-313">В **управление пакетами NuGet** диалоговом окне щелкните **Online**, введите *SignalR.Sample* в **поиск в Интернете** , а затем щелкните  **Установка** в **SignalR.Sample** пакета.</span><span class="sxs-lookup"><span data-stu-id="6cdac-313">In the **Manage NuGet Packages** dialog box, click **Online**, enter *SignalR.Sample* in the **Search Online** box, and then click **Install** in the **SignalR.Sample** package.</span></span>

    ![Установите пакет SignalR.Sample](tutorial-server-broadcast-with-signalr/_static/image13.png)
3. <span data-ttu-id="6cdac-315">В **обозревателе решений**, разверните *SignalR.Sample* папку, которая была создана путем установки пакета SignalR.Sample.</span><span class="sxs-lookup"><span data-stu-id="6cdac-315">In **Solution Explorer**, expand the *SignalR.Sample* folder which was created by installing the SignalR.Sample package.</span></span>
4. <span data-ttu-id="6cdac-316">В *SignalR.Sample* папку, щелкните правой кнопкой мыши *StockTicker.html*, а затем нажмите кнопку **задать в качестве начальной страницы**.</span><span class="sxs-lookup"><span data-stu-id="6cdac-316">In the *SignalR.Sample* folder, right-click *StockTicker.html*, and then click **Set As Start Page**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="6cdac-317">Установка SignalR.Sample NuGet пакета может изменить версию jQuery, у вас есть в вашей *сценариев* папки.</span><span class="sxs-lookup"><span data-stu-id="6cdac-317">Installing The SignalR.Sample NuGet package might change the version of jQuery that you have in your *Scripts* folder.</span></span> <span data-ttu-id="6cdac-318">Новый *StockTicker.html* файл пакета установки в *SignalR.Sample* папки будут синхронизированы с версии jQuery, которая устанавливает пакет, но если вы хотите запустить исходную *StockTicker.html* файл еще раз, необходимо сначала обновить ссылку на jQuery в тег сценария.</span><span class="sxs-lookup"><span data-stu-id="6cdac-318">The new *StockTicker.html* file that the package installs in the *SignalR.Sample* folder will be in sync with the jQuery version that the package installs, but if you want to run your original *StockTicker.html* file again, you might have to update the jQuery reference in the script tag first.</span></span>

### <a name="run-the-application"></a><span data-ttu-id="6cdac-319">Запуск приложения</span><span class="sxs-lookup"><span data-stu-id="6cdac-319">Run the application</span></span>

1. <span data-ttu-id="6cdac-320">Нажмите клавишу F5 для запуска приложения.</span><span class="sxs-lookup"><span data-stu-id="6cdac-320">Press F5 to run the application.</span></span>

    <span data-ttu-id="6cdac-321">В дополнение к таблице, которая вы уже видели полной биржевые сводки приложения отображается окно с горизонтальной прокруткой отображает те же данные акций.</span><span class="sxs-lookup"><span data-stu-id="6cdac-321">In addition to the grid that you saw earlier, the full stock ticker application shows a horizontally scrolling window that displays the same stock data.</span></span> <span data-ttu-id="6cdac-322">При запуске приложения в первый раз, «Марка» «закрыто», и вы увидите статическую таблицу и окно биржевых котировок, которое не прокрутки.</span><span class="sxs-lookup"><span data-stu-id="6cdac-322">When you run the application for the first time, the "market" is "closed" and you see a static grid and a ticker window that isn't scrolling.</span></span>

    ![Экран запуска StockTicker](tutorial-server-broadcast-with-signalr/_static/image14.png)

    <span data-ttu-id="6cdac-324">При нажатии кнопки **Open Market**, **Live биржевых котировок акций** поле начинает прокручиваться по горизонтали, и сервер запускается периодически рассылать изменения цены акций на основе случайной выборки.</span><span class="sxs-lookup"><span data-stu-id="6cdac-324">When you click **Open Market**, the **Live Stock Ticker** box starts to scroll horizontally, and the server starts to periodically broadcast stock price changes on a random basis.</span></span> <span data-ttu-id="6cdac-325">Каждый раз, когда цены акций изменяется, оба **Live Stock таблицы** сетки и **Live биржевых котировок акций** обновляются поля.</span><span class="sxs-lookup"><span data-stu-id="6cdac-325">Each time a stock price changes, both the **Live Stock Table** grid and the **Live Stock Ticker** box are updated.</span></span> <span data-ttu-id="6cdac-326">При изменении цены акции является положительным, акции отображается с зеленым фоном, и когда будет отрицательным, акции отображается с красным фоном.</span><span class="sxs-lookup"><span data-stu-id="6cdac-326">When a stock's price change is positive, the stock is shown with a green background, and when the change is negative, the stock is shown with a red background.</span></span>

    ![Откройте приложение StockTicker рынка](tutorial-server-broadcast-with-signalr/_static/image15.png)

    <span data-ttu-id="6cdac-328">**Закрыть рынка** кнопка останавливает изменения и останавливает прокрутка биржевых котировок и **Сброс** сбрасывает все биржевых данных в исходное состояние до начала изменения цен.</span><span class="sxs-lookup"><span data-stu-id="6cdac-328">The **Close Market** button stops the changes and stops the ticker scrolling, and the **Reset** button resets all stock data to the initial state before price changes started.</span></span> <span data-ttu-id="6cdac-329">Если вы открываете дополнительные окна браузера и перейдите к тем же URL-адрес, вы увидите те же данные, динамически обновляются в то же время, в каждом браузере.</span><span class="sxs-lookup"><span data-stu-id="6cdac-329">If you open more browser windows and go to the same URL, you see the same data dynamically updated at the same time in each browser.</span></span> <span data-ttu-id="6cdac-330">Если щелкнуть одну из кнопок, все браузеры одинаково реагировать на в то же время.</span><span class="sxs-lookup"><span data-stu-id="6cdac-330">When you click one of the buttons, all browsers respond the same way at the same time.</span></span>

### <a name="live-stock-ticker-display"></a><span data-ttu-id="6cdac-331">Динамическое отображение биржевых котировок акций</span><span class="sxs-lookup"><span data-stu-id="6cdac-331">Live Stock Ticker display</span></span>

<span data-ttu-id="6cdac-332">**Live биржевых котировок акций** отображается неупорядоченный список в элемент div, отформатированный в одну строку от стилей CSS.</span><span class="sxs-lookup"><span data-stu-id="6cdac-332">The **Live Stock Ticker** display is an unordered list in a div element that is formatted into a single line by CSS styles.</span></span> <span data-ttu-id="6cdac-333">Инициализируется биржевых котировок и обновить так же, как таблицы:, заменив заполнители в &lt;li&gt; строка шаблона и динамическое добавление &lt;li&gt; элементы &lt;ul&gt; элемент.</span><span class="sxs-lookup"><span data-stu-id="6cdac-333">The ticker is initialized and updated the same way as the table: by replacing placeholders in a &lt;li&gt; template string and dynamically adding the &lt;li&gt; elements to the &lt;ul&gt; element.</span></span> <span data-ttu-id="6cdac-334">Прокрутка выполняется с помощью анимировать функция jQuery для изменения margin-left неупорядоченного списка в пределах div.</span><span class="sxs-lookup"><span data-stu-id="6cdac-334">The scrolling is performed by using the jQuery animate function to vary the margin-left of the unordered list within the div.</span></span>

<span data-ttu-id="6cdac-335">Биржевые сводки HTML:</span><span class="sxs-lookup"><span data-stu-id="6cdac-335">The stock ticker HTML:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample20.html)]

<span data-ttu-id="6cdac-336">Биржевые сводки CSS:</span><span class="sxs-lookup"><span data-stu-id="6cdac-336">The stock ticker CSS:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample21.html)]

<span data-ttu-id="6cdac-337">Прокрутите кода jQuery, что позволяет:</span><span class="sxs-lookup"><span data-stu-id="6cdac-337">The jQuery code that makes it scroll:</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample22.js)]

### <a name="additional-methods-on-the-server-that-the-client-can-call"></a><span data-ttu-id="6cdac-338">Дополнительные методы на сервере, который клиент может вызывать</span><span class="sxs-lookup"><span data-stu-id="6cdac-338">Additional methods on the server that the client can call</span></span>

<span data-ttu-id="6cdac-339">Класс StockTickerHub определяет четыре дополнительные методы, которые клиент может вызывать:</span><span class="sxs-lookup"><span data-stu-id="6cdac-339">The StockTickerHub class defines four additional methods that the client can call:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample23.cs)]

<span data-ttu-id="6cdac-340">OpenMarket CloseMarket и сброса вызываются в ответ на кнопки в верхней части страницы.</span><span class="sxs-lookup"><span data-stu-id="6cdac-340">OpenMarket, CloseMarket, and Reset are called in response to the buttons at the top of the page.</span></span> <span data-ttu-id="6cdac-341">Они показывают шаблон из одного клиента, активируя изменение в состоянии, немедленно распространяются на все клиенты.</span><span class="sxs-lookup"><span data-stu-id="6cdac-341">They demonstrate the pattern of one client triggering a change in state that is immediately propagated to all clients.</span></span> <span data-ttu-id="6cdac-342">Каждый из этих методов вызывает метод в классе StockTicker которые влияют на состояние рынка, изменить и затем осуществляет широковещательную передачу новое состояние.</span><span class="sxs-lookup"><span data-stu-id="6cdac-342">Each of these methods calls a method in the StockTicker class that effects the market state change and then broadcasts the new state.</span></span>

<span data-ttu-id="6cdac-343">В классе StockTicker состояние рынка поддерживается с помощью свойства MarketState, которое возвращает значение перечисления MarketState:</span><span class="sxs-lookup"><span data-stu-id="6cdac-343">In the StockTicker class, the state of the market is maintained by a MarketState property that returns a MarketState enum value:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample24.cs)]

<span data-ttu-id="6cdac-344">Каждый из методов, изменяющих состояние рынка делать это внутри блок lock, так как класс StockTicker должен быть threadsafe:</span><span class="sxs-lookup"><span data-stu-id="6cdac-344">Each of the methods that change the market state do so inside a lock block because the StockTicker class has to be threadsafe:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample25.cs)]

<span data-ttu-id="6cdac-345">Чтобы убедиться, что этот код является threadsafe, \_marketState поля, поддерживающего свойство MarketState помечается как volatile,</span><span class="sxs-lookup"><span data-stu-id="6cdac-345">To ensure that this code is threadsafe, the \_marketState field that backs the MarketState property is marked as volatile,</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample26.cs)]

<span data-ttu-id="6cdac-346">Методы BroadcastMarketStateChange и BroadcastMarketReset аналогичны BroadcastStockPrice метод, который вы уже видели, за исключением того, они вызывают различные методы, определенные на стороне клиента:</span><span class="sxs-lookup"><span data-stu-id="6cdac-346">The BroadcastMarketStateChange and BroadcastMarketReset methods are similar to the BroadcastStockPrice method that you already saw, except they call different methods defined at the client:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample27.cs)]

### <a name="additional-functions-on-the-client-that-the-server-can-call"></a><span data-ttu-id="6cdac-347">Дополнительные функции на клиенте, который сервер может обратиться</span><span class="sxs-lookup"><span data-stu-id="6cdac-347">Additional functions on the client that the server can call</span></span>

<span data-ttu-id="6cdac-348">Функция updateStockPrice теперь обрабатывает сетки и отображение биржевых котировок и использует jQuery.Color начинает мигать, красного и зеленого цвета.</span><span class="sxs-lookup"><span data-stu-id="6cdac-348">The updateStockPrice function now handles both the grid and the ticker display, and it uses jQuery.Color to flash red and green colors.</span></span>

<span data-ttu-id="6cdac-349">Новые функции в *SignalR.StockTicker.js* Включение и отключение кнопок на основе рынок состояния и остановить или запустить биржевых котировок окно горизонтальную прокрутку.</span><span class="sxs-lookup"><span data-stu-id="6cdac-349">New functions in *SignalR.StockTicker.js* enable and disable the buttons based on market state, and they stop or start the ticker window horizontal scrolling.</span></span> <span data-ttu-id="6cdac-350">Так как несколько функций, добавленных ticker.client, [jQuery расширить функции](http://api.jquery.com/jQuery.extend/) используется для добавления их.</span><span class="sxs-lookup"><span data-stu-id="6cdac-350">Since multiple functions are being added to ticker.client, the [jQuery extend function](http://api.jquery.com/jQuery.extend/) is used to add them.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample28.js)]

### <a name="additional-client-setup-after-establishing-the-connection"></a><span data-ttu-id="6cdac-351">Программа установки дополнительного клиента после подключения к</span><span class="sxs-lookup"><span data-stu-id="6cdac-351">Additional client setup after establishing the connection</span></span>

<span data-ttu-id="6cdac-352">После того как клиент устанавливает соединение, он имеет некоторые проделать дополнительную работу: проверить, является ли рынке открытым или закрытым, чтобы вызовите соответствующий marketOpened или функция marketClosed и вложить вызовы методов сервера кнопок.</span><span class="sxs-lookup"><span data-stu-id="6cdac-352">After the client establishes the connection, it has some additional work to do: find out if the market is open or closed in order to call the appropriate marketOpened or marketClosed function, and attach the server method calls to the buttons.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample29.js)]

<span data-ttu-id="6cdac-353">Методы сервера не соединены до кнопки до после того как соединение установлено, таким образом, чтобы код не может попытаться вызвать методы сервера, прежде чем они станут доступны.</span><span class="sxs-lookup"><span data-stu-id="6cdac-353">The server methods are not wired up to the buttons until after the connection is established, so that the code can't try to call the server methods before they are available.</span></span>

<a id="nextsteps"></a>

## <a name="next-steps"></a><span data-ttu-id="6cdac-354">Следующие шаги</span><span class="sxs-lookup"><span data-stu-id="6cdac-354">Next steps</span></span>

<span data-ttu-id="6cdac-355">В этом руководстве вы узнали, как запрограммировать приложение SignalR, которое передает сообщения с сервера все подключенные клиенты, как на периодической основе, так и в ответ на уведомления из любого клиента.</span><span class="sxs-lookup"><span data-stu-id="6cdac-355">In this tutorial you've learned how to program a SignalR application that broadcasts messages from the server to all connected clients, both on a periodic basis and in response to notifications from any client.</span></span> <span data-ttu-id="6cdac-356">Шаблон использования несколькими потоками одноэлементный экземпляр для отслеживания состояния сервера может также использоваться в многопользовательских online game сценариях.</span><span class="sxs-lookup"><span data-stu-id="6cdac-356">The pattern of using a multi-threaded singleton instance to maintain server state can also be also used in multi-player online game scenarios.</span></span> <span data-ttu-id="6cdac-357">Например, см. в разделе [ShootR игры, основанный на SignalR](https://github.com/NTaylorMullen/ShootR).</span><span class="sxs-lookup"><span data-stu-id="6cdac-357">For an example, see [the ShootR game that is based on SignalR](https://github.com/NTaylorMullen/ShootR).</span></span>

<span data-ttu-id="6cdac-358">Учебники, которые показывают связи peer-to-peer сценариев, см. в разделе [начало работы с SignalR](introduction-to-signalr.md) и [обновления в реальном времени с SignalR](tutorial-high-frequency-realtime-with-signalr.md).</span><span class="sxs-lookup"><span data-stu-id="6cdac-358">For tutorials that show peer-to-peer communication scenarios, see [Getting Started with SignalR](introduction-to-signalr.md) and [Real-Time Updating with SignalR](tutorial-high-frequency-realtime-with-signalr.md).</span></span>

<span data-ttu-id="6cdac-359">Более сложные концепции разработки SignalR см. на следующих узлах SignalR исходный код и ресурсы:</span><span class="sxs-lookup"><span data-stu-id="6cdac-359">To learn more advanced SignalR development concepts, visit the following sites for SignalR source code and resources:</span></span>

- [<span data-ttu-id="6cdac-360">ASP.NET SignalR</span><span class="sxs-lookup"><span data-stu-id="6cdac-360">ASP.NET SignalR</span></span>](../../index.md)
- [<span data-ttu-id="6cdac-361">Проект SignalR</span><span class="sxs-lookup"><span data-stu-id="6cdac-361">SignalR Project</span></span>](http://signalr.net/)
- [<span data-ttu-id="6cdac-362">SignalR Github и примерами</span><span class="sxs-lookup"><span data-stu-id="6cdac-362">SignalR Github and Samples</span></span>](https://github.com/SignalR/SignalR)
- [<span data-ttu-id="6cdac-363">Вики-сайте SignalR</span><span class="sxs-lookup"><span data-stu-id="6cdac-363">SignalR Wiki</span></span>](https://github.com/SignalR/SignalR/wiki)

<span data-ttu-id="6cdac-364">Пошаговое руководство о том, как развернуть приложение SignalR в Azure, см. в разделе [с помощью SignalR с веб-приложениями в службе приложений Azure](../deployment/using-signalr-with-azure-web-sites.md).</span><span class="sxs-lookup"><span data-stu-id="6cdac-364">For a walkthrough on how to deploy a SignalR application to Azure, see [Using SignalR with Web Apps in Azure App Service](../deployment/using-signalr-with-azure-web-sites.md).</span></span> <span data-ttu-id="6cdac-365">Подробные сведения о развертывании веб-проекта Visual Studio для веб-сайта Windows Azure см. в разделе [создать веб-приложение ASP.NET в службе приложений Azure](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-get-started/).</span><span class="sxs-lookup"><span data-stu-id="6cdac-365">For detailed information about how to deploy a Visual Studio web project to a Windows Azure Web Site, see [Create an ASP.NET web app in Azure App Service](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-get-started/).</span></span>
