---
uid: mvc/overview/getting-started/getting-started-with-ef-using-mvc/implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application
title: Реализация наследования с использованием Entity Framework 6 в приложении ASP.NET MVC 5 (11, 12) | Документы Microsoft
author: tdykstra
description: Contoso университета примера веб-приложения показано, как создавать приложения ASP.NET MVC 5 с помощью Entity Framework 6 Code First и Visual Studio...
ms.author: aspnetcontent
manager: wpickett
ms.date: 11/07/2014
ms.topic: article
ms.assetid: 08834147-77ec-454a-bb7a-d931d2a40dab
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/getting-started/getting-started-with-ef-using-mvc/implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: 1826659626106993d4796641492c62fcbd22a1b3
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
ms.locfileid: "30873408"
---
<a name="implementing-inheritance-with-the-entity-framework-6-in-an-aspnet-mvc-5-application-11-of-12"></a><span data-ttu-id="25f30-103">Реализация наследования с использованием Entity Framework 6 в приложении ASP.NET MVC 5 (11, 12)</span><span class="sxs-lookup"><span data-stu-id="25f30-103">Implementing Inheritance with the Entity Framework 6 in an ASP.NET MVC 5 Application (11 of 12)</span></span>
====================
<span data-ttu-id="25f30-104">по [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="25f30-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

<span data-ttu-id="25f30-105">[Загрузка завершенного проекта](http://code.msdn.microsoft.com/ASPNET-MVC-Application-b01a9fe8) или [скачать PDF](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20Entity%20Framework%206%20Code%20First%20using%20MVC%205.pdf)</span><span class="sxs-lookup"><span data-stu-id="25f30-105">[Download Completed Project](http://code.msdn.microsoft.com/ASPNET-MVC-Application-b01a9fe8) or [Download PDF](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20Entity%20Framework%206%20Code%20First%20using%20MVC%205.pdf)</span></span>

> <span data-ttu-id="25f30-106">Contoso университета примера веб-приложения показано, как создавать приложения ASP.NET MVC 5 с помощью Entity Framework 6 Code First и Visual Studio 2013.</span><span class="sxs-lookup"><span data-stu-id="25f30-106">The Contoso University sample web application demonstrates how to create ASP.NET MVC 5 applications using the Entity Framework 6 Code First and Visual Studio 2013.</span></span> <span data-ttu-id="25f30-107">Сведения о серии руководств см. в [первом руководстве серии](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="25f30-107">For information about the tutorial series, see [the first tutorial in the series](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>


<span data-ttu-id="25f30-108">В предыдущем учебнике обработки исключений параллелизма.</span><span class="sxs-lookup"><span data-stu-id="25f30-108">In the previous tutorial you handled concurrency exceptions.</span></span> <span data-ttu-id="25f30-109">В этом учебнике демонстрируется, как реализовать наследование в модели данных.</span><span class="sxs-lookup"><span data-stu-id="25f30-109">This tutorial will show you how to implement inheritance in the data model.</span></span>

<span data-ttu-id="25f30-110">В объектно ориентированного программирования, можно использовать [наследования](http://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)) для упрощения [повторное использование кода](http://en.wikipedia.org/wiki/Code_reuse).</span><span class="sxs-lookup"><span data-stu-id="25f30-110">In object-oriented programming, you can use [inheritance](http://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)) to facilitate [code reuse](http://en.wikipedia.org/wiki/Code_reuse).</span></span> <span data-ttu-id="25f30-111">В рамках этого учебника вы измените классы `Instructor` и `Student` таким образом, чтобы они были производными от базового класса `Person`, который содержит общие свойства для преподавателей и учащихся, такие как `LastName`.</span><span class="sxs-lookup"><span data-stu-id="25f30-111">In this tutorial, you'll change the `Instructor` and `Student` classes so that they derive from a `Person` base class which contains properties such as `LastName` that are common to both instructors and students.</span></span> <span data-ttu-id="25f30-112">Изменения вносятся в коде, а не на веб-страницах, и автоматически отражаются в базе данных.</span><span class="sxs-lookup"><span data-stu-id="25f30-112">You won't add or change any web pages, but you'll change some of the code and those changes will be automatically reflected in the database.</span></span>

## <a name="options-for-mapping-inheritance-to-database-tables"></a><span data-ttu-id="25f30-113">Варианты сопоставления наследования для таблиц базы данных</span><span class="sxs-lookup"><span data-stu-id="25f30-113">Options for mapping inheritance to database tables</span></span>

<span data-ttu-id="25f30-114">`Instructor` И `Student` классы в `School` модель данных имеет несколько свойств, которые идентичны:</span><span class="sxs-lookup"><span data-stu-id="25f30-114">The `Instructor` and `Student` classes in the `School` data model have several properties that are identical:</span></span>

![Student_and_Instructor_classes](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image1.png)

<span data-ttu-id="25f30-116">Предположим, что вам требуется исключить повторяющийся код для свойств, которые являются общими для сущностей `Instructor` и `Student`.</span><span class="sxs-lookup"><span data-stu-id="25f30-116">Suppose you want to eliminate the redundant code for the properties that are shared by the `Instructor` and `Student` entities.</span></span> <span data-ttu-id="25f30-117">Кроме того, вам может потребоваться написать службу, которая может форматировать имена как преподавателей, так и учащихся.</span><span class="sxs-lookup"><span data-stu-id="25f30-117">Or you want to write a service that can format names without caring whether the name came from an instructor or a student.</span></span> <span data-ttu-id="25f30-118">Можно создать `Person` базового класса, который содержит только те общие свойства, а затем сделать `Instructor` и `Student` сущности являются производными от базового класса, как показано на следующем рисунке:</span><span class="sxs-lookup"><span data-stu-id="25f30-118">You could create a `Person` base class which contains only those shared properties, then make the `Instructor` and `Student` entities inherit from that base class, as shown in the following illustration:</span></span>

![Student_and_Instructor_classes_deriving_from_Person_class](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image2.png)

<span data-ttu-id="25f30-120">Структура наследования может быть представлена в базе данных несколькими способами.</span><span class="sxs-lookup"><span data-stu-id="25f30-120">There are several ways this inheritance structure could be represented in the database.</span></span> <span data-ttu-id="25f30-121">У вас может быть `Person` таблицу, содержащую сведения о учащихся и инструкторов в одной таблице.</span><span class="sxs-lookup"><span data-stu-id="25f30-121">You could have a `Person` table that includes information about both students and instructors in a single table.</span></span> <span data-ttu-id="25f30-122">Некоторые столбцы могут применяются только к инструкторов (`HireDate`), некоторые только для учащихся (`EnrollmentDate`), некоторые для обоих (`LastName`, `FirstName`).</span><span class="sxs-lookup"><span data-stu-id="25f30-122">Some of the columns could apply only to instructors (`HireDate`), some only to students (`EnrollmentDate`), some to both (`LastName`, `FirstName`).</span></span> <span data-ttu-id="25f30-123">Как правило, будет иметь *дискриминатора* представляет столбец, указывающий, какой тип каждой строки.</span><span class="sxs-lookup"><span data-stu-id="25f30-123">Typically, you'd have a *discriminator* column to indicate which type each row represents.</span></span> <span data-ttu-id="25f30-124">Например, в столбце дискриминатора может указываться значение "Instructor" для преподавателей и "Student" для учащихся.</span><span class="sxs-lookup"><span data-stu-id="25f30-124">For example, the discriminator column might have "Instructor" for instructors and "Student" for students.</span></span>

![Таблицы на hierarchy_example](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image3.png)

<span data-ttu-id="25f30-126">Эта модель создания структура наследования сущностей из одной таблицы базы данных называется *таблица на иерархию* наследование (TPH).</span><span class="sxs-lookup"><span data-stu-id="25f30-126">This pattern of generating an entity inheritance structure from a single database table is called *table-per-hierarchy* (TPH) inheritance.</span></span>

<span data-ttu-id="25f30-127">В качестве альтернативы можно создать базу данных, которая будет иметь приближенный к структуре наследования вид.</span><span class="sxs-lookup"><span data-stu-id="25f30-127">An alternative is to make the database look more like the inheritance structure.</span></span> <span data-ttu-id="25f30-128">Например, может содержать только имя поля `Person` таблицы и иметь отдельный `Instructor` и `Student` таблицы с полями даты.</span><span class="sxs-lookup"><span data-stu-id="25f30-128">For example, you could have only the name fields in the `Person` table and have separate `Instructor` and `Student` tables with the date fields.</span></span>

![Таблицы на type_inheritance](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image4.png)

<span data-ttu-id="25f30-130">Этот шаблон создания таблицы базы данных для каждого класса сущности вызывается *одна таблица на тип* наследования (TPT).</span><span class="sxs-lookup"><span data-stu-id="25f30-130">This pattern of making a database table for each entity class is called *table per type* (TPT) inheritance.</span></span>

<span data-ttu-id="25f30-131">Кроме того, можно сопоставить все не являющиеся абстрактными типы с отдельными таблицами.</span><span class="sxs-lookup"><span data-stu-id="25f30-131">Yet another option is to map all non-abstract types to individual tables.</span></span> <span data-ttu-id="25f30-132">Все свойства класса, включая унаследованные, сопоставляются со столбцами в соответствующей таблице.</span><span class="sxs-lookup"><span data-stu-id="25f30-132">All properties of a class, including inherited properties, map to columns of the corresponding table.</span></span> <span data-ttu-id="25f30-133">Такая модель называется наследованием типа "одна таблица на конкретный класс".</span><span class="sxs-lookup"><span data-stu-id="25f30-133">This pattern is called Table-per-Concrete Class (TPC) inheritance.</span></span> <span data-ttu-id="25f30-134">Если реализован TPC наследования для `Person`, `Student`, и `Instructor` классы, как показано выше, `Student` и `Instructor` таблицы будет выглядеть после реализации наследования, чем раньше не отличается.</span><span class="sxs-lookup"><span data-stu-id="25f30-134">If you implemented TPC inheritance for the `Person`, `Student`, and `Instructor` classes as shown earlier, the `Student` and `Instructor` tables would look no different after implementing inheritance than they did before.</span></span>

<span data-ttu-id="25f30-135">TPC и схемы наследования TPH обычно работы с большей производительностью на платформе Entity Framework, чем TPT схемы наследования, поскольку шаблоны TPT может привести к сложного соединения запросов.</span><span class="sxs-lookup"><span data-stu-id="25f30-135">TPC and TPH inheritance patterns generally deliver better performance in the Entity Framework than TPT inheritance patterns, because TPT patterns can result in complex join queries.</span></span>

<span data-ttu-id="25f30-136">В этом учебнике демонстрируется реализация модели наследования "одна таблица на иерархию".</span><span class="sxs-lookup"><span data-stu-id="25f30-136">This tutorial demonstrates how to implement TPH inheritance.</span></span> <span data-ttu-id="25f30-137">TPH является шаблон наследование по умолчанию в платформе Entity Framework, поэтому все, нужно сделать — создать `Person` класса, измените `Instructor` и `Student` классы являются производными от `Person`, добавьте новый класс `DbContext`и создать Миграция.</span><span class="sxs-lookup"><span data-stu-id="25f30-137">TPH is the default inheritance pattern in the Entity Framework, so all you have to do is create a `Person` class, change the `Instructor` and `Student` classes to derive from `Person`, add the new class to the `DbContext`, and create a migration.</span></span> <span data-ttu-id="25f30-138">(Сведения о способах реализации других шаблонах наследования. в разделе [сопоставление наследования таблица на тип (TPT)](https://msdn.microsoft.com/data/jj591617#2.5) и [сопоставление наследования таблицы каждой конкретной реализацией класса Отправляемых](https://msdn.microsoft.com/data/jj591617#2.6) в MSDN Entity Framework документации.)</span><span class="sxs-lookup"><span data-stu-id="25f30-138">(For information about how to implement the other inheritance patterns, see [Mapping the Table-Per-Type (TPT) Inheritance](https://msdn.microsoft.com/data/jj591617#2.5) and [Mapping the Table-Per-Concrete Class (TPC) Inheritance](https://msdn.microsoft.com/data/jj591617#2.6) in the MSDN Entity Framework documentation.)</span></span>

## <a name="create-the-person-class"></a><span data-ttu-id="25f30-139">Создание класса Person</span><span class="sxs-lookup"><span data-stu-id="25f30-139">Create the Person class</span></span>

<span data-ttu-id="25f30-140">В *моделей* папке создайте *Person.cs* и замените код шаблона с помощью следующего кода:</span><span class="sxs-lookup"><span data-stu-id="25f30-140">In the *Models* folder, create *Person.cs* and replace the template code with the following code:</span></span>

[!code-csharp[Main](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample1.cs)]

## <a name="make-student-and-instructor-classes-inherit-from-person"></a><span data-ttu-id="25f30-141">Создание классов Student и Instructor, унаследованных от класса Person</span><span class="sxs-lookup"><span data-stu-id="25f30-141">Make Student and Instructor classes inherit from Person</span></span>

<span data-ttu-id="25f30-142">В *Instructor.cs*, являются производными `Instructor` класса из `Person` класса и удалять поля ключа и имени.</span><span class="sxs-lookup"><span data-stu-id="25f30-142">In *Instructor.cs*, derive the `Instructor` class from the `Person` class and remove the key and name fields.</span></span> <span data-ttu-id="25f30-143">Код будет выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="25f30-143">The code will look like the following example:</span></span>

[!code-csharp[Main](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample2.cs)]

<span data-ttu-id="25f30-144">Внести аналогичные изменения в *Student.cs*.</span><span class="sxs-lookup"><span data-stu-id="25f30-144">Make similar changes to *Student.cs*.</span></span> <span data-ttu-id="25f30-145">`Student` Класс будет выглядеть как в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="25f30-145">The `Student` class will look like the following example:</span></span>

[!code-csharp[Main](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample3.cs)]

## <a name="add-the-person-entity-type-to-the-model"></a><span data-ttu-id="25f30-146">Добавить в модель сущность типа Person</span><span class="sxs-lookup"><span data-stu-id="25f30-146">Add the Person Entity Type to the Model</span></span>

<span data-ttu-id="25f30-147">В *SchoolContext.cs*, добавьте `DbSet` свойство `Person` типа сущности:</span><span class="sxs-lookup"><span data-stu-id="25f30-147">In *SchoolContext.cs*, add a `DbSet` property for the `Person` entity type:</span></span>

[!code-csharp[Main](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample4.cs)]

<span data-ttu-id="25f30-148">Это все, что требуется платформе Entity Framework для настройки наследования типа "одна таблица на иерархию".</span><span class="sxs-lookup"><span data-stu-id="25f30-148">This is all that the Entity Framework needs in order to configure table-per-hierarchy inheritance.</span></span> <span data-ttu-id="25f30-149">Как вы увидите, при обновлении базы данных, он будет иметь `Person` таблицы вместо `Student` и `Instructor` таблицы.</span><span class="sxs-lookup"><span data-stu-id="25f30-149">As you'll see, when the database is updated, it will have a `Person` table in place of the `Student` and `Instructor` tables.</span></span>

## <a name="create-and-update-a-migrations-file"></a><span data-ttu-id="25f30-150">Создание и редактирование файла миграции</span><span class="sxs-lookup"><span data-stu-id="25f30-150">Create and Update a Migrations File</span></span>

<span data-ttu-id="25f30-151">В пакет Диспетчер консоли (PMC), введите следующую команду:</span><span class="sxs-lookup"><span data-stu-id="25f30-151">In the Package Manager Console (PMC), enter the following command:</span></span>

`Add-Migration Inheritance`

<span data-ttu-id="25f30-152">Запустите `Update-Database` в PMC команду.</span><span class="sxs-lookup"><span data-stu-id="25f30-152">Run the `Update-Database` command in the PMC.</span></span> <span data-ttu-id="25f30-153">Команда не будет выполнена на этом этапе у существующих данных, миграция не знает, как обрабатывать.</span><span class="sxs-lookup"><span data-stu-id="25f30-153">The command will fail at this point because we have existing data that migrations doesn't know how to handle.</span></span> <span data-ttu-id="25f30-154">Вы получаете сообщение об ошибке, как показано ниже:</span><span class="sxs-lookup"><span data-stu-id="25f30-154">You get an error message like the following one:</span></span>

> <span data-ttu-id="25f30-155">*Невозможно удалить объект "dbo. Инструктора ", так как он ссылается ограничение FOREIGN KEY.*</span><span class="sxs-lookup"><span data-stu-id="25f30-155">*Could not drop object 'dbo.Instructor' because it is referenced by a FOREIGN KEY constraint.*</span></span>


<span data-ttu-id="25f30-156">Откройте *миграций\&lt; отметка времени&gt;\_Inheritance.cs* и замените `Up` метод следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="25f30-156">Open *Migrations\&lt;timestamp&gt;\_Inheritance.cs* and replace the `Up` method with the following code:</span></span>

[!code-csharp[Main](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample5.cs)]

<span data-ttu-id="25f30-157">Этот код выполняет следующие задачи по обновлению базы данных:</span><span class="sxs-lookup"><span data-stu-id="25f30-157">This code takes care of the following database update tasks:</span></span>

- <span data-ttu-id="25f30-158">Удаляет ограничения внешнего ключа и индексы, которые указывают на таблицу Student.</span><span class="sxs-lookup"><span data-stu-id="25f30-158">Removes foreign key constraints and indexes that point to the Student table.</span></span>
- <span data-ttu-id="25f30-159">Переименовывает таблицу Instructor в Person и вносит изменения, необходимые для сохранения в ней данных из таблицы Student:</span><span class="sxs-lookup"><span data-stu-id="25f30-159">Renames the Instructor table as Person and makes changes needed for it to store Student data:</span></span>

    - <span data-ttu-id="25f30-160">Добавляет допускающий значения NULL тип EnrollmentDate для учащихся.</span><span class="sxs-lookup"><span data-stu-id="25f30-160">Adds nullable EnrollmentDate for students.</span></span>
    - <span data-ttu-id="25f30-161">Добавляет столбец дискриминатора, который указывает, представляет ли строка учащегося или преподавателя.</span><span class="sxs-lookup"><span data-stu-id="25f30-161">Adds Discriminator column to indicate whether a row is for a student or an instructor.</span></span>
    - <span data-ttu-id="25f30-162">Изменяет тип HireDate на допускающий значения NULL, поскольку в строках для учащихся не будет указываться дата приема на работу.</span><span class="sxs-lookup"><span data-stu-id="25f30-162">Makes HireDate nullable since student rows won't have hire dates.</span></span>
    - <span data-ttu-id="25f30-163">Добавляет временное поле, которое будет использоваться для обновления внешних ключей, указывающих на учащихся.</span><span class="sxs-lookup"><span data-stu-id="25f30-163">Adds a temporary field that will be used to update foreign keys that point to students.</span></span> <span data-ttu-id="25f30-164">При копировании студентов в таблице Person, где они могут получить новые значения первичных ключей.</span><span class="sxs-lookup"><span data-stu-id="25f30-164">When you copy students into the Person table they'll get new primary key values.</span></span>
- <span data-ttu-id="25f30-165">Копирует данные из таблицы Student в таблицу Person.</span><span class="sxs-lookup"><span data-stu-id="25f30-165">Copies data from the Student table into the Person table.</span></span> <span data-ttu-id="25f30-166">При этом записям учащихся назначаются новые значения первичного ключа.</span><span class="sxs-lookup"><span data-stu-id="25f30-166">This causes students to get assigned new primary key values.</span></span>
- <span data-ttu-id="25f30-167">Исправляет значения внешнего ключа, которые указывают на учащихся.</span><span class="sxs-lookup"><span data-stu-id="25f30-167">Fixes foreign key values that point to students.</span></span>
- <span data-ttu-id="25f30-168">Повторно создает ограничения внешнего ключа и индексы, которые после этого указывают на таблицу Person.</span><span class="sxs-lookup"><span data-stu-id="25f30-168">Re-creates foreign key constraints and indexes, now pointing them to the Person table.</span></span>

<span data-ttu-id="25f30-169">(Если вместо целочисленного типа первичного ключа используется GUID, значения первичного ключа для записей учащихся изменять не потребуется и некоторые из этих действий можно пропустить.)</span><span class="sxs-lookup"><span data-stu-id="25f30-169">(If you had used GUID instead of integer as the primary key type, the student primary key values wouldn't have to change, and several of these steps could have been omitted.)</span></span>

<span data-ttu-id="25f30-170">Запустите `update-database` еще раз.</span><span class="sxs-lookup"><span data-stu-id="25f30-170">Run the `update-database` command again.</span></span>

<span data-ttu-id="25f30-171">(В рабочей среде можно будет выполнить соответствующие изменения метода вниз в случае, если когда-либо было необходимо использовать, чтобы вернуться к предыдущей версии базы данных.</span><span class="sxs-lookup"><span data-stu-id="25f30-171">(In a production system you would make corresponding changes to the Down method in case you ever had to use that to go back to the previous database version.</span></span> <span data-ttu-id="25f30-172">В этом учебнике не будет использоваться метод вниз.)</span><span class="sxs-lookup"><span data-stu-id="25f30-172">For this tutorial you won't be using the Down method.)</span></span>

> [!NOTE]
> <span data-ttu-id="25f30-173">Можно получить другие ошибки при переносе данных и внесения изменений схемы.</span><span class="sxs-lookup"><span data-stu-id="25f30-173">It's possible to get other errors when migrating data and making schema changes.</span></span> <span data-ttu-id="25f30-174">Если возникают ошибки при миграции не удается устранить, можно будет продолжить учебника, изменив строку подключения в *Web.config* файлов или при удалении базы данных.</span><span class="sxs-lookup"><span data-stu-id="25f30-174">If you get migration errors you can't resolve, you can continue with the tutorial by changing the connection string in the *Web.config* file or by deleting the database.</span></span> <span data-ttu-id="25f30-175">Самым простым подходом является переименовать базу данных, в *Web.config* файла.</span><span class="sxs-lookup"><span data-stu-id="25f30-175">The simplest approach is to rename the database in the *Web.config* file.</span></span> <span data-ttu-id="25f30-176">Например измените имя базы данных ContosoUniversity2, как показано в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="25f30-176">For example, change the database name to ContosoUniversity2 as shown in the following example:</span></span>
> 
> [!code-xml[Main](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample6.xml?highlight=2)]
> 
> <span data-ttu-id="25f30-177">С помощью новой базы данных нет данных для переноса и `update-database` команда гораздо больше шансов завершиться без ошибок.</span><span class="sxs-lookup"><span data-stu-id="25f30-177">With a new database, there is no data to migrate, and the `update-database` command is much more likely to complete without errors.</span></span> <span data-ttu-id="25f30-178">Инструкции по удалению базы данных см. в разделе [как удалить базу данных из Visual Studio 2012](http://romiller.com/2013/05/17/how-to-drop-a-database-from-visual-studio-2012/).</span><span class="sxs-lookup"><span data-stu-id="25f30-178">For instructions on how to delete the database, see [How to Drop a Database from Visual Studio 2012](http://romiller.com/2013/05/17/how-to-drop-a-database-from-visual-studio-2012/).</span></span> <span data-ttu-id="25f30-179">При использовании этого подхода, чтобы продолжить работу с учебником, пропустите шаг развертывания в конце этого учебника, или развернуть для нового сайта и базы данных.</span><span class="sxs-lookup"><span data-stu-id="25f30-179">If you take this approach in order to continue with the tutorial, skip the deployment step at the end of this tutorial or deploy to a new site and database.</span></span> <span data-ttu-id="25f30-180">При развертывании обновления на том же сайте, в которой развертывание уже EF получите та же ошибка при выполнении миграции автоматически.</span><span class="sxs-lookup"><span data-stu-id="25f30-180">If you deploy an update to the same site you've been deploying to already, EF will get the same error there when it runs migrations automatically.</span></span> <span data-ttu-id="25f30-181">Если вы хотите устранении ошибки миграции, лучший ресурс является одним из форумов Entity Framework или StackOverflow.com.</span><span class="sxs-lookup"><span data-stu-id="25f30-181">If you want to troubleshoot a migrations error, the best resource is one of the Entity Framework forums or StackOverflow.com.</span></span>


## <a name="testing"></a><span data-ttu-id="25f30-182">Тестирование</span><span class="sxs-lookup"><span data-stu-id="25f30-182">Testing</span></span>

<span data-ttu-id="25f30-183">Запустите сайт и попробуйте различные страницы.</span><span class="sxs-lookup"><span data-stu-id="25f30-183">Run the site and try various pages.</span></span> <span data-ttu-id="25f30-184">Все работает так же, как и раньше.</span><span class="sxs-lookup"><span data-stu-id="25f30-184">Everything works the same as it did before.</span></span>

<span data-ttu-id="25f30-185">В **обозревателя серверов** разверните **Connections\SchoolContext данные** и затем **таблиц**, и вы увидите, что **студента** и **Инструктора** таблицы были заменены **лицо** таблицы.</span><span class="sxs-lookup"><span data-stu-id="25f30-185">In **Server Explorer,** expand **Data Connections\SchoolContext** and then **Tables**, and you see that the **Student** and **Instructor** tables have been replaced by a **Person** table.</span></span> <span data-ttu-id="25f30-186">Разверните **лицо** таблица отобразится все столбцы, которые используются в наличии **студента** и **инструктора** таблиц.</span><span class="sxs-lookup"><span data-stu-id="25f30-186">Expand the **Person** table and you see that it has all of the columns that used to be in the **Student** and **Instructor** tables.</span></span>

![Server_Explorer_showing_Person_table](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image5.png)

<span data-ttu-id="25f30-188">Щелкните таблицу Person правой кнопкой мыши и выберите команду **Показать данные таблицы**, чтобы просмотреть столбец дискриминатора.</span><span class="sxs-lookup"><span data-stu-id="25f30-188">Right-click the Person table, and then click **Show Table Data** to see the discriminator column.</span></span>

![](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image6.png)

<span data-ttu-id="25f30-189">На следующей схеме показана структура новой базы данных School:</span><span class="sxs-lookup"><span data-stu-id="25f30-189">The following diagram illustrates the structure of the new School database:</span></span>

![School_database_diagram](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image7.png)

## <a name="deploy-to-azure"></a><span data-ttu-id="25f30-191">Развертывание в Azure</span><span class="sxs-lookup"><span data-stu-id="25f30-191">Deploy to Azure</span></span>

<span data-ttu-id="25f30-192">В этом разделе необходимо выполнить дополнительный **развертыванию приложения в Azure** статьи [часть 3, сортировку, фильтрацию и разбиение по страницам](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md) из этого учебника ряда.</span><span class="sxs-lookup"><span data-stu-id="25f30-192">This section requires you to have completed the optional **Deploying the app to Azure** section in [Part 3, Sorting, Filtering, and Paging](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md) of this tutorial series.</span></span> <span data-ttu-id="25f30-193">Если у вас есть ошибки миграции, которые можно разрешить путем удаления базы данных в локальном проекте, пропустите этот шаг; Создание нового сайта и базы данных и развернуть в новой среде.</span><span class="sxs-lookup"><span data-stu-id="25f30-193">If you had migrations errors that you resolved by deleting the database in your local project, skip this step; or create a new site and database, and deploy to the new environment.</span></span>

1. <span data-ttu-id="25f30-194">В Visual Studio щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **публикации** в контекстном меню.</span><span class="sxs-lookup"><span data-stu-id="25f30-194">In Visual Studio, right-click the project in **Solution Explorer** and select **Publish** from the context menu.</span></span>  
  
    ![Публикация в контекстном меню проекта](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image8.png)
2. <span data-ttu-id="25f30-196">Нажмите кнопку **Опубликовать**.</span><span class="sxs-lookup"><span data-stu-id="25f30-196">Click **Publish**.</span></span>  
  
    ![publish](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image9.png)  
  
   <span data-ttu-id="25f30-198">Веб-приложение открывается в браузере по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="25f30-198">The Web app will open in your default browser.</span></span>
3. <span data-ttu-id="25f30-199">Протестируйте приложение, чтобы проверить его работы.</span><span class="sxs-lookup"><span data-stu-id="25f30-199">Test the application to verify it's working.</span></span>

    <span data-ttu-id="25f30-200">При первом запуске страницы, который обращается к базе данных, платформа Entity Framework запускает все миграций `Up` методы, необходимые для перевода базы данных в актуальном состоянии с текущей моделью данных.</span><span class="sxs-lookup"><span data-stu-id="25f30-200">The first time you run a page that accesses the database, the Entity Framework runs all of the migrations `Up` methods required to bring the database up to date with the current data model.</span></span>

## <a name="summary"></a><span data-ttu-id="25f30-201">Сводка</span><span class="sxs-lookup"><span data-stu-id="25f30-201">Summary</span></span>

<span data-ttu-id="25f30-202">Вы реализовали наследование типа "одна таблица на иерархию" для классов `Person`, `Student` и `Instructor`.</span><span class="sxs-lookup"><span data-stu-id="25f30-202">You've implemented table-per-hierarchy inheritance for the `Person`, `Student`, and `Instructor` classes.</span></span> <span data-ttu-id="25f30-203">Дополнительные сведения об этом и других структур наследования см. в разделе [шаблон наследования TPT](https://msdn.microsoft.com/data/jj618293) и [шаблон наследования TPH](https://msdn.microsoft.com/data/jj618292) на сайте MSDN.</span><span class="sxs-lookup"><span data-stu-id="25f30-203">For more information about this and other inheritance structures, see [TPT Inheritance Pattern](https://msdn.microsoft.com/data/jj618293) and [TPH Inheritance Pattern](https://msdn.microsoft.com/data/jj618292) on MSDN.</span></span> <span data-ttu-id="25f30-204">В рамках следующего учебника вы узнаете, как работать в нескольких сценариях Entity Framework с расширенными возможностями.</span><span class="sxs-lookup"><span data-stu-id="25f30-204">In the next tutorial you'll see how to handle a variety of relatively advanced Entity Framework scenarios.</span></span>

<span data-ttu-id="25f30-205">Ссылки на другие ресурсы Entity Framework можно найти в [доступа к данным ASP.NET - рекомендуется использовать ресурсы](../../../../whitepapers/aspnet-data-access-content-map.md).</span><span class="sxs-lookup"><span data-stu-id="25f30-205">Links to other Entity Framework resources can be found in the [ASP.NET Data Access - Recommended Resources](../../../../whitepapers/aspnet-data-access-content-map.md).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="25f30-206">[Назад](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md)
> [Вперед](advanced-entity-framework-scenarios-for-an-mvc-web-application.md)</span><span class="sxs-lookup"><span data-stu-id="25f30-206">[Previous](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md)
[Next](advanced-entity-framework-scenarios-for-an-mvc-web-application.md)</span></span>
